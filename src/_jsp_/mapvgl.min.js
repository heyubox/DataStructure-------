(function(v,U){"object"===typeof exports&&"undefined"!==typeof module?U(exports):"function"===typeof define&&define.amd?define(["exports"],U):(v=v||self,U(v.mapvgl={}))})(this,function(v){function U(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r["default"]:r}function ea(r,g){return g={exports:{}},r(g,g.exports),g.exports}function Fc(r,g){return function(c){return g(r(c))}}function Gc(r){var g=function(c){if(void 0===c||null===c)return c;1<arguments.length&&(c=Array.prototype.slice.call(arguments));
return r(c)};"conversion"in r&&(g.conversion=r.conversion);return g}function Hc(r){var g=function(c){if(void 0===c||null===c)return c;1<arguments.length&&(c=Array.prototype.slice.call(arguments));var d=r(c);if("object"===("undefined"===typeof d?"undefined":V(d)))for(var b=d.length,a=0;a<b;a++)d[a]=Math.round(d[a]);return d};"conversion"in r&&(g.conversion=r.conversion);return g}function T(r,g){if(!(this instanceof T))return new T(r,g);g&&g in dc&&(g=null);if(g&&!(g in fa))throw Error("Unknown model: "+
g);if("undefined"===typeof r)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(r instanceof T)this.model=r.model,this.color=r.color.slice(),this.valpha=r.valpha;else if("string"===typeof r){g=fb.get(r);if(null===g)throw Error("Unable to parse color from string: "+r);this.model=g.model;var c=fa[this.model].channels;this.color=g.value.slice(0,c);this.valpha="number"===typeof g.value[c]?g.value[c]:1}else if(r.length)this.model=g||"rgb",c=fa[this.model].channels,g=Hb.call(r,0,c),this.color=tb(g,
c),this.valpha="number"===typeof r[c]?r[c]:1;else if("number"===typeof r)r&=16777215,this.model="rgb",this.color=[r>>16&255,r>>8&255,r&255],this.valpha=1;else{this.valpha=1;g=Object.keys(r);"alpha"in r&&(g.splice(g.indexOf("alpha"),1),this.valpha="number"===typeof r.alpha?r.alpha:0);g=g.sort().join("");if(!(g in Ib))throw Error("Unable to parse color from object: "+JSON.stringify(r));this.model=Ib[g];c=fa[this.model].labels;var d=[];for(g=0;g<c.length;g++)d.push(r[c[g]]);this.color=tb(d)}if(Oa[this.model])for(c=
fa[this.model].channels,g=0;g<c;g++)(r=Oa[this.model][g])&&(this.color[g]=r(this.color[g]));this.valpha=Math.max(0,Math.min(1,this.valpha));Object.freeze&&Object.freeze(this)}function Ic(r){return function(g){return Number(g.toFixed(r))}}function M(r,g,c){r=Array.isArray(r)?r:[r];r.forEach(function(d){(Oa[d]||(Oa[d]=[]))[g]=c});r=r[0];return function(d){if(arguments.length){c&&(d=c(d));var b=this[r]();b.color[g]=d;return b}b=this[r]().color[g];c&&(b=c(b));return b}}function P(r){return function(g){return Math.max(0,
Math.min(r,g))}}function tb(r,g){for(var c=0;c<g;c++)"number"!==typeof r[c]&&(r[c]=0);return r}function ja(){}function ec(r,g){for(var c in g)r[c]=g[c]}function la(r,g){this.lng=r;this.lat=g}function fc(r,g){this.x=r;this.y=g}function gb(r){return r*Math.PI/180}function hb(r,g){var c=document.createElement("canvas");r&&(c.width=r);g&&(c.height=g);return c}function X(r){r=r||{};this.gradient=r.gradient||{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"};
this.maxSize=void 0===r.maxSize?35:r.maxSize;this.minSize=r.minSize||0;this.max=r.max||100;this.min=r.min||0;this.initPalette()}function va(r){this.options=r||{};this._initialize()}function ub(r,g,c,d,b){var a=1-r,f=1-r;return a*a*a*g+3*f*f*r*c+3*(1-r)*r*r*d+r*r*r*b}function gc(r){for(var g=["webgl2","experimental-webgl2","webgl","experimental-webgl"],c,d=0;d<g.length;d++)try{if(c=r.getContext(g[d]),c.getExtension("OES_element_index_uint"),c)break}catch(b){}return c}function vb(r,g){var c=r.createTexture();
r.bindTexture(r.TEXTURE_2D,c);r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,!0);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,g);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.REPEAT);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.REPEAT);r.bindTexture(r.TEXTURE_2D,null);return c}function wb(r,g,c){if("object"===("undefined"===typeof g?"undefined":V(g)))g=vb(r,g),c(g,null);else{var d=
new Image;d.crossOrigin="anonymous";d.onload=function(){var b=vb(r,this);c(b,d)};d.src=g}}function xb(r,g){return function(c){var d=this;if(g){if(Ta&&!c)return c=(""+g).replace(/^function.+?{/,"").slice(0,-1),c=hc(c),this[ic]=new Ta(c),Pa.revokeObjectURL(c),this[ic];var b={postMessage:function(a){d.onmessage&&setTimeout(function(){return d.onmessage({data:a,target:b})})}};g.call(b);this.postMessage=function(a){setTimeout(function(){return b.onmessage({data:a,target:d})})};this.isThisThread=!0}else return new Ta(r)}}
function hc(r){try{return Pa.createObjectURL(new Blob([r],{type:"application/javascript"}))}catch(c){var g=new Jc;g.append(r);return Pa.createObjectURL(g.getBlob(type))}}function pa(r,g,c){this.heatmapLayer=c;this.options=g||{};this.map=r;r=document.createElement("canvas");this.data=[];this.canvas=r;this.scale(1)}function Jb(r,g,c){this.layer=r;this.map=g;this.gl=c;this.initWorker()}function Kb(r,g,c){this.layer=r;this.map=g;this.gl=c;this.initWorker()}function ib(r,g,c){c=c||2;var d=g&&g.length,
b=d?g[0]*c:r.length,a=jc(r,0,b,c,!0),f=[];if(!a||a.next===a.prev)return f;var k;if(d){var e=c;d=[];var l;var n=0;for(l=g.length;n<l;n++){var q=g[n]*e;var h=n<l-1?g[n+1]*e:r.length;q=jc(r,q,h,e,!1);q===q.next&&(q.steiner=!0);d.push(Kc(q))}d.sort(Lc);for(n=0;n<d.length;n++){g=d[n];e=a;if(e=Mc(g,e))g=kc(e,g),Fa(g,g.next);a=Fa(a,a.next)}}if(r.length>80*c){var p=k=r[0];var m=d=r[1];for(e=c;e<b;e+=c)n=r[e],g=r[e+1],n<p&&(p=n),g<m&&(m=g),n>k&&(k=n),g>d&&(d=g);k=Math.max(k-p,d-m);k=0!==k?1/k:0}Ua(a,f,c,p,
m,k);return f}function jc(r,g,c,d,b){if(b===0<Lb(r,g,c,d))for(b=g;b<c;b+=d)var a=lc(b,r[b],r[b+1],a);else for(b=c-d;b>=g;b-=d)a=lc(b,r[b],r[b+1],a);a&&Ga(a,a.next)&&(jb(a),a=a.next);return a}function Fa(r,g){if(!r)return r;g||(g=r);do{var c=!1;if(r.steiner||!Ga(r,r.next)&&0!==R(r.prev,r,r.next))r=r.next;else{jb(r);r=g=r.prev;if(r===r.next)break;c=!0}}while(c||r!==g);return g}function Ua(r,g,c,d,b,a,f){if(r){if(!f&&a){var k=r,e=k;do null===e.z&&(e.z=kb(e.x,e.y,d,b,a)),e.prevZ=e.prev,e=e.nextZ=e.next;
while(e!==k);e.prevZ.nextZ=null;e.prevZ=null;k=e;var l,n,q,h,p=1;do{e=k;var m=k=null;for(n=0;e;){n++;var t=e;for(l=q=0;l<p&&(q++,t=t.nextZ,t);l++);for(h=p;0<q||0<h&&t;)0!==q&&(0===h||!t||e.z<=t.z)?(l=e,e=e.nextZ,q--):(l=t,t=t.nextZ,h--),m?m.nextZ=l:k=l,l.prevZ=m,m=l;e=t}m.nextZ=null;p*=2}while(1<n)}for(k=r;r.prev!==r.next;){e=r.prev;t=r.next;if(a)m=Nc(r,d,b,a);else a:if(m=r,n=m.prev,q=m,p=m.next,0<=R(n,q,p))m=!1;else{for(l=m.next.next;l!==m.prev;){if(Va(n.x,n.y,q.x,q.y,p.x,p.y,l.x,l.y)&&0<=R(l.prev,
l,l.next)){m=!1;break a}l=l.next}m=!0}if(m)g.push(e.i/c),g.push(r.i/c),g.push(t.i/c),jb(r),k=r=t.next;else if(r=t,r===k){if(!f)Ua(Fa(r),g,c,d,b,a,1);else if(1===f){f=g;k=c;e=r;do t=e.prev,m=e.next.next,!Ga(t,m)&&mc(t,e,e.next,m)&&Wa(t,m)&&Wa(m,t)&&(f.push(t.i/k),f.push(e.i/k),f.push(m.i/k),jb(e),jb(e.next),e=r=m),e=e.next;while(e!==r);r=e;Ua(r,g,c,d,b,a,2)}else if(2===f)a:{f=r;do{for(k=f.next.next;k!==f.prev;){if(e=f.i!==k.i){e=f;t=k;if(m=e.next.i!==t.i&&e.prev.i!==t.i){b:{m=e;do{if(m.i!==e.i&&m.next.i!==
e.i&&m.i!==t.i&&m.next.i!==t.i&&mc(m,m.next,e,t)){m=!0;break b}m=m.next}while(m!==e);m=!1}m=!m}if(m=m&&Wa(e,t)&&Wa(t,e)){m=e;n=!1;q=(e.x+t.x)/2;t=(e.y+t.y)/2;do m.y>t!==m.next.y>t&&m.next.y!==m.y&&q<(m.next.x-m.x)*(t-m.y)/(m.next.y-m.y)+m.x&&(n=!n),m=m.next;while(m!==e);m=n}e=m}if(e){r=kc(f,k);f=Fa(f,f.next);r=Fa(r,r.next);Ua(f,g,c,d,b,a);Ua(r,g,c,d,b,a);break a}k=k.next}f=f.next}while(f!==r)}break}}}}function Nc(r,g,c,d){var b=r.prev,a=r.next;if(0<=R(b,r,a))return!1;var f=b.x>r.x?b.x>a.x?b.x:a.x:
r.x>a.x?r.x:a.x,k=b.y>r.y?b.y>a.y?b.y:a.y:r.y>a.y?r.y:a.y,e=kb(b.x<r.x?b.x<a.x?b.x:a.x:r.x<a.x?r.x:a.x,b.y<r.y?b.y<a.y?b.y:a.y:r.y<a.y?r.y:a.y,g,c,d);g=kb(f,k,g,c,d);c=r.prevZ;for(d=r.nextZ;c&&c.z>=e&&d&&d.z<=g;){if(c!==r.prev&&c!==r.next&&Va(b.x,b.y,r.x,r.y,a.x,a.y,c.x,c.y)&&0<=R(c.prev,c,c.next))return!1;c=c.prevZ;if(d!==r.prev&&d!==r.next&&Va(b.x,b.y,r.x,r.y,a.x,a.y,d.x,d.y)&&0<=R(d.prev,d,d.next))return!1;d=d.nextZ}for(;c&&c.z>=e;){if(c!==r.prev&&c!==r.next&&Va(b.x,b.y,r.x,r.y,a.x,a.y,c.x,c.y)&&
0<=R(c.prev,c,c.next))return!1;c=c.prevZ}for(;d&&d.z<=g;){if(d!==r.prev&&d!==r.next&&Va(b.x,b.y,r.x,r.y,a.x,a.y,d.x,d.y)&&0<=R(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function Lc(r,g){return r.x-g.x}function Mc(r,g){var c=g,d=r.x,b=r.y,a=-Infinity;do{if(b<=c.y&&b>=c.next.y&&c.next.y!==c.y){var f=c.x+(b-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(f<=d&&f>a){a=f;if(f===d){if(b===c.y)return c;if(b===c.next.y)return c.next}var k=c.x<c.next.x?c:c.next}}c=c.next}while(c!==g);if(!k)return null;if(d===a)return k.prev;
g=k;f=k.x;var e=k.y,l=Infinity;for(c=k.next;c!==g;){if(d>=c.x&&c.x>=f&&d!==c.x&&Va(b<e?d:a,b,f,e,b<e?a:d,b,c.x,c.y)){var n=Math.abs(b-c.y)/(d-c.x);(n<l||n===l&&c.x>k.x)&&Wa(c,r)&&(k=c,l=n)}c=c.next}return k}function kb(r,g,c,d,b){r=32767*(r-c)*b;g=32767*(g-d)*b;r=(r|r<<8)&16711935;r=(r|r<<4)&252645135;r=(r|r<<2)&858993459;g=(g|g<<8)&16711935;g=(g|g<<4)&252645135;g=(g|g<<2)&858993459;return(r|r<<1)&1431655765|((g|g<<1)&1431655765)<<1}function Kc(r){var g=r,c=r;do{if(g.x<c.x||g.x===c.x&&g.y<c.y)c=g;
g=g.next}while(g!==r);return c}function Va(r,g,c,d,b,a,f,k){return 0<=(b-f)*(g-k)-(r-f)*(a-k)&&0<=(r-f)*(d-k)-(c-f)*(g-k)&&0<=(c-f)*(a-k)-(b-f)*(d-k)}function R(r,g,c){return(g.y-r.y)*(c.x-g.x)-(g.x-r.x)*(c.y-g.y)}function Ga(r,g){return r.x===g.x&&r.y===g.y}function mc(r,g,c,d){return Ga(r,g)&&Ga(c,d)||Ga(r,d)&&Ga(c,g)?!0:0<R(r,g,c)!==0<R(r,g,d)&&0<R(c,d,r)!==0<R(c,d,g)}function Wa(r,g){return 0>R(r.prev,r,r.next)?0<=R(r,g,r.next)&&0<=R(r,r.prev,g):0>R(r,g,r.prev)||0>R(r,r.next,g)}function kc(r,
g){var c=new Mb(r.i,r.x,r.y),d=new Mb(g.i,g.x,g.y),b=r.next,a=g.prev;r.next=g;g.prev=r;c.next=b;b.prev=c;d.next=c;c.prev=d;a.next=d;d.prev=a;return d}function lc(r,g,c,d){r=new Mb(r,g,c);d?(r.next=d.next,r.prev=d,d.next.prev=r,d.next=r):(r.prev=r,r.next=r);return r}function jb(r){r.next.prev=r.prev;r.prev.next=r.next;r.prevZ&&(r.prevZ.nextZ=r.nextZ);r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Mb(r,g,c){this.i=r;this.x=g;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}
function Lb(r,g,c,d){for(var b=0,a=c-d;g<c;g+=d)b+=(r[a]-r[g])*(r[g+1]+r[a+1]),a=g;return b}function ma(r,g){this.shapeLayer=r;this.gl=g;this.initData()}var Oc="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{},qa={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,
205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,
50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,
128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,
160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,
21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,
230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,
224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Xa=ea(function(r){var g=Array.prototype.concat,c=Array.prototype.slice,d=r.exports=function(b){for(var a=[],f=0,k=b.length;f<k;f++){var e=b[f];var l=(l=e)&&"string"!==typeof l?l instanceof Array||Array.isArray(l)||0<=l.length&&(l.splice instanceof Function||Object.getOwnPropertyDescriptor(l,l.length-1)&&"String"!==l.constructor.name):!1;l?a=g.call(a,c.call(e)):
a.push(e)}return a};d.wrap=function(b){return function(){return b(d(arguments))}}}),fb=ea(function(r){function g(a,b,e){return Math.min(Math.max(b,a),e)}function c(a){a=a.toString(16).toUpperCase();return 2>a.length?"0"+a:a}var d={},b;for(b in qa)qa.hasOwnProperty(b)&&(d[qa[b]]=b);var a=r.exports={to:{},get:{}};a.get=function(f){switch(f.substring(0,3).toLowerCase()){case "hsl":f=a.get.hsl(f);var b="hsl";break;case "hwb":f=a.get.hwb(f);b="hwb";break;default:f=a.get.rgb(f),b="rgb"}return f?{model:b,
value:f}:null};a.get.rgb=function(a){if(!a)return null;var f=/^#([a-f0-9]{3,4})$/i,e=/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,b=/^rgba?\(\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/,c=/(\D+)/,d=[0,0,0,1],h;if(h=a.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){f=h[2];h=h[1];for(a=0;3>a;a++)e=2*a,d[a]=parseInt(h.slice(e,e+2),16);f&&(d[3]=Math.round(parseInt(f,16)/255*100)/100)}else if(h=a.match(f)){h=h[1];
f=h[3];for(a=0;3>a;a++)d[a]=parseInt(h[a]+h[a],16);f&&(d[3]=Math.round(parseInt(f+f,16)/255*100)/100)}else if(h=a.match(e)){for(a=0;3>a;a++)d[a]=parseInt(h[a+1],0);h[4]&&(d[3]=parseFloat(h[4]))}else if(h=a.match(b)){for(a=0;3>a;a++)d[a]=Math.round(2.55*parseFloat(h[a+1]));h[4]&&(d[3]=parseFloat(h[4]))}else{if(h=a.match(c)){if("transparent"===h[1])return[0,0,0,0];d=qa[h[1]];if(!d)return null;d[3]=1;return d}return null}for(a=0;3>a;a++)d[a]=g(d[a],0,255);d[3]=g(d[3],0,1);return d};a.get.hsl=function(a){if(!a)return null;
var f=a.match(/^hsla?\(\s*([+-]?(?:\d*\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(f){var e=parseFloat(f[4]);a=(parseFloat(f[1])+360)%360;var b=g(parseFloat(f[2]),0,100);f=g(parseFloat(f[3]),0,100);e=g(isNaN(e)?1:e,0,1);return[a,b,f,e]}return null};a.get.hwb=function(a){if(!a)return null;var f=a.match(/^hwb\(\s*([+-]?\d*[\.]?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(f){var e=parseFloat(f[4]);a=
(parseFloat(f[1])%360+360)%360;var b=g(parseFloat(f[2]),0,100);f=g(parseFloat(f[3]),0,100);e=g(isNaN(e)?1:e,0,1);return[a,b,f,e]}return null};a.to.hex=function(){var a=Xa(arguments);return"#"+c(a[0])+c(a[1])+c(a[2])+(1>a[3]?c(Math.round(255*a[3])):"")};a.to.rgb=function(){var a=Xa(arguments);return 4>a.length||1===a[3]?"rgb("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+")":"rgba("+Math.round(a[0])+", "+Math.round(a[1])+", "+Math.round(a[2])+", "+a[3]+")"};a.to.rgb.percent=function(){var a=
Xa(arguments),b=Math.round(a[0]/255*100),e=Math.round(a[1]/255*100),c=Math.round(a[2]/255*100);return 4>a.length||1===a[3]?"rgb("+b+"%, "+e+"%, "+c+"%)":"rgba("+b+"%, "+e+"%, "+c+"%, "+a[3]+")"};a.to.hsl=function(){var a=Xa(arguments);return 4>a.length||1===a[3]?"hsl("+a[0]+", "+a[1]+"%, "+a[2]+"%)":"hsla("+a[0]+", "+a[1]+"%, "+a[2]+"%, "+a[3]+")"};a.to.hwb=function(){var a=Xa(arguments),b="";4<=a.length&&1!==a[3]&&(b=", "+a[3]);return"hwb("+a[0]+", "+a[1]+"%, "+a[2]+"%"+b+")"};a.to.keyword=function(a){return d[a.slice(0,
3)]}}),Ca=ea(function(r){var g={};for(b in qa)qa.hasOwnProperty(b)&&(g[qa[b]]=b);var c=r.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,
labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}},d;for(d in c)if(c.hasOwnProperty(d)){if(!("channels"in c[d]))throw Error("missing channels property: "+d);if(!("labels"in c[d]))throw Error("missing channel labels property: "+d);if(c[d].labels.length!==c[d].channels)throw Error("channel and label counts mismatch: "+d);r=c[d].channels;var b=c[d].labels;delete c[d].channels;delete c[d].labels;Object.defineProperty(c[d],"channels",{value:r});Object.defineProperty(c[d],
"labels",{value:b})}c.rgb.hsl=function(a){var f=a[0]/255,b=a[1]/255,e=a[2]/255;a=Math.min(f,b,e);var c=Math.max(f,b,e),d=c-a,g;c===a?g=0:f===c?g=(b-e)/d:b===c?g=2+(e-f)/d:e===c&&(g=4+(f-b)/d);g=Math.min(60*g,360);0>g&&(g+=360);f=(a+c)/2;return[g,100*(c===a?0:.5>=f?d/(c+a):d/(2-c-a)),100*f]};c.rgb.hsv=function(a){var f,b=a[0]/255,e=a[1]/255,c=a[2]/255,d=Math.max(b,e,c);var g=d-Math.min(b,e,c);if(0===g)var h=f=0;else{f=g/d;a=(d-b)/6/g+.5;var p=(d-e)/6/g+.5;g=(d-c)/6/g+.5;b===d?h=g-p:e===d?h=1/3+a-g:
c===d&&(h=2/3+p-a);0>h?h+=1:1<h&&--h}return[360*h,100*f,100*d]};c.rgb.hwb=function(a){var f=a[0],b=a[1],e=a[2];a=c.rgb.hsl(a)[0];var l=1/255*Math.min(f,Math.min(b,e));e=1-1/255*Math.max(f,Math.max(b,e));return[a,100*l,100*e]};c.rgb.cmyk=function(a){var f=a[0]/255,b=a[1]/255;a=a[2]/255;var e=Math.min(1-f,1-b,1-a);return[100*((1-f-e)/(1-e)||0),100*((1-b-e)/(1-e)||0),100*((1-a-e)/(1-e)||0),100*e]};c.rgb.keyword=function(a){var f=g[a];if(f)return f;f=Infinity;var b;for(b in qa)if(qa.hasOwnProperty(b)){var e=
qa[b];e=Math.pow(a[0]-e[0],2)+Math.pow(a[1]-e[1],2)+Math.pow(a[2]-e[2],2);if(e<f){f=e;var c=b}}return c};c.keyword.rgb=function(a){return qa[a]};c.rgb.xyz=function(a){var f=a[0]/255,b=a[1]/255;a=a[2]/255;f=.04045<f?Math.pow((f+.055)/1.055,2.4):f/12.92;b=.04045<b?Math.pow((b+.055)/1.055,2.4):b/12.92;a=.04045<a?Math.pow((a+.055)/1.055,2.4):a/12.92;return[100*(.4124*f+.3576*b+.1805*a),100*(.2126*f+.7152*b+.0722*a),100*(.0193*f+.1192*b+.9505*a)]};c.rgb.lab=function(a){var f=c.rgb.xyz(a);a=f[0];var b=
f[1];f=f[2];a/=95.047;b/=100;f/=108.883;a=.008856<a?Math.pow(a,1/3):7.787*a+16/116;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;f=.008856<f?Math.pow(f,1/3):7.787*f+16/116;return[116*b-16,500*(a-b),200*(b-f)]};c.hsl.rgb=function(a){var f=a[0]/360,b=a[1]/100;a=a[2]/100;if(0===b){var e=255*a;return[e,e,e]}b=.5>a?a*(1+b):a+b-a*b;a=2*a-b;var c=[0,0,0];for(var d=0;3>d;d++)e=f+1/3*-(d-1),0>e&&e++,1<e&&e--,e=1>6*e?a+6*(b-a)*e:1>2*e?b:2>3*e?a+(b-a)*(2/3-e)*6:a,c[d]=255*e;return c};c.hsl.hsv=function(a){var f=
a[0],b=a[1]/100;a=a[2]/100;var e=b,c=Math.max(a,.01);a*=2;b*=1>=a?a:2-a;e*=1>=c?c:2-c;return[f,100*(0===a?2*e/(c+e):2*b/(a+b)),(a+b)/2*100]};c.hsv.rgb=function(a){var f=a[0]/60,b=a[1]/100;a=a[2]/100;var e=Math.floor(f)%6,c=f-Math.floor(f);f=255*a*(1-b);var d=255*a*(1-b*c);b=255*a*(1-b*(1-c));a*=255;switch(e){case 0:return[a,b,f];case 1:return[d,a,f];case 2:return[f,a,b];case 3:return[f,d,a];case 4:return[b,f,a];case 5:return[a,f,d]}};c.hsv.hsl=function(a){var f=a[0],b=a[1]/100;a=a[2]/100;var e=Math.max(a,
.01);var c=(2-b)*e;e=b*e/(1>=c?c:2-c)||0;return[f,100*e,(2-b)*a/2*100]};c.hwb.rgb=function(a){var f=a[0]/360,b=a[1]/100;a=a[2]/100;var e=b+a;1<e&&(b/=e,a/=e);e=Math.floor(6*f);a=1-a;f=6*f-e;0!==(e&1)&&(f=1-f);f=b+f*(a-b);switch(e){default:case 6:case 0:e=a;var c=f;break;case 1:e=f;c=a;break;case 2:e=b;c=a;b=f;break;case 3:e=b;c=f;b=a;break;case 4:e=f;c=b;b=a;break;case 5:e=a,c=b,b=f}return[255*e,255*c,255*b]};c.cmyk.rgb=function(a){var f=a[3]/100;return[255*(1-Math.min(1,a[0]/100*(1-f)+f)),255*(1-
Math.min(1,a[1]/100*(1-f)+f)),255*(1-Math.min(1,a[2]/100*(1-f)+f))]};c.xyz.rgb=function(a){var f=a[0]/100,b=a[1]/100,e=a[2]/100;a=3.2406*f+-1.5372*b+-.4986*e;var c=-.9689*f+1.8758*b+.0415*e;f=.0557*f+-.204*b+1.057*e;a=.0031308<a?1.055*Math.pow(a,1/2.4)-.055:12.92*a;c=.0031308<c?1.055*Math.pow(c,1/2.4)-.055:12.92*c;f=.0031308<f?1.055*Math.pow(f,1/2.4)-.055:12.92*f;a=Math.min(Math.max(0,a),1);c=Math.min(Math.max(0,c),1);f=Math.min(Math.max(0,f),1);return[255*a,255*c,255*f]};c.xyz.lab=function(a){var f=
a[0],b=a[1];a=a[2];f/=95.047;b/=100;a/=108.883;f=.008856<f?Math.pow(f,1/3):7.787*f+16/116;b=.008856<b?Math.pow(b,1/3):7.787*b+16/116;a=.008856<a?Math.pow(a,1/3):7.787*a+16/116;return[116*b-16,500*(f-b),200*(b-a)]};c.lab.xyz=function(a){var f=a[1],b=a[2];a=(a[0]+16)/116;f=f/500+a;b=a-b/200;var e=Math.pow(a,3),c=Math.pow(f,3),d=Math.pow(b,3);return[95.047*(.008856<c?c:(f-16/116)/7.787),100*(.008856<e?e:(a-16/116)/7.787),108.883*(.008856<d?d:(b-16/116)/7.787)]};c.lab.lch=function(a){var f=a[0],b=a[1];
a=a[2];var e=360*Math.atan2(a,b)/2/Math.PI;0>e&&(e+=360);return[f,Math.sqrt(b*b+a*a),e]};c.lch.lab=function(a){var f=a[0],b=a[1];a=a[2]/360*2*Math.PI;return[f,b*Math.cos(a),b*Math.sin(a)]};c.rgb.ansi16=function(a){var f=a[0],b=a[1],e=a[2],l=1 in arguments?arguments[1]:c.rgb.hsv(a)[2];l=Math.round(l/50);if(0===l)return 30;f=30+(Math.round(e/255)<<2|Math.round(b/255)<<1|Math.round(f/255));2===l&&(f+=60);return f};c.hsv.ansi16=function(a){return c.rgb.ansi16(c.hsv.rgb(a),a[2])};c.rgb.ansi256=function(a){var f=
a[0],b=a[1];a=a[2];return f===b&&b===a?8>f?16:248<f?231:Math.round((f-8)/247*24)+232:16+36*Math.round(f/255*5)+6*Math.round(b/255*5)+Math.round(a/255*5)};c.ansi16.rgb=function(a){var f=a%10;if(0===f||7===f)return 50<a&&(f+=3.5),f=f/10.5*255,[f,f,f];a=.5*(~~(50<a)+1);return[(f&1)*a*255,(f>>1&1)*a*255,(f>>2&1)*a*255]};c.ansi256.rgb=function(a){if(232<=a){var f=10*(a-232)+8;return[f,f,f]}a-=16;f=Math.floor(a/36)/5*255;var b=Math.floor((a%=36)/6)/5*255;return[f,b,a%6/5*255]};c.rgb.hex=function(a){a=(((Math.round(a[0])&
255)<<16)+((Math.round(a[1])&255)<<8)+(Math.round(a[2])&255)).toString(16).toUpperCase();return"000000".substring(a.length)+a};c.hex.rgb=function(a){a=a.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];var f=a[0];3===a[0].length&&(f=f.split("").map(function(a){return a+a}).join(""));a=parseInt(f,16);return[a>>16&255,a>>8&255,a&255]};c.rgb.hcg=function(a){var f=a[0]/255,b=a[1]/255;a=a[2]/255;var e=Math.max(Math.max(f,b),a),c=Math.min(Math.min(f,b),a),d=e-c;return[(0>=d?0:e===f?(b-
a)/d%6:e===b?2+(a-f)/d:(f-b)/d+8)/6%1*360,100*d,100*(1>d?c/(1-d):0)]};c.hsl.hcg=function(a){var f=a[1]/100,b=a[2]/100,e=0;f=.5>b?2*f*b:2*f*(1-b);1>f&&(e=(b-.5*f)/(1-f));return[a[0],100*f,100*e]};c.hsv.hcg=function(a){var f=a[2]/100,b=a[1]/100*f,e=0;1>b&&(e=(f-b)/(1-b));return[a[0],100*b,100*e]};c.hcg.rgb=function(a){var f=a[1]/100,b=a[2]/100;if(0===f)return[255*b,255*b,255*b];var e=[0,0,0];a=a[0]/360%1*6;var c=a%1,d=1-c;switch(Math.floor(a)){case 0:e[0]=1;e[1]=c;e[2]=0;break;case 1:e[0]=d;e[1]=1;
e[2]=0;break;case 2:e[0]=0;e[1]=1;e[2]=c;break;case 3:e[0]=0;e[1]=d;e[2]=1;break;case 4:e[0]=c;e[1]=0;e[2]=1;break;default:e[0]=1,e[1]=0,e[2]=d}b*=1-f;return[255*(f*e[0]+b),255*(f*e[1]+b),255*(f*e[2]+b)]};c.hcg.hsv=function(a){var f=a[1]/100,b=f+a[2]/100*(1-f),e=0;0<b&&(e=f/b);return[a[0],100*e,100*b]};c.hcg.hsl=function(a){var f=a[1]/100,b=a[2]/100*(1-f)+.5*f,e=0;0<b&&.5>b?e=f/(2*b):.5<=b&&1>b&&(e=f/(2*(1-b)));return[a[0],100*e,100*b]};c.hcg.hwb=function(a){var f=a[1]/100,b=f+a[2]/100*(1-f);return[a[0],
100*(b-f),100*(1-b)]};c.hwb.hcg=function(a){var f=1-a[2]/100,b=f-a[1]/100,e=0;1>b&&(e=(f-b)/(1-b));return[a[0],100*b,100*e]};c.apple.rgb=function(a){return[a[0]/65535*255,a[1]/65535*255,a[2]/65535*255]};c.rgb.apple=function(a){return[a[0]/255*65535,a[1]/255*65535,a[2]/255*65535]};c.gray.rgb=function(a){return[a[0]/100*255,a[0]/100*255,a[0]/100*255]};c.gray.hsl=c.gray.hsv=function(a){return[0,0,a[0]]};c.gray.hwb=function(a){return[0,100,a[0]]};c.gray.cmyk=function(a){return[0,0,0,a[0]]};c.gray.lab=
function(a){return[a[0],0,0]};c.gray.hex=function(a){a=Math.round(a[0]/100*255)&255;a=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(a.length)+a};c.rgb.gray=function(a){return[(a[0]+a[1]+a[2])/3/255*100]}}),Pc=function(r){for(var g={},c=Object.keys(Ca),d=c.length,b=0;b<d;b++)g[c[b]]={distance:-1,parent:null};c=[r];for(g[r].distance=0;c.length;){r=c.pop();d=Object.keys(Ca[r]);b=d.length;for(var a=0;a<b;a++){var f=d[a],k=g[f];-1===k.distance&&(k.distance=g[r].distance+1,k.parent=
r,c.unshift(f))}}c={};r=Object.keys(g);d=r.length;for(b=0;b<d;b++){var e=r[b];if(null!==g[e].parent){a=e;f=g;k=[f[e].parent,e];var l=Ca[f[e].parent][e];for(e=f[e].parent;f[e].parent;)k.unshift(f[e].parent),l=Fc(Ca[f[e].parent][e],l),e=f[e].parent;l.conversion=k;c[a]=l}}return c},V="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"===typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},x=function(r,g){if(!(r instanceof
g))throw new TypeError("Cannot call a class as a function");},y=function(){function r(g,c){for(var d=0;d<c.length;d++){var b=c[d];b.enumerable=b.enumerable||!1;b.configurable=!0;"value"in b&&(b.writable=!0);Object.defineProperty(g,b.key,b)}}return function(g,c,d){c&&r(g.prototype,c);d&&r(g,d);return g}}(),Qa=function(r,g,c){g in r?Object.defineProperty(r,g,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[g]=c;return r},Ya=function b(g,c,d){null===g&&(g=Function.prototype);var a=Object.getOwnPropertyDescriptor(g,
c);if(void 0===a){if(g=Object.getPrototypeOf(g),null!==g)return b(g,c,d)}else{if("value"in a)return a.value;c=a.get;return void 0===c?void 0:c.call(d)}},H=function(g,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);g.prototype=Object.create(c&&c.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(g,c):g.__proto__=c)},G=function(g,c){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!c||"object"!==typeof c&&"function"!==typeof c?g:c},lb=function(g){if(Array.isArray(g)){for(var c=0,d=Array(g.length);c<g.length;c++)d[c]=g[c];return d}return Array.from(g)},Za={};Object.keys(Ca).forEach(function(g){Za[g]={};Object.defineProperty(Za[g],"channels",{value:Ca[g].channels});Object.defineProperty(Za[g],"labels",{value:Ca[g].labels});var c=Pc(g);Object.keys(c).forEach(function(d){var b=c[d];Za[g][d]=Hc(b);Za[g][d].raw=Gc(b)})});var fa=Za,Hb=[].slice,dc=["keyword","gray","hex"],Ib=
{};Object.keys(fa).forEach(function(g){Ib[Hb.call(fa[g].labels).sort().join("")]=g});var Oa={};T.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(g){var c=this.model in fb.to?this:this.rgb();c=c.round("number"===typeof g?g:1);g=1===c.valpha?c.color:c.color.concat(this.valpha);return fb.to[c.model](g)},percentString:function(g){g=this.rgb().round("number"===typeof g?g:1);g=1===g.valpha?g.color:g.color.concat(this.valpha);return fb.to.rgb.percent(g)},
array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var g={},c=fa[this.model].channels,d=fa[this.model].labels,b=0;b<c;b++)g[d[b]]=this.color[b];1!==this.valpha&&(g.alpha=this.valpha);return g},unitArray:function(){var g=this.rgb().color;g[0]/=255;g[1]/=255;g[2]/=255;1!==this.valpha&&g.push(this.valpha);return g},unitObject:function(){var g=this.rgb().object();g.r/=255;g.g/=255;g.b/=255;1!==this.valpha&&(g.alpha=this.valpha);return g},round:function(g){g=
Math.max(g||0,0);return new T(this.color.map(Ic(g)).concat(this.valpha),this.model)},alpha:function(g){return arguments.length?new T(this.color.concat(Math.max(0,Math.min(1,g))),this.model):this.valpha},red:M("rgb",0,P(255)),green:M("rgb",1,P(255)),blue:M("rgb",2,P(255)),hue:M(["hsl","hsv","hsl","hwb","hcg"],0,function(g){return(g%360+360)%360}),saturationl:M("hsl",1,P(100)),lightness:M("hsl",2,P(100)),saturationv:M("hsv",1,P(100)),value:M("hsv",2,P(100)),chroma:M("hcg",1,P(100)),gray:M("hcg",2,P(100)),
white:M("hwb",1,P(100)),wblack:M("hwb",2,P(100)),cyan:M("cmyk",0,P(100)),magenta:M("cmyk",1,P(100)),yellow:M("cmyk",2,P(100)),black:M("cmyk",3,P(100)),x:M("xyz",0,P(100)),y:M("xyz",1,P(100)),z:M("xyz",2,P(100)),l:M("lab",0,P(100)),a:M("lab",1),b:M("lab",2),keyword:function(g){return arguments.length?new T(g):fa[this.model].keyword(this.color)},hex:function(g){return arguments.length?new T(g):fb.to.hex(this.rgb().round().color)},rgbNumber:function(){var g=this.rgb().color;return(g[0]&255)<<16|(g[1]&
255)<<8|g[2]&255},luminosity:function(){for(var g=this.rgb().color,c=[],d=0;d<g.length;d++){var b=g[d]/255;c[d]=.03928>=b?b/12.92:Math.pow((b+.055)/1.055,2.4)}return.2126*c[0]+.7152*c[1]+.0722*c[2]},contrast:function(g){var c=this.luminosity();g=g.luminosity();return c>g?(c+.05)/(g+.05):(g+.05)/(c+.05)},level:function(g){g=this.contrast(g);return 7.1<=g?"AAA":4.5<=g?"AA":""},isDark:function(){var g=this.rgb().color;return 128>(299*g[0]+587*g[1]+114*g[2])/1E3},isLight:function(){return!this.isDark()},
negate:function(){for(var g=this.rgb(),c=0;3>c;c++)g.color[c]=255-g.color[c];return g},lighten:function(g){var c=this.hsl();c.color[2]+=c.color[2]*g;return c},darken:function(g){var c=this.hsl();c.color[2]-=c.color[2]*g;return c},saturate:function(g){var c=this.hsl();c.color[1]+=c.color[1]*g;return c},desaturate:function(g){var c=this.hsl();c.color[1]-=c.color[1]*g;return c},whiten:function(g){var c=this.hwb();c.color[1]+=c.color[1]*g;return c},blacken:function(g){var c=this.hwb();c.color[2]+=c.color[2]*
g;return c},grayscale:function(){var g=this.rgb().color;g=.3*g[0]+.59*g[1]+.11*g[2];return T.rgb(g,g,g)},fade:function(g){return this.alpha(this.valpha-this.valpha*g)},opaquer:function(g){return this.alpha(this.valpha+this.valpha*g)},rotate:function(g){var c=this.hsl(),d=c.color[0];d=(d+g)%360;c.color[0]=0>d?360+d:d;return c},mix:function(g,c){if(!g||!g.rgb)throw Error('Argument to "mix" was not a Color instance, but rather an instance of '+("undefined"===typeof g?"undefined":V(g)));g=g.rgb();var d=
this.rgb();c=void 0===c?.5:c;var b=2*c-1,a=g.alpha()-d.alpha();b=((-1===b*a?b:(b+a)/(1+b*a))+1)/2;a=1-b;return T.rgb(b*g.red()+a*d.red(),b*g.green()+a*d.green(),b*g.blue()+a*d.blue(),g.alpha()*c+d.alpha()*(1-c))}};Object.keys(fa).forEach(function(g){if(-1===dc.indexOf(g)){var c=fa[g].channels;T.prototype[g]=function(){if(this.model===g)return new T(this);if(arguments.length)return new T(arguments,g);var d="number"===typeof arguments[c]?c:this.valpha;var b=fa[this.model][g].raw(this.color);b=Array.isArray(b)?
b:[b];return new T(b.concat(d),g)};T[g]=function(d){"number"===typeof d&&(d=tb(Hb.call(arguments),c));return new T(d,g)}}});var ra=ea(function(g,c){Object.defineProperty(c,"__esModule",{value:!0});c.setMatrixArrayType=function(a){c.ARRAY_TYPE=b=a};c.toRadian=function(f){return f*a};c.equals=function(a,b){return Math.abs(a-b)<=d*Math.max(1,Math.abs(a),Math.abs(b))};c.RANDOM=c.ARRAY_TYPE=c.EPSILON=void 0;var d=1E-6;c.EPSILON=d;var b="undefined"!==typeof Float32Array?Float32Array:Array;c.ARRAY_TYPE=
b;c.RANDOM=Math.random;var a=Math.PI/180});U(ra);var nc=ea(function(g,c){function d(a,b,e){var f=b[0],c=b[1],d=b[2];b=b[3];var h=e[0],p=e[1],k=e[2];e=e[3];a[0]=f*h+d*p;a[1]=c*h+b*p;a[2]=f*k+d*e;a[3]=c*k+b*e;return a}function b(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];return a}Object.defineProperty(c,"__esModule",{value:!0});c.create=function(){var f=new a.ARRAY_TYPE(4);a.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0);f[0]=1;f[3]=1;return f};c.clone=function(f){var b=new a.ARRAY_TYPE(4);
b[0]=f[0];b[1]=f[1];b[2]=f[2];b[3]=f[3];return b};c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};c.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a};c.fromValues=function(f,b,e,c){var l=new a.ARRAY_TYPE(4);l[0]=f;l[1]=b;l[2]=e;l[3]=c;return l};c.set=function(a,b,e,c,d){a[0]=b;a[1]=e;a[2]=c;a[3]=d;return a};c.transpose=function(a,b){if(a===b){var e=b[1];a[1]=b[2];a[2]=e}else a[0]=b[0],a[1]=b[2],a[2]=b[1],a[3]=b[3];return a};c.invert=function(a,b){var e=b[0],f=b[1],
c=b[2];b=b[3];var d=e*b-c*f;if(!d)return null;d=1/d;a[0]=b*d;a[1]=-f*d;a[2]=-c*d;a[3]=e*d;return a};c.adjoint=function(a,b){var e=b[0];a[0]=b[3];a[1]=-b[1];a[2]=-b[2];a[3]=e;return a};c.determinant=function(a){return a[0]*a[3]-a[2]*a[1]};c.multiply=d;c.rotate=function(a,b,e){var f=b[0],c=b[1],d=b[2];b=b[3];var h=Math.sin(e);e=Math.cos(e);a[0]=f*e+d*h;a[1]=c*e+b*h;a[2]=f*-h+d*e;a[3]=c*-h+b*e;return a};c.scale=function(a,b,e){var f=b[1],c=b[2],d=b[3],h=e[0];e=e[1];a[0]=b[0]*h;a[1]=f*h;a[2]=c*e;a[3]=
d*e;return a};c.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;return a};c.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];return a};c.str=function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))};c.LDU=function(a,b,e,c){a[2]=c[2]/c[0];e[0]=c[0];e[1]=c[1];e[3]=c[3]-a[2]*e[1];return[a,b,e]};c.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+
e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];return a};c.subtract=b;c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};c.equals=function(b,c){var e=b[0],f=b[1],d=b[2];b=b[3];var k=c[0],h=c[1],p=c[2];c=c[3];return Math.abs(e-k)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(k))&&Math.abs(f-h)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(h))&&Math.abs(d-p)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(p))&&Math.abs(b-c)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(c))};c.multiplyScalar=
function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;return a};c.multiplyScalarAndAdd=function(a,b,e,c){a[0]=b[0]+e[0]*c;a[1]=b[1]+e[1]*c;a[2]=b[2]+e[2]*c;a[3]=b[3]+e[3]*c;return a};c.sub=c.mul=void 0;var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var f=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,e):{};f.get||f.set?Object.defineProperty(b,e,f):b[e]=a[e]}b.default=
a;return b}(ra);c.mul=d;c.sub=b});U(nc);var oc=ea(function(g,c){function d(a,b,e){var f=b[0],c=b[1],d=b[2],h=b[3],p=b[4];b=b[5];var m=e[0],k=e[1],D=e[2],g=e[3],W=e[4];e=e[5];a[0]=f*m+d*k;a[1]=c*m+h*k;a[2]=f*D+d*g;a[3]=c*D+h*g;a[4]=f*W+d*e+p;a[5]=c*W+h*e+b;return a}function b(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];return a}Object.defineProperty(c,"__esModule",{value:!0});c.create=function(){var b=new a.ARRAY_TYPE(6);a.ARRAY_TYPE!=Float32Array&&
(b[1]=0,b[2]=0,b[4]=0,b[5]=0);b[0]=1;b[3]=1;return b};c.clone=function(b){var f=new a.ARRAY_TYPE(6);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];return f};c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};c.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;return a};c.fromValues=function(b,c,e,d,n,g){var f=new a.ARRAY_TYPE(6);f[0]=b;f[1]=c;f[2]=e;f[3]=d;f[4]=n;f[5]=g;return f};c.set=function(a,b,e,c,d,g,h){a[0]=b;a[1]=e;a[2]=c;a[3]=
d;a[4]=g;a[5]=h;return a};c.invert=function(a,b){var e=b[0],f=b[1],c=b[2],d=b[3],h=b[4];b=b[5];var p=e*d-f*c;if(!p)return null;p=1/p;a[0]=d*p;a[1]=-f*p;a[2]=-c*p;a[3]=e*p;a[4]=(c*b-d*h)*p;a[5]=(f*h-e*b)*p;return a};c.determinant=function(a){return a[0]*a[3]-a[1]*a[2]};c.multiply=d;c.rotate=function(a,b,e){var f=b[0],c=b[1],d=b[2],h=b[3],p=b[4];b=b[5];var m=Math.sin(e);e=Math.cos(e);a[0]=f*e+d*m;a[1]=c*e+h*m;a[2]=f*-m+d*e;a[3]=c*-m+h*e;a[4]=p;a[5]=b;return a};c.scale=function(a,b,e){var c=b[1],f=b[2],
d=b[3],h=b[4],p=b[5],m=e[0];e=e[1];a[0]=b[0]*m;a[1]=c*m;a[2]=f*e;a[3]=d*e;a[4]=h;a[5]=p;return a};c.translate=function(a,b,e){var c=b[0],f=b[1],d=b[2],h=b[3],p=b[4];b=b[5];var m=e[0];e=e[1];a[0]=c;a[1]=f;a[2]=d;a[3]=h;a[4]=c*m+d*e+p;a[5]=f*m+h*e+b;return a};c.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=-e;a[3]=b;a[4]=0;a[5]=0;return a};c.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=b[1];a[4]=0;a[5]=0;return a};c.fromTranslation=function(a,b){a[0]=1;a[1]=
0;a[2]=0;a[3]=1;a[4]=b[0];a[5]=b[1];return a};c.str=function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)};c.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];return a};c.subtract=b;c.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=
b[4]*e;a[5]=b[5]*e;return a};c.multiplyScalarAndAdd=function(a,b,e,c){a[0]=b[0]+e[0]*c;a[1]=b[1]+e[1]*c;a[2]=b[2]+e[2]*c;a[3]=b[3]+e[3]*c;a[4]=b[4]+e[4]*c;a[5]=b[5]+e[5]*c;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]};c.equals=function(b,c){var e=b[0],f=b[1],d=b[2],k=b[3],h=b[4];b=b[5];var p=c[0],m=c[1],t=c[2],D=c[3],g=c[4];c=c[5];return Math.abs(e-p)<=a.EPSILON*Math.max(1,Math.abs(e),Math.abs(p))&&Math.abs(f-m)<=a.EPSILON*
Math.max(1,Math.abs(f),Math.abs(m))&&Math.abs(d-t)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(k-D)<=a.EPSILON*Math.max(1,Math.abs(k),Math.abs(D))&&Math.abs(h-g)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(b-c)<=a.EPSILON*Math.max(1,Math.abs(b),Math.abs(c))};c.sub=c.mul=void 0;var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,
e):{};c.get||c.set?Object.defineProperty(b,e,c):b[e]=a[e]}b.default=a;return b}(ra);c.mul=d;c.sub=b});U(oc);var Nb=ea(function(g,c){function d(a,b,e){var c=b[0],f=b[1],d=b[2],h=b[3],p=b[4],m=b[5],t=b[6],k=b[7];b=b[8];var g=e[0],W=e[1],w=e[2],A=e[3],B=e[4],C=e[5],E=e[6],F=e[7];e=e[8];a[0]=g*c+W*h+w*t;a[1]=g*f+W*p+w*k;a[2]=g*d+W*m+w*b;a[3]=A*c+B*h+C*t;a[4]=A*f+B*p+C*k;a[5]=A*d+B*m+C*b;a[6]=E*c+F*h+e*t;a[7]=E*f+F*p+e*k;a[8]=E*d+F*m+e*b;return a}function b(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];a[2]=b[2]-
e[2];a[3]=b[3]-e[3];a[4]=b[4]-e[4];a[5]=b[5]-e[5];a[6]=b[6]-e[6];a[7]=b[7]-e[7];a[8]=b[8]-e[8];return a}Object.defineProperty(c,"__esModule",{value:!0});c.create=function(){var b=new a.ARRAY_TYPE(9);a.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0,b[3]=0,b[5]=0,b[6]=0,b[7]=0);b[0]=1;b[4]=1;b[8]=1;return b};c.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};c.clone=function(b){var c=new a.ARRAY_TYPE(9);c[0]=b[0];c[1]=b[1];c[2]=b[2];
c[3]=b[3];c[4]=b[4];c[5]=b[5];c[6]=b[6];c[7]=b[7];c[8]=b[8];return c};c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};c.fromValues=function(b,c,e,d,g,q,h,p,m){var f=new a.ARRAY_TYPE(9);f[0]=b;f[1]=c;f[2]=e;f[3]=d;f[4]=g;f[5]=q;f[6]=h;f[7]=p;f[8]=m;return f};c.set=function(a,b,e,c,d,g,h,p,m,t){a[0]=b;a[1]=e;a[2]=c;a[3]=d;a[4]=g;a[5]=h;a[6]=p;a[7]=m;a[8]=t;return a};c.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=
0;a[6]=0;a[7]=0;a[8]=1;return a};c.transpose=function(a,b){if(a===b){var e=b[1],c=b[2],f=b[5];a[1]=b[3];a[2]=b[6];a[3]=e;a[5]=b[7];a[6]=c;a[7]=f}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a};c.invert=function(a,b){var e=b[0],c=b[1],f=b[2],d=b[3],h=b[4],p=b[5],m=b[6],t=b[7];b=b[8];var D=b*h-p*t,k=-b*d+p*m,g=t*d-h*m,w=e*D+c*k+f*g;if(!w)return null;w=1/w;a[0]=D*w;a[1]=(-b*c+f*t)*w;a[2]=(p*c-f*h)*w;a[3]=k*w;a[4]=(b*e-f*m)*w;a[5]=(-p*e+f*d)*w;
a[6]=g*w;a[7]=(-t*e+c*m)*w;a[8]=(h*e-c*d)*w;return a};c.adjoint=function(a,b){var e=b[0],c=b[1],f=b[2],d=b[3],h=b[4],p=b[5],m=b[6],t=b[7];b=b[8];a[0]=h*b-p*t;a[1]=f*t-c*b;a[2]=c*p-f*h;a[3]=p*m-d*b;a[4]=e*b-f*m;a[5]=f*d-e*p;a[6]=d*t-h*m;a[7]=c*m-e*t;a[8]=e*h-c*d;return a};c.determinant=function(a){var b=a[3],e=a[4],c=a[5],f=a[6],d=a[7],h=a[8];return a[0]*(h*e-c*d)+a[1]*(-h*b+c*f)+a[2]*(d*b-e*f)};c.multiply=d;c.translate=function(a,b,e){var c=b[0],f=b[1],d=b[2],h=b[3],p=b[4],m=b[5],t=b[6],D=b[7];b=
b[8];var g=e[0];e=e[1];a[0]=c;a[1]=f;a[2]=d;a[3]=h;a[4]=p;a[5]=m;a[6]=g*c+e*h+t;a[7]=g*f+e*p+D;a[8]=g*d+e*m+b;return a};c.rotate=function(a,b,e){var c=b[0],f=b[1],d=b[2],h=b[3],p=b[4],m=b[5],t=b[6],D=b[7];b=b[8];var g=Math.sin(e);e=Math.cos(e);a[0]=e*c+g*h;a[1]=e*f+g*p;a[2]=e*d+g*m;a[3]=e*h-g*c;a[4]=e*p-g*f;a[5]=e*m-g*d;a[6]=t;a[7]=D;a[8]=b;return a};c.scale=function(a,b,e){var c=e[0];e=e[1];a[0]=c*b[0];a[1]=c*b[1];a[2]=c*b[2];a[3]=e*b[3];a[4]=e*b[4];a[5]=e*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};
c.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};c.fromRotation=function(a,b){var e=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=e;a[2]=0;a[3]=-e;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};c.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};c.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};c.fromQuat=function(a,b){var e=
b[0],c=b[1],d=b[2];b=b[3];var f=e+e,h=c+c,p=d+d;e*=f;var m=c*f;c*=h;var t=d*f,D=d*h;d*=p;f*=b;h*=b;b*=p;a[0]=1-c-d;a[3]=m-b;a[6]=t+h;a[1]=m+b;a[4]=1-e-d;a[7]=D-f;a[2]=t-h;a[5]=D+f;a[8]=1-e-c;return a};c.normalFromMat4=function(a,b){var e=b[0],c=b[1],d=b[2],f=b[3],h=b[4],p=b[5],m=b[6],t=b[7],D=b[8],g=b[9],k=b[10],w=b[11],A=b[12],B=b[13],C=b[14];b=b[15];var E=e*p-c*h,F=e*m-d*h,$a=e*t-f*h,N=c*m-d*p,S=c*t-f*p,$b=d*t-f*m,v=D*B-g*A,x=D*C-k*A;D=D*b-w*A;var y=g*C-k*B;g=g*b-w*B;k=k*b-w*C;w=E*k-F*g+$a*y+N*
D-S*x+$b*v;if(!w)return null;w=1/w;a[0]=(p*k-m*g+t*y)*w;a[1]=(m*D-h*k-t*x)*w;a[2]=(h*g-p*D+t*v)*w;a[3]=(d*g-c*k-f*y)*w;a[4]=(e*k-d*D+f*x)*w;a[5]=(c*D-e*g-f*v)*w;a[6]=(B*$b-C*S+b*N)*w;a[7]=(C*$a-A*$b-b*F)*w;a[8]=(A*S-B*$a+b*E)*w;return a};c.projection=function(a,b,e){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/e;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};c.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],
2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};c.add=function(a,b,e){a[0]=b[0]+e[0];a[1]=b[1]+e[1];a[2]=b[2]+e[2];a[3]=b[3]+e[3];a[4]=b[4]+e[4];a[5]=b[5]+e[5];a[6]=b[6]+e[6];a[7]=b[7]+e[7];a[8]=b[8]+e[8];return a};c.subtract=b;c.multiplyScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*e;a[5]=b[5]*e;a[6]=b[6]*e;a[7]=b[7]*e;a[8]=b[8]*e;return a};c.multiplyScalarAndAdd=function(a,
b,e,c){a[0]=b[0]+e[0]*c;a[1]=b[1]+e[1]*c;a[2]=b[2]+e[2]*c;a[3]=b[3]+e[3]*c;a[4]=b[4]+e[4]*c;a[5]=b[5]+e[5]*c;a[6]=b[6]+e[6]*c;a[7]=b[7]+e[7]*c;a[8]=b[8]+e[8]*c;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};c.equals=function(b,c){var e=b[0],d=b[1],f=b[2],g=b[3],h=b[4],p=b[5],m=b[6],t=b[7];b=b[8];var D=c[0],mb=c[1],k=c[2],w=c[3],A=c[4],B=c[5],C=c[6],E=c[7];c=c[8];return Math.abs(e-D)<=
a.EPSILON*Math.max(1,Math.abs(e),Math.abs(D))&&Math.abs(d-mb)<=a.EPSILON*Math.max(1,Math.abs(d),Math.abs(mb))&&Math.abs(f-k)<=a.EPSILON*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(g-w)<=a.EPSILON*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-A)<=a.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-B)<=a.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(m-C)<=a.EPSILON*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(t-E)<=a.EPSILON*Math.max(1,Math.abs(t),Math.abs(E))&&Math.abs(b-c)<=a.EPSILON*
Math.max(1,Math.abs(b),Math.abs(c))};c.sub=c.mul=void 0;var a=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var e in a)if(Object.prototype.hasOwnProperty.call(a,e)){var c=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,e):{};c.get||c.set?Object.defineProperty(b,e,c):b[e]=a[e]}b.default=a;return b}(ra);c.mul=d;c.sub=b});U(Nb);var Pb=ea(function(g,c){function d(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;
a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function b(a,b,c){var e=b[0],h=b[1],d=b[2],f=b[3],l=b[4],D=b[5],g=b[6],n=b[7],k=b[8],A=b[9],B=b[10],C=b[11],E=b[12],F=b[13],$a=b[14];b=b[15];var N=c[0],S=c[1],v=c[2],x=c[3];a[0]=N*e+S*l+v*k+x*E;a[1]=N*h+S*D+v*A+x*F;a[2]=N*d+S*g+v*B+x*$a;a[3]=N*f+S*n+v*C+x*b;N=c[4];S=c[5];v=c[6];x=c[7];a[4]=N*e+S*l+v*k+x*E;a[5]=N*h+S*D+v*A+x*F;a[6]=N*d+S*g+v*B+x*$a;a[7]=N*f+S*n+v*C+x*b;N=c[8];S=c[9];v=c[10];x=c[11];a[8]=N*e+S*l+v*k+x*E;a[9]=N*h+S*D+v*A+x*F;a[10]=N*d+
S*g+v*B+x*$a;a[11]=N*f+S*n+v*C+x*b;N=c[12];S=c[13];v=c[14];x=c[15];a[12]=N*e+S*l+v*k+x*E;a[13]=N*h+S*D+v*A+x*F;a[14]=N*d+S*g+v*B+x*$a;a[15]=N*f+S*n+v*C+x*b;return a}function a(a,b,c){var e=b[0],h=b[1],d=b[2],f=b[3],l=e+e,D=h+h,g=d+d;b=e*l;var n=e*D;e*=g;var k=h*D;h*=g;d*=g;l*=f;D*=f;f*=g;a[0]=1-(k+d);a[1]=n+f;a[2]=e-D;a[3]=0;a[4]=n-f;a[5]=1-(b+d);a[6]=h+l;a[7]=0;a[8]=e+D;a[9]=h-l;a[10]=1-(b+k);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a}function f(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];
a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-c[13];a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(c,"__esModule",{value:!0});c.create=function(){var a=new k.ARRAY_TYPE(16);k.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0);a[0]=1;a[5]=1;a[10]=1;a[15]=1;return a};c.clone=function(a){var b=
new k.ARRAY_TYPE(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.fromValues=function(a,b,c,d,h,f,m,t,D,g,W,w,A,B,C,E){var e=new k.ARRAY_TYPE(16);e[0]=a;e[1]=b;
e[2]=c;e[3]=d;e[4]=h;e[5]=f;e[6]=m;e[7]=t;e[8]=D;e[9]=g;e[10]=W;e[11]=w;e[12]=A;e[13]=B;e[14]=C;e[15]=E;return e};c.set=function(a,b,c,d,h,f,m,t,D,g,k,w,A,B,C,E,F){a[0]=b;a[1]=c;a[2]=d;a[3]=h;a[4]=f;a[5]=m;a[6]=t;a[7]=D;a[8]=g;a[9]=k;a[10]=w;a[11]=A;a[12]=B;a[13]=C;a[14]=E;a[15]=F;return a};c.identity=d;c.transpose=function(a,b){if(a===b){var c=b[1],e=b[2],d=b[3],f=b[6],m=b[7],t=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=e;a[9]=f;a[11]=b[14];a[12]=d;a[13]=m;a[14]=t}else a[0]=
b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};c.invert=function(a,b){var c=b[0],e=b[1],d=b[2],f=b[3],m=b[4],t=b[5],l=b[6],g=b[7],k=b[8],w=b[9],A=b[10],B=b[11],C=b[12],E=b[13],F=b[14];b=b[15];var v=c*t-e*m,N=c*l-d*m,x=c*g-f*m,y=e*l-d*t,H=e*g-f*t,G=d*g-f*l,K=k*E-w*C,Ob=k*F-A*C,M=k*b-B*C,J=w*F-A*E,V=w*b-B*E,T=A*b-B*F,O=v*T-N*V+x*J+y*M-H*Ob+G*K;if(!O)return null;O=1/O;a[0]=
(t*T-l*V+g*J)*O;a[1]=(d*V-e*T-f*J)*O;a[2]=(E*G-F*H+b*y)*O;a[3]=(A*H-w*G-B*y)*O;a[4]=(l*M-m*T-g*Ob)*O;a[5]=(c*T-d*M+f*Ob)*O;a[6]=(F*x-C*G-b*N)*O;a[7]=(k*G-A*x+B*N)*O;a[8]=(m*V-t*M+g*K)*O;a[9]=(e*M-c*V-f*K)*O;a[10]=(C*H-E*x+b*v)*O;a[11]=(w*x-k*H-B*v)*O;a[12]=(t*Ob-m*J-l*K)*O;a[13]=(c*J-e*Ob+d*K)*O;a[14]=(E*N-C*y-F*v)*O;a[15]=(k*y-w*N+A*v)*O;return a};c.adjoint=function(a,b){var c=b[0],e=b[1],d=b[2],f=b[3],m=b[4],t=b[5],l=b[6],g=b[7],k=b[8],w=b[9],A=b[10],B=b[11],C=b[12],E=b[13],F=b[14];b=b[15];a[0]=
t*(A*b-B*F)-w*(l*b-g*F)+E*(l*B-g*A);a[1]=-(e*(A*b-B*F)-w*(d*b-f*F)+E*(d*B-f*A));a[2]=e*(l*b-g*F)-t*(d*b-f*F)+E*(d*g-f*l);a[3]=-(e*(l*B-g*A)-t*(d*B-f*A)+w*(d*g-f*l));a[4]=-(m*(A*b-B*F)-k*(l*b-g*F)+C*(l*B-g*A));a[5]=c*(A*b-B*F)-k*(d*b-f*F)+C*(d*B-f*A);a[6]=-(c*(l*b-g*F)-m*(d*b-f*F)+C*(d*g-f*l));a[7]=c*(l*B-g*A)-m*(d*B-f*A)+k*(d*g-f*l);a[8]=m*(w*b-B*E)-k*(t*b-g*E)+C*(t*B-g*w);a[9]=-(c*(w*b-B*E)-k*(e*b-f*E)+C*(e*B-f*w));a[10]=c*(t*b-g*E)-m*(e*b-f*E)+C*(e*g-f*t);a[11]=-(c*(t*B-g*w)-m*(e*B-f*w)+k*(e*g-
f*t));a[12]=-(m*(w*F-A*E)-k*(t*F-l*E)+C*(t*A-l*w));a[13]=c*(w*F-A*E)-k*(e*F-d*E)+C*(e*A-d*w);a[14]=-(c*(t*F-l*E)-m*(e*F-d*E)+C*(e*l-d*t));a[15]=c*(t*A-l*w)-m*(e*A-d*w)+k*(e*l-d*t);return a};c.determinant=function(a){var b=a[0],c=a[1],e=a[2],d=a[3],f=a[4],m=a[5],t=a[6],g=a[7],k=a[8],W=a[9],w=a[10],A=a[11],B=a[12],C=a[13],E=a[14];a=a[15];return(b*m-c*f)*(w*a-A*E)-(b*t-e*f)*(W*a-A*C)+(b*g-d*f)*(W*E-w*C)+(c*t-e*m)*(k*a-A*B)-(c*g-d*m)*(k*E-w*B)+(e*g-d*t)*(k*C-W*B)};c.multiply=b;c.translate=function(a,
b,c){var e=c[0],d=c[1];c=c[2];if(b===a)a[12]=b[0]*e+b[4]*d+b[8]*c+b[12],a[13]=b[1]*e+b[5]*d+b[9]*c+b[13],a[14]=b[2]*e+b[6]*d+b[10]*c+b[14],a[15]=b[3]*e+b[7]*d+b[11]*c+b[15];else{var f=b[0];var m=b[1];var t=b[2];var l=b[3];var g=b[4];var k=b[5];var n=b[6];var A=b[7];var B=b[8];var C=b[9];var E=b[10];var F=b[11];a[0]=f;a[1]=m;a[2]=t;a[3]=l;a[4]=g;a[5]=k;a[6]=n;a[7]=A;a[8]=B;a[9]=C;a[10]=E;a[11]=F;a[12]=f*e+g*d+B*c+b[12];a[13]=m*e+k*d+C*c+b[13];a[14]=t*e+n*d+E*c+b[14];a[15]=l*e+A*d+F*c+b[15]}return a};
c.scale=function(a,b,c){var e=c[0],d=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*d;a[5]=b[5]*d;a[6]=b[6]*d;a[7]=b[7]*d;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};c.rotate=function(a,b,c,d){var e=d[0],f=d[1];d=d[2];var m=Math.sqrt(e*e+f*f+d*d);if(m<k.EPSILON)return null;m=1/m;e*=m;f*=m;d*=m;var t=Math.sin(c);var g=Math.cos(c);var l=1-g;c=b[0];m=b[1];var n=b[2];var q=b[3];var A=b[4];var B=b[5];var C=b[6];var E=
b[7];var F=b[8];var v=b[9];var x=b[10];var S=b[11];var y=e*e*l+g;var H=f*e*l+d*t;var G=d*e*l-f*t;var K=e*f*l-d*t;var M=f*f*l+g;var J=d*f*l+e*t;var V=e*d*l+f*t;e=f*d*l-e*t;f=d*d*l+g;a[0]=c*y+A*H+F*G;a[1]=m*y+B*H+v*G;a[2]=n*y+C*H+x*G;a[3]=q*y+E*H+S*G;a[4]=c*K+A*M+F*J;a[5]=m*K+B*M+v*J;a[6]=n*K+C*M+x*J;a[7]=q*K+E*M+S*J;a[8]=c*V+A*e+F*f;a[9]=m*V+B*e+v*f;a[10]=n*V+C*e+x*f;a[11]=q*V+E*e+S*f;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};c.rotateX=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);
var d=b[4],f=b[5],m=b[6],t=b[7],g=b[8],l=b[9],k=b[10],n=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=d*c+g*e;a[5]=f*c+l*e;a[6]=m*c+k*e;a[7]=t*c+n*e;a[8]=g*c-d*e;a[9]=l*c-f*e;a[10]=k*c-m*e;a[11]=n*c-t*e;return a};c.rotateY=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var d=b[0],f=b[1],m=b[2],t=b[3],g=b[8],l=b[9],k=b[10],n=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=d*c-
g*e;a[1]=f*c-l*e;a[2]=m*c-k*e;a[3]=t*c-n*e;a[8]=d*e+g*c;a[9]=f*e+l*c;a[10]=m*e+k*c;a[11]=t*e+n*c;return a};c.rotateZ=function(a,b,c){var e=Math.sin(c);c=Math.cos(c);var d=b[0],f=b[1],m=b[2],t=b[3],g=b[4],l=b[5],k=b[6],n=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=d*c+g*e;a[1]=f*c+l*e;a[2]=m*c+k*e;a[3]=t*c+n*e;a[4]=g*c-d*e;a[5]=l*c-f*e;a[6]=k*c-m*e;a[7]=n*c-t*e;return a};c.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=
0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};c.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotation=function(a,b,c){var e=c[0],d=c[1];c=c[2];var f=Math.sqrt(e*e+d*d+c*c);if(f<k.EPSILON)return null;f=1/f;e*=f;d*=f;c*=f;f=Math.sin(b);b=Math.cos(b);var m=1-b;a[0]=e*e*m+b;a[1]=d*e*m+c*f;a[2]=c*e*m-d*f;a[3]=0;a[4]=e*d*m-
c*f;a[5]=d*d*m+b;a[6]=c*d*m+e*f;a[7]=0;a[8]=e*c*m+d*f;a[9]=d*c*m-e*f;a[10]=c*c*m+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=
1;return a};c.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.fromRotationTranslation=a;c.fromQuat2=function(b,c){var e=new k.ARRAY_TYPE(3),d=-c[0],f=-c[1],p=-c[2],m=c[3],t=c[4],g=c[5],l=c[6],W=c[7],w=d*d+f*f+p*p+m*m;0<w?(e[0]=2*(t*m+W*d+g*p-l*f)/w,e[1]=2*(g*m+W*f+l*d-t*p)/w,e[2]=2*(l*m+W*p+t*f-g*d)/w):(e[0]=2*(t*m+W*d+g*p-l*f),e[1]=2*(g*m+W*f+l*d-t*p),e[2]=
2*(l*m+W*p+t*f-g*d));a(b,c,e);return b};c.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};c.getScaling=function(a,b){var c=b[0],e=b[1],d=b[2],f=b[4],m=b[5],t=b[6],g=b[8],l=b[9];b=b[10];a[0]=Math.sqrt(c*c+e*e+d*d);a[1]=Math.sqrt(f*f+m*m+t*t);a[2]=Math.sqrt(g*g+l*l+b*b);return a};c.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),
a[3]=(b[6]-b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+b[9])/c):(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};c.fromRotationTranslationScale=function(a,b,c,d){var e=b[0],f=b[1],m=b[2],t=b[3],g=e+e,l=f+f,k=m+m;b=e*g;var n=e*l;e*=k;var q=f*l;f*=k;m*=k;g*=t;l*=t;t*=k;k=d[0];var B=d[1];d=d[2];a[0]=(1-(q+m))*k;a[1]=(n+
t)*k;a[2]=(e-l)*k;a[3]=0;a[4]=(n-t)*B;a[5]=(1-(b+m))*B;a[6]=(f+g)*B;a[7]=0;a[8]=(e+l)*d;a[9]=(f-g)*d;a[10]=(1-(b+q))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};c.fromRotationTranslationScaleOrigin=function(a,b,c,d,f){var e=b[0],h=b[1],t=b[2],g=b[3],k=e+e,l=h+h,n=t+t;b=e*k;var q=e*l,B=e*n;e=h*l;h*=n;var C=t*n;t=g*k;l*=g;var E=g*n,F=d[0],v=d[1];n=d[2];d=f[0];g=f[1];f=f[2];k=(1-(e+C))*F;var x=(q+E)*F;F*=B-l;q=(q-E)*v;C=(1-(b+C))*v;v*=h+t;B=(B+l)*n;h=(h-t)*n;b=(1-(b+e))*n;a[0]=k;a[1]=
x;a[2]=F;a[3]=0;a[4]=q;a[5]=C;a[6]=v;a[7]=0;a[8]=B;a[9]=h;a[10]=b;a[11]=0;a[12]=c[0]+d-(k*d+q*g+B*f);a[13]=c[1]+g-(x*d+C*g+h*f);a[14]=c[2]+f-(F*d+v*g+b*f);a[15]=1;return a};c.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c+c,m=d+d,t=e+e;c*=f;var g=d*f;d*=m;var k=e*f,l=e*m;e*=t;f*=b;m*=b;b*=t;a[0]=1-d-e;a[1]=g+b;a[2]=k-m;a[3]=0;a[4]=g-b;a[5]=1-c-e;a[6]=l+f;a[7]=0;a[8]=k+m;a[9]=l-f;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};c.frustum=function(a,b,c,d,f,p,m){var e=1/
(c-b),h=1/(f-d),g=1/(p-m);a[0]=2*p*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*p*h;a[6]=0;a[7]=0;a[8]=(c+b)*e;a[9]=(f+d)*h;a[10]=(m+p)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=m*p*2*g;a[15]=0;return a};c.perspective=function(a,b,c,d,f){b=1/Math.tan(b/2);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[11]=-1;a[12]=0;a[13]=0;a[15]=0;null!=f&&Infinity!==f?(c=1/(d-f),a[10]=(f+d)*c,a[14]=2*f*d*c):(a[10]=-1,a[14]=-2*d);return a};c.perspectiveFromFieldOfView=function(a,b,c,d){var e=Math.tan(b.upDegrees*
Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),m=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var t=2/(m+b),g=2/(e+f);a[0]=t;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((m-b)*t*.5);a[9]=(e-f)*g*.5;a[10]=d/(c-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*c/(c-d);a[15]=0;return a};c.ortho=function(a,b,c,d,f,p,m){var e=1/(b-c),h=1/(d-f),g=1/(p-m);a[0]=-2*e;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*h;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*g;a[11]=0;a[12]=(b+c)*e;a[13]=(f+d)*
h;a[14]=(m+p)*g;a[15]=1;return a};c.lookAt=function(a,b,c,f){var e=b[0],p=b[1];b=b[2];var m=f[0];var t=f[1];var g=f[2];var l=c[0];f=c[1];var n=c[2];if(Math.abs(e-l)<k.EPSILON&&Math.abs(p-f)<k.EPSILON&&Math.abs(b-n)<k.EPSILON)return d(a);c=e-l;f=p-f;l=b-n;var w=1/Math.sqrt(c*c+f*f+l*l);c*=w;f*=w;l*=w;n=t*l-g*f;g=g*c-m*l;m=m*f-t*c;(w=Math.sqrt(n*n+g*g+m*m))?(w=1/w,n*=w,g*=w,m*=w):m=g=n=0;t=f*m-l*g;var q=l*n-c*m;var B=c*g-f*n;(w=Math.sqrt(t*t+q*q+B*B))?(w=1/w,t*=w,q*=w,B*=w):B=q=t=0;a[0]=n;a[1]=t;a[2]=
c;a[3]=0;a[4]=g;a[5]=q;a[6]=f;a[7]=0;a[8]=m;a[9]=B;a[10]=l;a[11]=0;a[12]=-(n*e+g*p+m*b);a[13]=-(t*e+q*p+B*b);a[14]=-(c*e+f*p+l*b);a[15]=1;return a};c.targetTo=function(a,b,c,d){var f=b[0],e=b[1];b=b[2];var m=d[0],t=d[1],g=d[2];d=f-c[0];var k=e-c[1];c=b-c[2];var l=d*d+k*k+c*c;0<l&&(l=1/Math.sqrt(l),d*=l,k*=l,c*=l);var n=t*c-g*k;g=g*d-m*c;m=m*k-t*d;l=n*n+g*g+m*m;0<l&&(l=1/Math.sqrt(l),n*=l,g*=l,m*=l);a[0]=n;a[1]=g;a[2]=m;a[3]=0;a[4]=k*m-c*g;a[5]=c*n-d*m;a[6]=d*g-k*n;a[7]=0;a[8]=d;a[9]=k;a[10]=c;a[11]=
0;a[12]=f;a[13]=e;a[14]=b;a[15]=1;return a};c.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};c.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+
Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};c.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};c.subtract=f;c.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=
b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};c.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;a[9]=b[9]+c[9]*d;a[10]=b[10]+c[10]*d;a[11]=b[11]+c[11]*d;a[12]=b[12]+c[12]*d;a[13]=b[13]+c[13]*d;a[14]=b[14]+c[14]*d;a[15]=b[15]+c[15]*d;return a};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&
a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};c.equals=function(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],m=a[4],t=a[5],g=a[6],l=a[7],W=a[8],w=a[9],A=a[10],B=a[11],C=a[12],E=a[13],F=a[14];a=a[15];var v=b[0],x=b[1],S=b[2],y=b[3],H=b[4],G=b[5],K=b[6],M=b[7],J=b[8],V=b[9],T=b[10],P=b[11],O=b[12],R=b[13],X=b[14];b=b[15];return Math.abs(c-v)<=k.EPSILON*Math.max(1,
Math.abs(c),Math.abs(v))&&Math.abs(d-x)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(f-S)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(e-y)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(y))&&Math.abs(m-H)<=k.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(t-G)<=k.EPSILON*Math.max(1,Math.abs(t),Math.abs(G))&&Math.abs(g-K)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(K))&&Math.abs(l-M)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(W-J)<=k.EPSILON*Math.max(1,Math.abs(W),
Math.abs(J))&&Math.abs(w-V)<=k.EPSILON*Math.max(1,Math.abs(w),Math.abs(V))&&Math.abs(A-T)<=k.EPSILON*Math.max(1,Math.abs(A),Math.abs(T))&&Math.abs(B-P)<=k.EPSILON*Math.max(1,Math.abs(B),Math.abs(P))&&Math.abs(C-O)<=k.EPSILON*Math.max(1,Math.abs(C),Math.abs(O))&&Math.abs(E-R)<=k.EPSILON*Math.max(1,Math.abs(E),Math.abs(R))&&Math.abs(F-X)<=k.EPSILON*Math.max(1,Math.abs(F),Math.abs(X))&&Math.abs(a-b)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.sub=c.mul=void 0;var k=function(a){if(a&&a.__esModule)return a;
var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ra);c.mul=b;c.sub=f});U(Pb);var yb=ea(function(g,c){function d(){var a=new m.ARRAY_TYPE(3);m.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);return a}function b(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)}function a(a,b,c){var d=new m.ARRAY_TYPE(3);
d[0]=a;d[1]=b;d[2]=c;return d}function f(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}function k(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a}function e(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a}function l(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)}function n(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}function q(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a}function h(a,b){var c=b[0],d=b[1],f=
b[2];c=c*c+d*d+f*f;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a}function p(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Object.defineProperty(c,"__esModule",{value:!0});c.create=d;c.clone=function(a){var b=new m.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};c.length=b;c.fromValues=a;c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a};c.set=function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a};c.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a};
c.subtract=f;c.multiply=k;c.divide=e;c.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};c.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};c.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};c.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};c.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);
a[2]=Math.round(b[2]);return a};c.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};c.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};c.distance=l;c.squaredDistance=n;c.squaredLength=q;c.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};c.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};c.normalize=h;c.dot=p;c.cross=function(a,b,c){var d=b[0],f=b[1];b=b[2];var e=c[0],h=c[1];c=c[2];a[0]=f*c-b*h;a[1]=b*e-d*
c;a[2]=d*h-f*e;return a};c.lerp=function(a,b,c,d){var f=b[0],e=b[1];b=b[2];a[0]=f+d*(c[0]-f);a[1]=e+d*(c[1]-e);a[2]=b+d*(c[2]-b);return a};c.hermite=function(a,b,c,d,f,e){var h=e*e,m=h*(2*e-3)+1,p=h*(e-2)+e,g=h*(e-1);e=h*(3-2*e);a[0]=b[0]*m+c[0]*p+d[0]*g+f[0]*e;a[1]=b[1]*m+c[1]*p+d[1]*g+f[1]*e;a[2]=b[2]*m+c[2]*p+d[2]*g+f[2]*e;return a};c.bezier=function(a,b,c,d,f,e){var h=1-e,m=h*h,p=e*e,g=m*h;m*=3*e;h*=3*p;e*=p;a[0]=b[0]*g+c[0]*m+d[0]*h+f[0]*e;a[1]=b[1]*g+c[1]*m+d[1]*h+f[1]*e;a[2]=b[2]*g+c[2]*m+
d[2]*h+f[2]*e;return a};c.random=function(a,b){b=b||1;var c=2*m.RANDOM()*Math.PI,d=2*m.RANDOM()-1,f=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*f;a[1]=Math.sin(c)*f;a[2]=d*b;return a};c.transformMat4=function(a,b,c){var d=b[0],f=b[1];b=b[2];var e=c[3]*d+c[7]*f+c[11]*b+c[15];e=e||1;a[0]=(c[0]*d+c[4]*f+c[8]*b+c[12])/e;a[1]=(c[1]*d+c[5]*f+c[9]*b+c[13])/e;a[2]=(c[2]*d+c[6]*f+c[10]*b+c[14])/e;return a};c.transformMat3=function(a,b,c){var d=b[0],f=b[1];b=b[2];a[0]=d*c[0]+f*c[3]+b*c[6];a[1]=d*c[1]+f*c[4]+b*c[7];
a[2]=d*c[2]+f*c[5]+b*c[8];return a};c.transformQuat=function(a,b,c){var d=c[0],f=c[1],e=c[2],h=b[0],m=b[1];b=b[2];var p=f*b-e*m,g=e*h-d*b,t=d*m-f*h;c=2*c[3];a[0]=h+p*c+2*(f*t-e*g);a[1]=m+g*c+2*(e*p-d*t);a[2]=b+t*c+2*(d*g-f*p);return a};c.rotateX=function(a,b,c,d){var f=[],e=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];e[0]=f[0];e[1]=f[1]*Math.cos(d)-f[2]*Math.sin(d);e[2]=f[1]*Math.sin(d)+f[2]*Math.cos(d);a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};c.rotateY=function(a,b,c,d){var f=[],
e=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];e[0]=f[2]*Math.sin(d)+f[0]*Math.cos(d);e[1]=f[1];e[2]=f[2]*Math.cos(d)-f[0]*Math.sin(d);a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};c.rotateZ=function(a,b,c,d){var f=[],e=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];e[0]=f[0]*Math.cos(d)-f[1]*Math.sin(d);e[1]=f[0]*Math.sin(d)+f[1]*Math.cos(d);e[2]=f[2];a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};c.angle=function(b,c){b=a(b[0],b[1],b[2]);c=a(c[0],c[1],c[2]);h(b,b);h(c,c);c=
p(b,c);return 1<c?0:-1>c?Math.PI:Math.acos(c)};c.zero=function(a){a[0]=0;a[1]=0;a[2]=0;return a};c.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};c.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var f=b[0],e=b[1];b=b[2];return Math.abs(c-f)<=m.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-e)<=m.EPSILON*Math.max(1,Math.abs(d),Math.abs(e))&&Math.abs(a-b)<=m.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.forEach=
c.sqrLen=c.len=c.sqrDist=c.dist=c.div=c.mul=c.sub=void 0;var m=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ra);c.sub=f;c.mul=k;c.div=e;c.dist=l;c.sqrDist=n;c.len=b;c.sqrLen=q;g=function(){var a=d();return function(b,c,d,f,e,h){c||(c=3);d||(d=0);for(f=
f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],e(a,a,h),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();c.forEach=g});U(yb);var zb=ea(function(g,c){function d(){var a=new q.ARRAY_TYPE(4);q.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0);return a}function b(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}function a(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a}function f(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/
c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a}function k(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+f*f+a*a)}function e(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+f*f+a*a}function l(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)}function n(a){var b=a[0],c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a}Object.defineProperty(c,"__esModule",{value:!0});c.create=d;c.clone=function(a){var b=new q.ARRAY_TYPE(4);b[0]=a[0];
b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};c.fromValues=function(a,b,c,d){var f=new q.ARRAY_TYPE(4);f[0]=a;f[1]=b;f[2]=c;f[3]=d;return f};c.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};c.set=function(a,b,c,d,f){a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a};c.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};c.subtract=b;c.multiply=a;c.divide=f;c.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);
return a};c.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);a[3]=Math.floor(b[3]);return a};c.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a};c.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};c.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);
return a};c.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};c.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};c.distance=k;c.squaredDistance=e;c.length=l;c.squaredLength=n;c.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};c.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};c.normalize=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var e=c*c+d*d+f*f+b*
b;0<e&&(e=1/Math.sqrt(e));a[0]=c*e;a[1]=d*e;a[2]=f*e;a[3]=b*e;return a};c.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};c.cross=function(a,b,c,d){var f=c[0]*d[1]-c[1]*d[0],e=c[0]*d[2]-c[2]*d[0],h=c[0]*d[3]-c[3]*d[0],m=c[1]*d[2]-c[2]*d[1],g=c[1]*d[3]-c[3]*d[1];c=c[2]*d[3]-c[3]*d[2];d=b[0];var p=b[1],k=b[2];b=b[3];a[0]=p*c-k*g+b*m;a[1]=-(d*c)+k*h-b*e;a[2]=d*g-p*h+b*f;a[3]=-(d*m)+p*e-k*f;return a};c.lerp=function(a,b,c,d){var f=b[0],e=b[1],h=b[2];b=b[3];a[0]=f+d*(c[0]-f);a[1]=e+d*
(c[1]-e);a[2]=h+d*(c[2]-h);a[3]=b+d*(c[3]-b);return a};c.random=function(a,b){b=b||1;do{var c=2*q.RANDOM()-1;var d=2*q.RANDOM()-1;var f=c*c+d*d}while(1<=f);do{var e=2*q.RANDOM()-1;var h=2*q.RANDOM()-1;var g=e*e+h*h}while(1<=g);f=Math.sqrt((1-f)/g);a[0]=b*c;a[1]=b*d;a[2]=b*e*f;a[3]=b*h*f;return a};c.transformMat4=function(a,b,c){var d=b[0],f=b[1],e=b[2];b=b[3];a[0]=c[0]*d+c[4]*f+c[8]*e+c[12]*b;a[1]=c[1]*d+c[5]*f+c[9]*e+c[13]*b;a[2]=c[2]*d+c[6]*f+c[10]*e+c[14]*b;a[3]=c[3]*d+c[7]*f+c[11]*e+c[15]*b;return a};
c.transformQuat=function(a,b,c){var d=b[0],f=b[1],e=b[2],h=c[0],g=c[1],m=c[2];c=c[3];var p=c*d+g*e-m*f,k=c*f+m*d-h*e,l=c*e+h*f-g*d;d=-h*d-g*f-m*e;a[0]=p*c+d*-h+k*-m-l*-g;a[1]=k*c+d*-g+l*-h-p*-m;a[2]=l*c+d*-m+p*-g-k*-h;a[3]=b[3];return a};c.zero=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a};c.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};c.equals=function(a,b){var c=a[0],d=a[1],f=a[2];
a=a[3];var e=b[0],h=b[1],g=b[2];b=b[3];return Math.abs(c-e)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(d-h)<=q.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(f-g)<=q.EPSILON*Math.max(1,Math.abs(f),Math.abs(g))&&Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.forEach=c.sqrLen=c.len=c.sqrDist=c.dist=c.div=c.mul=c.sub=void 0;var q=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&
Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ra);c.sub=b;c.mul=a;c.div=f;c.dist=k;c.sqrDist=e;c.len=l;c.sqrLen=n;g=function(){var a=d();return function(b,c,d,f,e,g){c||(c=4);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],e(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}}();c.forEach=g});U(zb);var nb=ea(function(g,c){function d(a){if(a&&
a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}function b(){var a=new l.ARRAY_TYPE(4);l.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0);a[3]=1;return a}function a(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function f(a,b,
c){var d=b[0],f=b[1],e=b[2];b=b[3];var g=c[0],h=c[1],m=c[2];c=c[3];a[0]=d*c+b*g+f*m-e*h;a[1]=f*c+b*h+e*g-d*m;a[2]=e*c+b*m+d*h-f*g;a[3]=b*c-d*g-f*h-e*m;return a}function k(a,b,c,d){var f=b[0],e=b[1],g=b[2];b=b[3];var h=c[0],m=c[1],p=c[2];c=c[3];var k=f*h+e*m+g*p+b*c;0>k&&(k=-k,h=-h,m=-m,p=-p,c=-c);if(1-k>l.EPSILON){var t=Math.acos(k);var n=Math.sin(t);k=Math.sin((1-d)*t)/n;d=Math.sin(d*t)/n}else k=1-d;a[0]=k*f+d*h;a[1]=k*e+d*m;a[2]=k*g+d*p;a[3]=k*b+d*c;return a}function e(a,b){var c=b[0]+b[4]+b[8];
if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var f=(d+1)%3,e=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*f+f]-b[3*e+e]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*f+e]-b[3*e+f])*c;a[f]=(b[3*f+d]+b[3*d+f])*c;a[e]=(b[3*e+d]+b[3*d+e])*c}return a}Object.defineProperty(c,"__esModule",{value:!0});c.create=b;c.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};c.setAxisAngle=a;c.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),
d=Math.sin(c/2);d>l.EPSILON?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0);return c};c.multiply=f;c.rotateX=function(a,b,c){c*=.5;var d=b[0],f=b[1],e=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=f*c+e*g;a[2]=e*c-f*g;a[3]=b*c-d*g;return a};c.rotateY=function(a,b,c){c*=.5;var d=b[0],f=b[1],e=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c-e*g;a[1]=f*c+b*g;a[2]=e*c+d*g;a[3]=b*c-f*g;return a};c.rotateZ=function(a,b,c){c*=.5;var d=b[0],f=b[1],e=b[2];b=b[3];var g=Math.sin(c);
c=Math.cos(c);a[0]=d*c+f*g;a[1]=f*c-d*g;a[2]=e*c+b*g;a[3]=b*c-e*g;return a};c.calculateW=function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};c.slerp=k;c.random=function(a){var b=l.RANDOM(),c=l.RANDOM(),d=l.RANDOM(),f=Math.sqrt(1-b);b=Math.sqrt(b);a[0]=f*Math.sin(2*Math.PI*c);a[1]=f*Math.cos(2*Math.PI*c);a[2]=b*Math.sin(2*Math.PI*d);a[3]=b*Math.cos(2*Math.PI*d);return a};c.invert=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var e=c*c+d*d+f*
f+b*b;e=e?1/e:0;a[0]=-c*e;a[1]=-d*e;a[2]=-f*e;a[3]=b*e;return a};c.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};c.fromMat3=e;c.fromEuler=function(a,b,c,d){var f=.5*Math.PI/180;b*=f;c*=f;d*=f;f=Math.sin(b);b=Math.cos(b);var e=Math.sin(c);c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=f*c*d-b*e*g;a[1]=b*e*d+f*c*g;a[2]=b*c*g-f*e*d;a[3]=b*c*d+f*e*g;return a};c.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};c.setAxes=c.sqlerp=c.rotationTo=c.equals=
c.exactEquals=c.normalize=c.sqrLen=c.squaredLength=c.len=c.length=c.lerp=c.dot=c.scale=c.mul=c.add=c.set=c.copy=c.fromValues=c.clone=void 0;var l=d(ra),n=d(Nb),q=d(yb);g=d(zb);c.clone=g.clone;c.fromValues=g.fromValues;c.copy=g.copy;c.set=g.set;c.add=g.add;c.mul=f;c.scale=g.scale;c.dot=g.dot;c.lerp=g.lerp;var h=g.length;c.length=h;c.len=h;h=g.squaredLength;c.squaredLength=h;c.sqrLen=h;var p=g.normalize;c.normalize=p;c.exactEquals=g.exactEquals;c.equals=g.equals;g=function(){var b=q.create(),c=q.fromValues(1,
0,0),d=q.fromValues(0,1,0);return function(f,e,g){var h=q.dot(e,g);if(-.999999>h)return q.cross(b,c,e),1E-6>q.len(b)&&q.cross(b,d,e),q.normalize(b,b),a(f,b,Math.PI),f;if(.999999<h)return f[0]=0,f[1]=0,f[2]=0,f[3]=1,f;q.cross(b,e,g);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=1+h;return p(f,f)}}();c.rotationTo=g;g=function(){var a=b(),c=b();return function(b,d,f,e,g,h){k(a,d,g,h);k(c,f,e,h);k(b,a,c,2*h*(1-h));return b}}();c.sqlerp=g;g=function(){var a=n.create();return function(b,c,d,f){a[0]=d[0];a[3]=d[1];
a[6]=d[2];a[1]=f[0];a[4]=f[1];a[7]=f[2];a[2]=-c[0];a[5]=-c[1];a[8]=-c[2];return p(b,e(b,a))}}();c.setAxes=g});U(nb);var pc=ea(function(g,c){function d(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}function b(a,b,c){var d=.5*c[0],f=.5*c[1];c=.5*c[2];var e=b[0],g=
b[1],h=b[2];b=b[3];a[0]=e;a[1]=g;a[2]=h;a[3]=b;a[4]=d*b+f*h-c*g;a[5]=f*b+c*e-d*h;a[6]=c*b+d*g-f*e;a[7]=-d*e-f*g-c*h;return a}function a(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];return a}function f(a,b,c){var d=b[0],f=b[1],e=b[2],g=b[3],h=c[4],p=c[5],m=c[6],k=c[7],l=b[4],n=b[5],q=b[6];b=b[7];var v=c[0],x=c[1],y=c[2];c=c[3];a[0]=d*c+g*v+f*y-e*x;a[1]=f*c+g*x+e*v-d*y;a[2]=e*c+g*y+d*x-f*v;a[3]=g*c-d*v-f*x-e*y;a[4]=d*k+g*h+f*m-e*p+l*c+b*v+n*y-q*x;a[5]=f*k+g*p+
e*h-d*m+n*c+b*x+q*v-l*y;a[6]=e*k+g*m+d*p-f*h+q*c+b*y+l*x-n*v;a[7]=g*k-d*h-f*p-e*m+b*c-l*v-n*x-q*y;return a}Object.defineProperty(c,"__esModule",{value:!0});c.create=function(){var a=new k.ARRAY_TYPE(8);k.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[4]=0,a[5]=0,a[6]=0,a[7]=0);a[3]=1;return a};c.clone=function(a){var b=new k.ARRAY_TYPE(8);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];return b};c.fromValues=function(a,b,c,d,f,e,g,l){var h=new k.ARRAY_TYPE(8);h[0]=
a;h[1]=b;h[2]=c;h[3]=d;h[4]=f;h[5]=e;h[6]=g;h[7]=l;return h};c.fromRotationTranslationValues=function(a,b,c,d,f,e,g){var h=new k.ARRAY_TYPE(8);h[0]=a;h[1]=b;h[2]=c;h[3]=d;f*=.5;e*=.5;g*=.5;h[4]=f*d+e*c-g*b;h[5]=e*d+g*a-f*c;h[6]=g*d+f*b-e*a;h[7]=-f*a-e*b-g*c;return h};c.fromRotationTranslation=b;c.fromTranslation=function(a,b){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=.5*b[0];a[5]=.5*b[1];a[6]=.5*b[2];a[7]=0;return a};c.fromRotation=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=0;a[5]=0;a[6]=0;
a[7]=0;return a};c.fromMat4=function(a,c){var d=e.create();l.getRotation(d,c);var f=new k.ARRAY_TYPE(3);l.getTranslation(f,c);b(a,d,f);return a};c.copy=a;c.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;a[4]=0;a[5]=0;a[6]=0;a[7]=0;return a};c.set=function(a,b,c,d,f,e,g,k,l){a[0]=b;a[1]=c;a[2]=d;a[3]=f;a[4]=e;a[5]=g;a[6]=k;a[7]=l;return a};c.getDual=function(a,b){a[0]=b[4];a[1]=b[5];a[2]=b[6];a[3]=b[7];return a};c.setDual=function(a,b){a[4]=b[0];a[5]=b[1];a[6]=b[2];a[7]=b[3];return a};c.getTranslation=
function(a,b){var c=b[4],d=b[5],f=b[6],e=b[7],g=-b[0],h=-b[1],k=-b[2];b=b[3];a[0]=2*(c*b+e*g+d*k-f*h);a[1]=2*(d*b+e*h+f*g-c*k);a[2]=2*(f*b+e*k+c*h-d*g);return a};c.translate=function(a,b,c){var d=b[0],f=b[1],e=b[2],g=b[3],h=.5*c[0],k=.5*c[1];c=.5*c[2];var m=b[4],p=b[5],l=b[6];b=b[7];a[0]=d;a[1]=f;a[2]=e;a[3]=g;a[4]=g*h+f*c-e*k+m;a[5]=g*k+e*h-d*c+p;a[6]=g*c+d*k-f*h+l;a[7]=-d*h-f*k-e*c+b;return a};c.rotateX=function(a,b,c){var d=-b[0],f=-b[1],g=-b[2],h=b[3],k=b[4],m=b[5],p=b[6],l=b[7],n=k*h+l*d+m*g-
p*f,q=m*h+l*f+p*d-k*g,v=p*h+l*g+k*f-m*d;k=l*h-k*d-m*f-p*g;e.rotateX(a,b,c);d=a[0];f=a[1];g=a[2];h=a[3];a[4]=n*h+k*d+q*g-v*f;a[5]=q*h+k*f+v*d-n*g;a[6]=v*h+k*g+n*f-q*d;a[7]=k*h-n*d-q*f-v*g;return a};c.rotateY=function(a,b,c){var d=-b[0],f=-b[1],g=-b[2],h=b[3],k=b[4],m=b[5],p=b[6],l=b[7],n=k*h+l*d+m*g-p*f,q=m*h+l*f+p*d-k*g,v=p*h+l*g+k*f-m*d;k=l*h-k*d-m*f-p*g;e.rotateY(a,b,c);d=a[0];f=a[1];g=a[2];h=a[3];a[4]=n*h+k*d+q*g-v*f;a[5]=q*h+k*f+v*d-n*g;a[6]=v*h+k*g+n*f-q*d;a[7]=k*h-n*d-q*f-v*g;return a};c.rotateZ=
function(a,b,c){var d=-b[0],f=-b[1],g=-b[2],h=b[3],k=b[4],m=b[5],p=b[6],l=b[7],n=k*h+l*d+m*g-p*f,q=m*h+l*f+p*d-k*g,v=p*h+l*g+k*f-m*d;k=l*h-k*d-m*f-p*g;e.rotateZ(a,b,c);d=a[0];f=a[1];g=a[2];h=a[3];a[4]=n*h+k*d+q*g-v*f;a[5]=q*h+k*f+v*d-n*g;a[6]=v*h+k*g+n*f-q*d;a[7]=k*h-n*d-q*f-v*g;return a};c.rotateByQuatAppend=function(a,b,c){var d=c[0],f=c[1],e=c[2];c=c[3];var g=b[0],h=b[1],k=b[2],m=b[3];a[0]=g*c+m*d+h*e-k*f;a[1]=h*c+m*f+k*d-g*e;a[2]=k*c+m*e+g*f-h*d;a[3]=m*c-g*d-h*f-k*e;g=b[4];h=b[5];k=b[6];m=b[7];
a[4]=g*c+m*d+h*e-k*f;a[5]=h*c+m*f+k*d-g*e;a[6]=k*c+m*e+g*f-h*d;a[7]=m*c-g*d-h*f-k*e;return a};c.rotateByQuatPrepend=function(a,b,c){var d=b[0],f=b[1],e=b[2];b=b[3];var g=c[0],h=c[1],k=c[2],m=c[3];a[0]=d*m+b*g+f*k-e*h;a[1]=f*m+b*h+e*g-d*k;a[2]=e*m+b*k+d*h-f*g;a[3]=b*m-d*g-f*h-e*k;g=c[4];h=c[5];k=c[6];m=c[7];a[4]=d*m+b*g+f*k-e*h;a[5]=f*m+b*h+e*g-d*k;a[6]=e*m+b*k+d*h-f*g;a[7]=b*m-d*g-f*h-e*k;return a};c.rotateAroundAxis=function(b,c,d,f){if(Math.abs(f)<k.EPSILON)return a(b,c);var e=Math.sqrt(d[0]*d[0]+
d[1]*d[1]+d[2]*d[2]);f*=.5;var g=Math.sin(f),h=g*d[0]/e,m=g*d[1]/e;d=g*d[2]/e;f=Math.cos(f);e=c[0];g=c[1];var p=c[2],l=c[3];b[0]=e*f+l*h+g*d-p*m;b[1]=g*f+l*m+p*h-e*d;b[2]=p*f+l*d+e*m-g*h;b[3]=l*f-e*h-g*m-p*d;e=c[4];g=c[5];p=c[6];c=c[7];b[4]=e*f+c*h+g*d-p*m;b[5]=g*f+c*m+p*h-e*d;b[6]=p*f+c*d+e*m-g*h;b[7]=c*f-e*h-g*m-p*d;return b};c.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];return a};c.multiply=f;c.scale=
function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;return a};c.lerp=function(a,b,c,d){var f=1-d;0>n(b,c)&&(d=-d);a[0]=b[0]*f+c[0]*d;a[1]=b[1]*f+c[1]*d;a[2]=b[2]*f+c[2]*d;a[3]=b[3]*f+c[3]*d;a[4]=b[4]*f+c[4]*d;a[5]=b[5]*f+c[5]*d;a[6]=b[6]*f+c[6]*d;a[7]=b[7]*f+c[7]*d;return a};c.invert=function(a,b){var c=q(b);a[0]=-b[0]/c;a[1]=-b[1]/c;a[2]=-b[2]/c;a[3]=b[3]/c;a[4]=-b[4]/c;a[5]=-b[5]/c;a[6]=-b[6]/c;a[7]=b[7]/c;return a};c.conjugate=function(a,
b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];a[4]=-b[4];a[5]=-b[5];a[6]=-b[6];a[7]=b[7];return a};c.normalize=function(a,b){var c=q(b);if(0<c){c=Math.sqrt(c);var d=b[0]/c,f=b[1]/c,e=b[2]/c,g=b[3]/c,h=b[4],k=b[5],l=b[6];b=b[7];var p=d*h+f*k+e*l+g*b;a[0]=d;a[1]=f;a[2]=e;a[3]=g;a[4]=(h-d*p)/c;a[5]=(k-f*p)/c;a[6]=(l-e*p)/c;a[7]=(b-g*p)/c}return a};c.str=function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"};c.exactEquals=function(a,b){return a[0]===
b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]};c.equals=function(a,b){var c=a[0],d=a[1],f=a[2],e=a[3],g=a[4],h=a[5],l=a[6];a=a[7];var p=b[0],n=b[1],q=b[2],v=b[3],x=b[4],y=b[5],S=b[6];b=b[7];return Math.abs(c-p)<=k.EPSILON*Math.max(1,Math.abs(c),Math.abs(p))&&Math.abs(d-n)<=k.EPSILON*Math.max(1,Math.abs(d),Math.abs(n))&&Math.abs(f-q)<=k.EPSILON*Math.max(1,Math.abs(f),Math.abs(q))&&Math.abs(e-v)<=k.EPSILON*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(g-
x)<=k.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(h-y)<=k.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(l-S)<=k.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(a-b)<=k.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.sqrLen=c.squaredLength=c.len=c.length=c.dot=c.mul=c.setReal=c.getReal=void 0;var k=d(ra),e=d(nb),l=d(Pb);c.getReal=e.copy;c.setReal=e.copy;c.mul=f;var n=e.dot;c.dot=n;g=e.length;c.length=g;c.len=g;var q=e.squaredLength;c.squaredLength=q;c.sqrLen=q});U(pc);var qc=
ea(function(g,c){function d(){var a=new q.ARRAY_TYPE(2);q.ARRAY_TYPE!=Float32Array&&(a[0]=0,a[1]=0);return a}function b(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];return a}function a(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];return a}function f(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];return a}function k(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)}function e(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a}function l(a){var b=a[0];a=a[1];return Math.sqrt(b*b+a*a)}function n(a){var b=a[0];a=a[1];return b*
b+a*a}Object.defineProperty(c,"__esModule",{value:!0});c.create=d;c.clone=function(a){var b=new q.ARRAY_TYPE(2);b[0]=a[0];b[1]=a[1];return b};c.fromValues=function(a,b){var c=new q.ARRAY_TYPE(2);c[0]=a;c[1]=b;return c};c.copy=function(a,b){a[0]=b[0];a[1]=b[1];return a};c.set=function(a,b,c){a[0]=b;a[1]=c;return a};c.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];return a};c.subtract=b;c.multiply=a;c.divide=f;c.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);return a};c.floor=function(a,
b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);return a};c.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);return a};c.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);return a};c.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);return a};c.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;return a};c.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;return a};c.distance=k;c.squaredDistance=e;c.length=l;c.squaredLength=n;c.negate=
function(a,b){a[0]=-b[0];a[1]=-b[1];return a};c.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];return a};c.normalize=function(a,b){var c=b[0],d=b[1];c=c*c+d*d;0<c&&(c=1/Math.sqrt(c));a[0]=b[0]*c;a[1]=b[1]*c;return a};c.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};c.cross=function(a,b,c){b=b[0]*c[1]-b[1]*c[0];a[0]=a[1]=0;a[2]=b;return a};c.lerp=function(a,b,c,d){var f=b[0];b=b[1];a[0]=f+d*(c[0]-f);a[1]=b+d*(c[1]-b);return a};c.random=function(a,b){b=b||1;var c=2*q.RANDOM()*Math.PI;a[0]=Math.cos(c)*
b;a[1]=Math.sin(c)*b;return a};c.transformMat2=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[2]*b;a[1]=c[1]*d+c[3]*b;return a};c.transformMat2d=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[2]*b+c[4];a[1]=c[1]*d+c[3]*b+c[5];return a};c.transformMat3=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[3]*b+c[6];a[1]=c[1]*d+c[4]*b+c[7];return a};c.transformMat4=function(a,b,c){var d=b[0];b=b[1];a[0]=c[0]*d+c[4]*b+c[12];a[1]=c[1]*d+c[5]*b+c[13];return a};c.rotate=function(a,b,c,d){var f=b[0]-c[0];b=
b[1]-c[1];var e=Math.sin(d);d=Math.cos(d);a[0]=f*d-b*e+c[0];a[1]=f*e+b*d+c[1];return a};c.angle=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];var f=c*c+a*a;0<f&&(f=1/Math.sqrt(f));var e=d*d+b*b;0<e&&(e=1/Math.sqrt(e));c=(c*d+a*b)*f*e;return 1<c?0:-1>c?Math.PI:Math.acos(c)};c.zero=function(a){a[0]=0;a[1]=0;return a};c.str=function(a){return"vec2("+a[0]+", "+a[1]+")"};c.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]};c.equals=function(a,b){var c=a[0];a=a[1];var d=b[0];b=b[1];return Math.abs(c-
d)<=q.EPSILON*Math.max(1,Math.abs(c),Math.abs(d))&&Math.abs(a-b)<=q.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};c.forEach=c.sqrLen=c.sqrDist=c.dist=c.div=c.mul=c.sub=c.len=void 0;var q=function(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)if(Object.prototype.hasOwnProperty.call(a,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(a,c):{};d.get||d.set?Object.defineProperty(b,c,d):b[c]=a[c]}b.default=a;return b}(ra);c.len=l;c.sub=b;
c.mul=a;c.div=f;c.dist=k;c.sqrDist=e;c.sqrLen=n;g=function(){var a=d();return function(b,c,d,f,e,g){c||(c=2);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],e(a,a,g),b[d]=a[0],b[d+1]=a[1];return b}}();c.forEach=g});U(qc);var na=ea(function(g,c){function d(b){if(b&&b.__esModule)return b;var a={};if(null!=b)for(var c in b)if(Object.prototype.hasOwnProperty.call(b,c)){var d=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(b,c):{};
d.get||d.set?Object.defineProperty(a,c,d):a[c]=b[c]}a.default=b;return a}Object.defineProperty(c,"__esModule",{value:!0});c.vec4=c.vec3=c.vec2=c.quat2=c.quat=c.mat4=c.mat3=c.mat2d=c.mat2=c.glMatrix=void 0;g=d(ra);c.glMatrix=g;g=d(nc);c.mat2=g;g=d(oc);c.mat2d=g;g=d(Nb);c.mat3=g;g=d(Pb);c.mat4=g;g=d(nb);c.quat=g;g=d(pc);c.quat2=g;g=d(qc);c.vec2=g;g=d(yb);c.vec3=g;g=d(zb);c.vec4=g});U(na);var Qc=na.vec4,Ra=na.vec3,Rc=na.vec2,Sc=na.quat2,Tc=na.quat,J=na.mat4,Uc=na.mat3,Vc=na.mat2d,Wc=na.mat2,Xc=na.glMatrix;
ec(ja,{EARTHRADIUS:6370996.81,MCBAND:[1.289059486E7,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255E-8,8.98305509648872E-6,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,1.73379812E7],[-7.435856389565537E-9,8.983055097726239E-6,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,1.026014486E7],[-3.030883460898826E-8,
8.98305509983578E-6,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552E-8,8.983055099779535E-6,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437E-9,8.983055096812155E-6,6.995724062E-5,23.10934304144901,-2.3663490511E-4,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878E-9,
8.983055095805407E-6,-3.068298E-8,7.47137025468032,-3.53937994E-6,-.02145144861037,-1.234426596E-5,1.0322952773E-4,-3.23890364E-6,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[8.277824516172526E-4,111320.7020463578,6.477955746671607E8,-4.082003173641316E9,1.077490566351142E10,-1.517187553151559E10,1.205306533862167E10,-5.124939663577472E9,9.133119359512032E8,67.5],
[.00337398766765,111320.7020202162,4481351.045890365,-2.339375119931662E7,7.968221547186455E7,-1.159649932797253E8,9.723671115602145E7,-4.366194633752821E7,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-3.441963504368392E-4,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,
22.5],[-3.218135878613132E-4,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],getDistanceByMC:function(g,c){if(!g||!c)return 0;g=this.convertMC2LL(g);if(!g)return 0;var d=this.toRadians(g.lng);g=this.toRadians(g.lat);c=this.convertMC2LL(c);if(!c)return 0;var b=this.toRadians(c.lng);c=this.toRadians(c.lat);return this.getDistance(d,b,g,c)},getDistanceByLL:function(g,c){if(!g||!c)return 0;g.lng=this.getLoop(g.lng,
-180,180);g.lat=this.getRange(g.lat,-74,74);c.lng=this.getLoop(c.lng,-180,180);c.lat=this.getRange(c.lat,-74,74);var d=this.toRadians(g.lng);var b=this.toRadians(g.lat);g=this.toRadians(c.lng);c=this.toRadians(c.lat);return this.getDistance(d,g,b,c)},convertMC2LL:function(g){if(null===g||void 0===g)return new la(0,0);var c=new la(Math.abs(g.lng),Math.abs(g.lat));for(var d=0;d<this.MCBAND.length;d++)if(c.lat>=this.MCBAND[d]){var b=this.MC2LL[d];break}g=this.convertor(g,b);return g=new la(g.lng.toFixed(6),
g.lat.toFixed(6))},convertLL2MC:function(g){if(null===g||void 0===g)return new la(0,0);if(180<g.lng||-180>g.lng||90<g.lat||-90>g.lat)return g;g.lng=this.getLoop(g.lng,-180,180);g.lat=this.getRange(g.lat,-74,74);var c=new la(g.lng,g.lat);for(var d=0;d<this.LLBAND.length;d++)if(c.lat>=this.LLBAND[d]){var b=this.LL2MC[d];break}if(!b)for(d=0;d<this.LLBAND.length;d++)if(c.lat<=-this.LLBAND[d]){b=this.LL2MC[d];break}g=this.convertor(g,b);return g=new la(Number(g.lng.toFixed(2)),Number(g.lat.toFixed(2)))},
convertor:function(g,c){if(g&&c){var d=c[0]+c[1]*Math.abs(g.lng),b=Math.abs(g.lat)/c[9];c=c[2]+c[3]*b+c[4]*b*b+c[5]*b*b*b+c[6]*b*b*b*b+c[7]*b*b*b*b*b+c[8]*b*b*b*b*b*b;d*=0>g.lng?-1:1;c*=0>g.lat?-1:1;return new la(d,c)}},getDistance:function(g,c,d,b){return this.EARTHRADIUS*Math.acos(Math.sin(d)*Math.sin(b)+Math.cos(d)*Math.cos(b)*Math.cos(c-g))},toRadians:function(g){return Math.PI*g/180},toDegrees:function(g){return 180*g/Math.PI},getRange:function(g,c,d){null!=c&&(g=Math.max(g,c));null!=d&&(g=Math.min(g,
d));return g},getLoop:function(g,c,d){for(;g>d;)g-=d-c;for(;g<c;)g+=d-c;return g}});ec(ja.prototype,{lngLatToMercator:function(g){return ja.convertLL2MC(g)},lngLatToPoint:function(g){g=ja.convertLL2MC(g);return new fc(g.lng,g.lat)},mercatorToLngLat:function(g){return ja.convertMC2LL(g)},pointToLngLat:function(g){g=new la(g.x,g.y);return ja.convertMC2LL(g)},pointToPixel:function(g,c,d,b,a){if(g)return g=this.lngLatToMercator(g,a),c=this.getZoomUnits(c),new fc(Math.round((g.lng-d.lng)/c+b.width/2),
Math.round((d.lat-g.lat)/c+b.height/2))},pixelToPoint:function(g,c,d,b,a){if(g)return c=this.getZoomUnits(c),g=new la(d.lng+c*(g.x-b.width/2),d.lat-c*(g.y-b.height/2)),this.mercatorToLngLat(g,a)},getZoomUnits:function(g){return Math.pow(2,18-g)}});X.prototype.setMax=function(g){this.max=g||100};X.prototype.setMin=function(g){this.min=g||0};X.prototype.setMaxSize=function(g){this.maxSize=g||35};X.prototype.setMinSize=function(g){this.minSize=g||0};X.prototype.initPalette=function(){var g=this.gradient,
c=this.paletteCtx=(new hb(256,1)).getContext("2d"),d=c.createLinearGradient(0,0,256,1);Object.keys(g).forEach(function(b){d.addColorStop(parseFloat(b),g[b])});c.fillStyle=d;c.fillRect(0,0,256,1);c.imageData=c.getImageData(0,0,256,1).data};X.prototype.getColor=function(g){g=this.getImageData(g);return"rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]/256+")"};X.prototype.getImageData=function(g){var c=this.paletteCtx.imageData;if(void 0===g)return c;var d=this.max,b=this.min;g>d&&(g=d);g<b&&(g=b);g=4*Math.floor((g-
b)/(d-b)*255);return[c[g],c[g+1],c[g+2],c[g+3]]};X.prototype.getSize=function(g){var c=this.max,d=this.min,b=this.maxSize,a=this.minSize;g>c&&(g=c);g<d&&(g=d);return a+(g-d)/(c-d)*(b-a)};va.prototype._initialize=function(){this.v0=this._normalizaCoord(this.options.start);this.v3=this._normalizaCoord(this.options.end);this.v1=this._getControlPoint(this.v0,this.v3,4);this.v2=this._getControlPoint(this.v3,this.v0,5);this.v0[2]||(this.v0[2]=0);this.v3[2]||(this.v3[2]=0)};va.prototype.setOptions=function(g){this.options=
g||{};this._initialize()};va.prototype.getPoints=function(g){void 0===g&&(g=20);for(var c=[],d=0;d<=g;d++)c.push(this._getPoint(d/g));return c};va.prototype._normalizaCoord=function(g){if(!g)return[];g=ja.convertLL2MC({lng:Number(g[0]),lat:Number(g[1])});return[g.lng,g.lat]};va.prototype._getControlPoint=function(g,c){var d=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return[].concat(lb(this._getQuarter(g,c)),[this._getDistance(g,c)/d])};va.prototype._getQuarter=function(g,c){return[(3*
g[0]+c[0])/4,(3*g[1]+c[1])/4]};va.prototype._getDistance=function(g,c){return Math.sqrt(Math.pow(g[0]-c[0],2)+Math.pow(g[1]-c[1],2))};va.prototype._getPoint=function(g){var c=[],d=this.v0,b=this.v1,a=this.v2,f=this.v3;c.push(ub(g,d[0],b[0],a[0],f[0]),ub(g,d[1],b[1],a[1],f[1]),ub(g,d[2],b[2],a[2],f[2]));return c};var Ab=function(){function g(c){x(this,g);this.options=this.getDefaultOptions();this.autoUpdate=!1;Object.assign(this.options,c);this.options.data&&(this.data=this.options.data)}y(g,[{key:"getDefaultOptions",
value:function(){return{}}},{key:"initialize",value:function(c){}},{key:"destroy",value:function(){this.onDestroy&&this.onDestroy()}},{key:"render",value:function(){}},{key:"setData",value:function(c,d){d=d||{};this.data=c;this.onDataChanged&&this.onDataChanged(this.getData());this.onChanged&&this.onChanged(this.getOptions(),this.getData());!1!==d.autoRender&&this.webglLayer&&this.webglLayer.render()}},{key:"getData",value:function(){return this.data||[]}},{key:"setOptions",value:function(c){c=c||
{};Object.assign(this.options,c);this.onOptionsChanged&&this.onOptionsChanged(this.getOptions());this.onChanged&&this.onChanged(this.getOptions(),this.getData());c.data?this.setData(c.data):this.webglLayer&&this.webglLayer.render()}},{key:"getOptions",value:function(){return this.options||{}}},{key:"onOptionsChanged",value:function(c){}},{key:"onDataChanged",value:function(c){}},{key:"onChanged",value:function(c,d){}},{key:"onDestroy",value:function(){}},{key:"lnglatToMercator",value:function(c,d){}},
{key:"setWebglLayer",value:function(c){this.webglLayer=c}},{key:"getWebglLayer",value:function(){return this.webglLayer}},{key:"isRequestAnimation",value:function(){return this.autoUpdate}}]);return g}(),K=function(){function g(c,d,b){x(this,g);this.options=d;this.gl=c;b&&(this.map=b.map);b=this.getVertexShader(d.vertexShader);var a=d.fragmentShader;d=c.createShader(c.VERTEX_SHADER);c.shaderSource(d,b);c.compileShader(d);c.getShaderParameter(d,c.COMPILE_STATUS)?(b=c.createShader(c.FRAGMENT_SHADER),
c.shaderSource(b,a),c.compileShader(b),c.getShaderParameter(b,c.COMPILE_STATUS)?(a=c.createProgram(),c.attachShader(a,d),c.attachShader(a,b),c.deleteShader(d),c.deleteShader(b),c.linkProgram(a),c.getProgramParameter(a,c.LINK_STATUS)?d=a:(d="Shader program failed to link.  The error log is:"+c.getProgramInfoLog(a),console.error(d),d=-1)):(d="Fragment shader failed to compile.  The error log is:"+c.getShaderInfoLog(b),console.error(d),d=-1)):(d="Vertex shader failed to compile.  The error log is:"+
c.getShaderInfoLog(d),console.error(d),d=-1);d=this.program=d;b={};a=c.getProgramParameter(d,c.ACTIVE_ATTRIBUTES);for(var f=0;f<a;f++){var k=c.getActiveAttrib(d,f);b[k.name]=c.getAttribLocation(d,k.name)}f={};k={};for(var e=c.getProgramParameter(d,c.ACTIVE_UNIFORMS),l=0;l<e;l++){var n=c.getActiveUniform(d,l);f[n.name]=c.getUniformLocation(d,n.name);k[n.name]=n.type}this.parameter=c={attributes:b,numAttributes:a,uniformsType:k,uniforms:f};this.attributes=c.attributes;this.uniforms=c.uniforms;this.parameter=
c}y(g,[{key:"getVertexShader",value:function(c){var d="";this.map&&"cesium"===this.map.type&&(d="#define LOG_DEPTH\n");c=(d+"uniform float log2FarDistance;void afterMain(){\n#if defined(LOG_DEPTH)\ngl_Position.z=log2(max(1e-6,1.0+gl_Position.w))*log2FarDistance-1.0;gl_Position.z*=gl_Position.w;\n#endif\n}"+c).replace("void main","void originMain");return c+"void main() {originMain(); afterMain();}"}},{key:"use",value:function(c,d){this.gl=c;c.useProgram(this.program);this.map&&"cesium"===this.map.type&&
this.setUniforms({log2FarDistance:this.map.map.scene.context._us.log2FarDistance})}},{key:"setUniform",value:function(c,d){var b=this.gl,a=this.uniforms[c];switch(this.parameter.uniformsType[c]){case b.FLOAT:b.uniform1f(a,d);break;case b.FLOAT_VEC2:b.uniform2f(a,d[0],d[1]);break;case b.FLOAT_VEC3:b.uniform3f(a,d[0],d[1],d[2]);break;case b.FLOAT_VEC4:b.uniform4f(a,d[0],d[1],d[2],d[3]);break;case b.SAMPLER_2D:case b.SAMPLER_CUBE:b.bindTexture(a,d);break;case b.INT:case b.BOOL:b.uniform1i(a,d);break;
case b.INT_VEC2:case b.BOOL_VEC2:b.uniform2i(a,d[0],d[1]);break;case b.INT_VEC3:case b.BOOL_VEC3:b.uniform3i(a,d[0],d[1],d[2]);break;case b.INT_VEC4:case b.BOOL_VEC4:b.uniform4i(a,d[0],d[1],d[2],d[3]);break;case b.FLOAT_MAT2:b.uniformMatrix2fv(a,!1,d);break;case b.FLOAT_MAT3:b.uniformMatrix3fv(a,!1,d);break;case b.FLOAT_MAT4:b.uniformMatrix4fv(a,!1,d);break;default:console.error("Unrecognized uniform type: "+c)}}},{key:"setUniforms",value:function(c){for(var d in c)this.setUniform(d,c[d])}}]);return g}(),
ob=function(){function g(c){x(this,g);this.options=c;this.gl=c.gl;this.buffer=this.gl.createBuffer();c.data&&this.updateData(c.data)}y(g,[{key:"updateData",value:function(c){var d=this.options,b=this.gl;this.bind();b.bufferData(b[d.target],c,b[d.usage]);this.unBind()}},{key:"bind",value:function(c){c=c||this.gl;c.bindBuffer(c[this.options.target],this.buffer)}},{key:"unBind",value:function(c){c=c||this.gl;c.bindBuffer(c[this.options.target],null)}},{key:"destroy",value:function(){this.buffer=null}}]);
return g}(),Yc={BYTE:1,UNSIGNED_BYTE:1,SHORT:2,UNSIGNED_SHORT:2,FLOAT:4},Qb=function(){function g(c){x(this,g);this.options=c;this.attributes=c.attributes;this.gl=c.gl;this.program=c.program;for(c=this.stride=0;c<this.attributes.length;c++)this.stride+=Yc[this.attributes[c].type]*this.attributes[c].size}y(g,[{key:"setVertexAttribPointers",value:function(){for(var c=this.gl,d=this.program,b=0;b<this.attributes.length;b++){var a=this.attributes[b],f=d.attributes[a.name];a.buffer.bind(c);c.vertexAttribPointer(f,
a.size,c[a.type],a.normalize||!1,this.stride,a.offset);c.enableVertexAttribArray(f)}}},{key:"bind",value:function(){this.setVertexAttribPointers()}},{key:"destroy",value:function(){}}]);return g}(),Ha=function a(c,d,b){x(this,a);d=d||c.canvas.width;b=b||c.canvas.height;var f=c.createFramebuffer(),k=c.createTexture();c.bindTexture(c.TEXTURE_2D,k);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,d,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,
c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);f.texture=k;var e=c.createRenderbuffer();c.bindRenderbuffer(c.RENDERBUFFER,e);c.renderbufferStorage(c.RENDERBUFFER,c.DEPTH_COMPONENT16,d,b);f.depthBuffer=e;c.bindFramebuffer(c.FRAMEBUFFER,f);c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,k,0);c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,e);d=
c.checkFramebufferStatus(c.FRAMEBUFFER);c.FRAMEBUFFER_COMPLETE===d&&(c.bindFramebuffer(c.FRAMEBUFFER,null),c.bindTexture(c.TEXTURE_2D,null),c.bindRenderbuffer(c.RENDERBUFFER,null),this.framebuffer=f)},pb=function(){function c(d){x(this,c);this.options={};Object.assign(this.options,d);this.vertex=[-1,1,0,-1,-1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];this.sampleCoord=[0,1,0,0,1,1,1,1,0,0,1,0]}y(c,[{key:"getOptions",value:function(){return this.options}},{key:"render",value:function(c){var b=c.gl;c=c.texture;
var a=this.programSample;b.useProgram(a.program);var d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);var k=[-1,-1,0,-1,1,0,1,1,0,1,1,0,-1,-1,0,1,-1,0];b.bufferData(b.ARRAY_BUFFER,new Float32Array(k),b.STATIC_DRAW);b.enableVertexAttribArray(a.attributes.aPos);b.vertexAttribPointer(a.attributes.aPos,3,b.FLOAT,!1,0,0);d=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,d);b.bufferData(b.ARRAY_BUFFER,new Float32Array([0,0,0,1,1,1,1,1,0,0,1,0]),b.STATIC_DRAW);b.enableVertexAttribArray(a.attributes.aTextureCoord);
b.vertexAttribPointer(a.attributes.aTextureCoord,2,b.FLOAT,!1,0,0);b.activeTexture(b.TEXTURE0);b.bindTexture(b.TEXTURE_2D,c);b.uniform1i(a.uniforms.uSampler,0);b.drawArrays(b.TRIANGLES,0,k.length/3)}}]);return c}(),Zc=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"getProgram",value:function(b){this.programSample||(this.programSample=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",
fragmentShader:"precision mediump float;uniform sampler2D uSampler;varying vec2 vTextureCoord;void main(){float fStep=1.0/512.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;gl_FragColor=blurSample;}"}));
return this.programSample}},{key:"render",value:function(b){var a=b.gl;b=b.texture;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var c=this.getProgram(a);a.useProgram(c.program);var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aPos);a.vertexAttribPointer(c.attributes.aPos,3,a.FLOAT,!1,0,0);d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,
new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aTextureCoord);a.vertexAttribPointer(c.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,b);a.uniform1i(c.uniforms.uSampler,1);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3)}}]);return d}(pb),$c=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"getProgram",value:function(b){this.programBright||
(this.programBright=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-(1.0-threshold)/5.0));float brightness=dot(color.rgb,vec3(0.2126,0.7152,0.0722));if(brightness>threshold){color=lightColor;}else{color=vec4(0.0);}gl_FragColor=color;}"}));
this.programBloom||(this.programBloom=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y);vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"}));
this.programResult||(this.programResult=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord);vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"}));
return{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"getExtraFbo",value:function(b){this.collectBrightBuffer||(this.collectBrightBuffer=new Ha(b));this.bloomBuffer||(this.bloomBuffer=new Ha(b));return{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(b){var a=b.gl,c=b.texture;b=b.fbo;var d=this.getOptions();a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);
var e=this.getProgram(a),l=e.programBright,n=e.programBloom;e=e.programResult;var q=this.getExtraFbo(a),h=q.collectBrightBuffer;q=q.bloomBuffer;var p=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,p);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(l.attributes.aPos);a.vertexAttribPointer(l.attributes.aPos,3,a.FLOAT,!1,0,0);a.enableVertexAttribArray(n.attributes.aPos);a.vertexAttribPointer(n.attributes.aPos,3,a.FLOAT,!1,0,0);a.enableVertexAttribArray(e.attributes.aPos);
a.vertexAttribPointer(e.attributes.aPos,3,a.FLOAT,!1,0,0);p=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,p);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(l.attributes.aTextureCoord);a.vertexAttribPointer(l.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.enableVertexAttribArray(n.attributes.aTextureCoord);a.vertexAttribPointer(n.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.enableVertexAttribArray(e.attributes.aTextureCoord);a.vertexAttribPointer(e.attributes.aTextureCoord,
2,a.FLOAT,!1,0,0);a.useProgram(l.program);a.bindFramebuffer(a.FRAMEBUFFER,h);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,c);a.uniform1i(l.uniforms.uSampler,1);a.uniform1f(l.uniforms.threshold,d.threshold||0);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.useProgram(n.program);a.bindFramebuffer(a.FRAMEBUFFER,q);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,
h.texture);a.uniform1i(n.uniforms.uSampler,1);a.uniform1i(n.uniforms.isVertical,!0);a.uniform1f(n.uniforms.blurSize,d.blurSize||2);a.uniform2fv(n.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.useProgram(n.program);a.bindFramebuffer(a.FRAMEBUFFER,h);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,q.texture);a.uniform1i(n.uniforms.uSampler,1);a.uniform1i(n.uniforms.isVertical,
!1);a.uniform1f(n.uniforms.blurSize,d.blurSize||2);a.uniform2fv(n.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.useProgram(e.program);a.bindFramebuffer(a.FRAMEBUFFER,b);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,c);a.uniform1i(e.uniforms.originalTexture,1);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,h.texture);a.uniform1i(e.uniforms.bloomTexture,0);
a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.bindBuffer(a.ARRAY_BUFFER,null);a.useProgram(null)}}]);return d}(pb),ad=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"getProgram",value:function(b){this.programBright||(this.programBright=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform float threshold;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(uSampler,vTextureCoord);vec4 lightColor=max(vec4(0.0),(color-threshold));gl_FragColor=lightColor;}"}));
this.programBloom||(this.programBloom=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform bool isVertical;uniform vec2 canvasSize;uniform float blurSize;varying vec2 vTextureCoord;void main(){float weight[10];weight[0]=0.2270270270;weight[1]=0.1945945946;weight[2]=0.1216216216;weight[3]=0.1135135135;weight[4]=0.0972972973;weight[5]=0.0608108108;weight[6]=0.0540540541;weight[7]=0.0270270270;weight[8]=0.0162162162;weight[9]=0.0081081081;vec2 offset=vec2(blurSize/canvasSize.x,blurSize/canvasSize.y);vec4 result=texture2D(uSampler,vTextureCoord)*weight[0];if(isVertical){for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(0.0,offset.y*float(i)))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(0.0,offset.y*float(i)))*weight[i];}}else{for(int i=1;i<10;++i){result+=texture2D(uSampler,vTextureCoord+vec2(offset.x*float(i),0.0))*weight[i];result+=texture2D(uSampler,vTextureCoord-vec2(offset.x*float(i),0.0))*weight[i];}}gl_FragColor=result;}"}));
this.programResult||(this.programResult=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform sampler2D originalTexture;uniform sampler2D bloomTexture;uniform float toneScale;varying vec2 vTextureCoord;void main(){vec4 color=texture2D(originalTexture,vTextureCoord)*toneScale;vec4 bloomColor=texture2D(bloomTexture,vTextureCoord);color+=bloomColor;gl_FragColor=color;}"}));
return{programBright:this.programBright,programBloom:this.programBloom,programResult:this.programResult}}},{key:"getExtraFbo",value:function(b){this.collectBrightBuffer||(this.collectBrightBuffer=new Ha(b));this.bloomBuffer||(this.bloomBuffer=new Ha(b));return{collectBrightBuffer:this.collectBrightBuffer.framebuffer,bloomBuffer:this.bloomBuffer.framebuffer}}},{key:"render",value:function(b){var a=b.gl,c=b.texture;b=b.fbo;var d=this.getOptions(),e="clarity"in d?d.clarity:1;e=Math.max(0,e);e=Math.min(1,
e);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);var l=this.getProgram(a),n=l.programBright,q=l.programBloom;l=l.programResult;var h=this.getExtraFbo(a),p=h.collectBrightBuffer;h=h.bloomBuffer;var m=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,m);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(n.attributes.aPos);a.vertexAttribPointer(n.attributes.aPos,3,a.FLOAT,!1,0,0);a.enableVertexAttribArray(q.attributes.aPos);a.vertexAttribPointer(q.attributes.aPos,
3,a.FLOAT,!1,0,0);a.enableVertexAttribArray(l.attributes.aPos);a.vertexAttribPointer(l.attributes.aPos,3,a.FLOAT,!1,0,0);m=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,m);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(n.attributes.aTextureCoord);a.vertexAttribPointer(n.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.enableVertexAttribArray(q.attributes.aTextureCoord);a.vertexAttribPointer(q.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.enableVertexAttribArray(l.attributes.aTextureCoord);
a.vertexAttribPointer(l.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.useProgram(n.program);a.bindFramebuffer(a.FRAMEBUFFER,p);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,c);a.uniform1i(n.uniforms.uSampler,1);a.uniform1f(n.uniforms.threshold,d.threshold||0);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.useProgram(q.program);a.bindFramebuffer(a.FRAMEBUFFER,h);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);
a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,p.texture);a.uniform1i(q.uniforms.uSampler,1);a.uniform1i(q.uniforms.isVertical,!0);a.uniform1f(q.uniforms.blurSize,d.blurSize||2);a.uniform2fv(q.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.useProgram(q.program);a.bindFramebuffer(a.FRAMEBUFFER,p);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,h.texture);a.uniform1i(q.uniforms.uSampler,
1);a.uniform1i(q.uniforms.isVertical,!1);a.uniform1f(q.uniforms.blurSize,d.blurSize||2);a.uniform2fv(q.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.useProgram(l.program);a.bindFramebuffer(a.FRAMEBUFFER,b);a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,c);a.uniform1i(l.uniforms.originalTexture,1);a.uniform1f(l.uniforms.toneScale,e);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,
p.texture);a.uniform1i(l.uniforms.bloomTexture,0);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3);a.bindBuffer(a.ARRAY_BUFFER,null);a.useProgram(null)}}]);return d}(pb),bd=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"getProgram",value:function(b){this.programSample||(this.programSample=new K(b,{vertexShader:"attribute vec3 aPos;attribute vec2 aTextureCoord;varying vec2 vTextureCoord;void main(){vTextureCoord=aTextureCoord;gl_Position=vec4(aPos,1.0);}",
fragmentShader:"precision mediump float;uniform sampler2D uSampler;uniform vec2 canvasSize;varying vec2 vTextureCoord;void main(){float fStep=1.0/312.0;vec4 sample11=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample12=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t+1.0*fStep));vec4 sample13=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t+1.0*fStep));vec4 sample21=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t));vec4 sample22=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t));vec4 sample23=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t));vec4 sample31=texture2D(uSampler,vec2(vTextureCoord.s-1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 sample32=texture2D(uSampler,vec2(vTextureCoord.s,vTextureCoord.t-1.0*fStep));vec4 sample33=texture2D(uSampler,vec2(vTextureCoord.s+1.0*fStep,vTextureCoord.t-1.0*fStep));vec4 blurSample=(sample11+sample12+sample13+sample21+2.0*sample22+sample23+sample31+sample32+sample33)/10.0;float desX=abs((gl_FragCoord.x-canvasSize.x/2.0)/(canvasSize.x/2.0));float desY=abs((gl_FragCoord.y-canvasSize.y/2.0)/(canvasSize.y/2.0));float factor=max(desX,desY);gl_FragColor=(sample22*(1.0-factor)+blurSample*factor);}"}));
return this.programSample}},{key:"render",value:function(b){var a=b.gl;b=b.texture;var c=this.getProgram(a);a.useProgram(c.program);var d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertex),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aPos);a.vertexAttribPointer(c.attributes.aPos,3,a.FLOAT,!1,0,0);d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.sampleCoord),a.STATIC_DRAW);a.enableVertexAttribArray(c.attributes.aTextureCoord);
a.vertexAttribPointer(c.attributes.aTextureCoord,2,a.FLOAT,!1,0,0);a.activeTexture(a.TEXTURE1);a.bindTexture(a.TEXTURE_2D,b);a.uniform1i(c.uniforms.uSampler,1);a.uniform2fv(c.uniforms.canvasSize,[a.canvas.width,a.canvas.height]);a.drawArrays(a.TRIANGLES,0,this.vertex.length/3)}}]);return d}(pb),rc=function(){function c(d){x(this,c);this.gl=d;this.effects=[];this.initFbo()}y(c,[{key:"addEffect",value:function(c){this.effects.push(c)}},{key:"removeEffect",value:function(c){}},{key:"setEffects",value:function(c){this.effects=
c}},{key:"initFbo",value:function(){var c=this.gl;this.fbo=[new Ha(c),new Ha(c)]}},{key:"render",value:function(){var c=this.gl,b=this.effects;if(b&&0<b.length)for(var a={},f=0;f<b.length;f++){var k=this.fbo[f%2].framebuffer;f===b.length-1&&(k=null);c.bindFramebuffer(c.FRAMEBUFFER,k);var e=[0,0,0,0];c.clearColor(e[0],e[1],e[2],e[3]);c.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT);b[f].render({gl:c,texture:a.texture,fbo:k});a=k}}}]);return c}(),ab=function(){function c(d){x(this,c);this.map=d}y(c,[{key:"onResize",
value:function(c){}},{key:"onUpdate",value:function(c){throw"\u672a\u5b9e\u73b0onUpdate\u65b9\u6cd5";}},{key:"getContainer",value:function(){throw"\u672a\u5b9e\u73b0getContainer\u65b9\u6cd5";}},{key:"getSize",value:function(){throw"\u672a\u5b9e\u73b0getSize\u65b9\u6cd5";}},{key:"getTilt",value:function(){throw"\u672a\u5b9e\u73b0getTilt\u65b9\u6cd5";}},{key:"getHeading",value:function(){throw"\u672a\u5b9e\u73b0getHeading\u65b9\u6cd5";}},{key:"getZoomUnits",value:function(){throw"\u672a\u5b9e\u73b0getZoomUnits\u65b9\u6cd5";
}},{key:"getCenter",value:function(){throw"\u672a\u5b9e\u73b0getCenter\u65b9\u6cd5";}},{key:"lnglatToMercator",value:function(c,b){c=ja.convertLL2MC({lng:c,lat:b});return[c.lng,c.lat]}}]);return c}(),cd=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"onResize",value:function(b){this.map.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){this.map.addEventListener("update",b);this.map.addEventListener("onearthstatuschange",
b)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return this.map.getTilt()}},{key:"getHeading",value:function(){return this.map.getHeading()}},{key:"getZoomUnits",value:function(){return this.map.getZoomUnits()}},{key:"getCenter",value:function(){var b=this.map.getCenter();-180<=b.lng&&180>=b.lng&&(b=this.map.lnglatToMercator(b.lng,b.lat),b={lng:b[0],lat:b[1]});return b}},{key:"lnglatToMercator",
value:function(b,a){return this.map.lnglatToMercator(b,a)}}]);return d}(ab),dd=function(c){function d(b){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b));b.div=document.createElement("div");b.div.style.position="absolute";b.div.style.userSelect="none";b.map.getPanes().mapPane.appendChild(b.div);return b}H(d,c);y(d,[{key:"onResize",value:function(b){this.map.addEventListener("resize",b)}},{key:"changeCanvas",value:function(){var b=this.map,a=b.getSize(),c=b.getCenter();b=b.pointToOverlayPixel(c);
this.div.style.left=b.x-a.width/2+"px";this.div.style.top=b.y-a.height/2+"px"}},{key:"onUpdate",value:function(b){var a=this;this.map.addEventListener("moveend",function(){a.changeCanvas();b()});this.map.addEventListener("moving",function(){a.changeCanvas();b()});this.map.addEventListener("zoomend",function(){a.changeCanvas();b()})}},{key:"getContainer",value:function(){return this.div}},{key:"getSize",value:function(){return this.map.getSize()}},{key:"getTilt",value:function(){return 0}},{key:"getHeading",
value:function(){return 0}},{key:"getZoomUnits",value:function(){return Math.pow(2,18-this.map.getZoom())}},{key:"getCenter",value:function(){var b=this.map.getMapType().getProjection().lngLatToPoint(this.map.getCenter());return{lng:b.x,lat:b.y}}}]);return d}(ab),ed=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"onResize",value:function(b){window.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){}},{key:"getContainer",
value:function(){return this.map.container.getElementsByClassName("cesium-widget")[0]}},{key:"getSize",value:function(){var b=this.map;return{width:b.canvas.clientWidth,height:b.canvas.clientHeight}}},{key:"getTilt",value:function(){return 180*this.map.camera.pitch/Math.PI+90}},{key:"getHeading",value:function(){return 360-180*this.map.camera.heading/Math.PI}},{key:"getZoomUnits",value:function(){var b=this.map;return 6.8*b.scene.globe.ellipsoid.cartesianToCartographic(b.camera.position).height/6500}},
{key:"getCenter",value:function(){var b=this.map;b=b.camera.pickEllipsoid(new Cesium.Cartesian2(b.canvas.clientWidth/2,b.canvas.clientHeight/2));b=Cesium.Ellipsoid.WGS84.cartesianToCartographic(b);b=this.getMercator([180*b.longitude/Math.PI,180*b.latitude/Math.PI]);return{lng:b[0],lat:b[1]}}},{key:"getMercator",value:function(b){var a=[];a[0]=b[0]*Math.PI/180*6378137;b=b[1]*Math.PI/180;a[1]=3189068.5*Math.log((1+Math.sin(b))/(1-Math.sin(b)));return a}}]);return d}(ab),fd=function(c){function d(b){x(this,
d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"onResize",value:function(b){window.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",
value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]);return d}(ab),gd=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"onResize",value:function(b){window.addEventListener("resize",b)}},{key:"onUpdate",value:function(b){}},{key:"getContainer",value:function(){return this.map.container}},{key:"getSize",value:function(){return{width:this.map.container.clientWidth,height:this.map.container.clientHeight}}},
{key:"getTilt",value:function(){return this.map.tilt}},{key:"getHeading",value:function(){return this.map.heading}},{key:"getZoomUnits",value:function(){return this.map.zoomUnits}},{key:"getCenter",value:function(){return this.map.center}}]);return d}(ab),sc=function(){function c(d,b){x(this,c);b=b||{};this.map="bmap"===b.mapType?new dd(d,this):"blank"===b.mapType?new fd(d):"cesium"===b.mapType?new ed(d):"three"===b.mapType?new gd(d):new cd(d);this.map.type=b.mapType;this.options=b||{};this.renderArr=
[];(d=b.canvas)||(d=document.createElement("canvas"));this.canvas=d;this.gl=b.gl?b.gl:gc(d);this.changeSize();this.pMatrix=J.create(Float64Array);this.oMatrix=J.create(Float64Array);this.matrix=J.create(Float64Array);this.viewMatrix=J.create(Float64Array);this.fovy=35;this._animation=this.animation.bind(this);this._update=this.update.bind(this);this.onInitialize(this.options.onInitialize);this.options.onRender&&this.renderArr.push(this.options.onRender);this.transferOptions={};this.bindBMapGL()}y(c,
[{key:"bindBMapGL",value:function(){var c=this,b=this.map;b.onResize(function(){c.changeSize();c.render()});b.onUpdate(this._update);this.options.canvas||b.getContainer().appendChild(this.canvas)}},{key:"setOptions",value:function(c){this.options=c}},{key:"onInitialize",value:function(c){c&&(this.transferOptions=c.bind(this)(this.gl)||{})}},{key:"onRender",value:function(c){this.renderArr.push(c)}},{key:"changeSize",value:function(){var c=this.canvas;if(c){var b=c.style,a=this.map.getSize(),f=window.devicePixelRatio;
c.width=a.width*f;c.height=a.height*f;b.cssText="position: absolute;left:0;top:0;width:"+a.width+"px;height:"+a.height+"px;z-index:2;";a=this.options;"cesium"!==a.mapType||a.canvas||(b.pointerEvents="none");this.gl.viewport(0,0,c.width,c.height)}}},{key:"update",value:function(){!1===this.options.autoUpdate||this.isAnimation||this.render()}},{key:"render",value:function(){if(this.map){var c=this.options,b=this.pMatrix,a=this.viewMatrix;if("three"===c.mapType)a=this.map.map.camera,b=a.projectionMatrix.elements,
a=a.matrixWorldInverse.elements;else if("cesium"===c.mapType){a=this.map.map;var f=a.camera.frustum.projectionMatrix;b=new Float32Array([f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]]);f=a.camera.viewMatrix;a=new Float32Array([f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]])}else this.updateProjectionMatrix(),this.updateModelViewMatrix();f=J.multiply(this.matrix,b,a);Object.assign(this.transferOptions,{gl:this.gl,matrix:f,
projectionMatrix:b,orthoMatrix:this.oMatrix,viewMatrix:a});"three"!==c.mapType&&"cesium"!==c.mapType&&this.clear();for(c=0;c<this.renderArr.length;c++)this.renderArr[c]&&this.renderArr[c].bind(this)(this.transferOptions)}}},{key:"clear",value:function(c){var b=this.gl,a=this.options.clearColor||[0,0,0,0];b.clearColor(a[0],a[1],a[2],a[3]);c&&(c instanceof Array||(c=T(c).unitArray()),b.clearColor(c[0],c[1],c[2],c[3]));b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)}},{key:"updateProjectionMatrix",value:function(){var c=
this.gl.canvas.width/this.gl.canvas.height;J.perspective(this.pMatrix,gb(this.fovy),c,1,4E3);this.map.getSize();J.ortho(this.oMatrix,0,this.gl.canvas.width,0,this.gl.canvas.height,1,4E3)}},{key:"updateModelViewMatrix",value:function(){var c=this.map,b=this.viewMatrix;J.identity(b);var a=c.getSize();a=Math.round(-a.height/(2*Math.tan(gb(this.fovy)/2)));J.translate(b,b,[0,0,a]);J.rotate(b,b,gb(c.getTilt()),[-1,0,0]);J.translate(b,b,[0,0,-a]);J.rotate(b,b,gb(c.getHeading()),[0,0,-1]);var f=c.getCenter(),
k=this.options.pointOffset||[0,0];c=c.getZoomUnits();J.translate(b,b,[(k[0]-f.lng)/c,(k[1]-f.lat)/c,a]);c=1/c;J.scale(b,b,[c,c,c])}},{key:"destroy",value:function(){this.stopAnimation();this.map.getContainer().removeChild(this.canvas);this.canvas=null}},{key:"animation",value:function(){this.isAnimation&&(this.render(),window.requestAnimationFrame(this._animation))}},{key:"startAnimation",value:function(){this.isAnimation||(this.isAnimation=!0,window.requestAnimationFrame(this._animation))}},{key:"stopAnimation",
value:function(){this.isAnimation=!1}}]);return c}(),da=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"normizedColor",value:function(b){var a=b;b instanceof Array||(a=T(b).unitArray());void 0===a[3]&&(a[3]=1);return a}},{key:"normizedPoint",value:function(b){if(!b||!b[0]||!b[1])return[0,0,0];var a=[0,0],c=this.getOptions();this.webglLayer&&this.webglLayer.options.pointOffset?a=this.webglLayer.options.pointOffset:c.pointOffset&&
(a=c.pointOffset);c=Number(b[0]);var d=Number(b[1]);-180<=c&&180>=c&&-90<=d&&90>=d&&(d=this.webglLayer.map.lnglatToMercator(c,d),c=d[0],d=d[1]);var e=Number(b[2])||0;this.webglLayer&&"cesium"===this.webglLayer.options.mapType&&window.Cesium&&(c=this.convertLngLat([c,d]),e=window.Cesium.Cartesian3.fromDegrees(c[0],c[1],e),c=e.x,d=e.y,e=e.z);return 3<b.length?[c-a[0],d-a[1],e].concat(lb(b.slice(3))):[c-a[0],d-a[1],e]}},{key:"convertLngLat",value:function(b){return[b[0]/2.003750834E7*180,180/Math.PI*
(2*Math.atan(Math.exp(b[1]/2.003750834E7*180*Math.PI/180))-Math.PI/2)]}},{key:"getPointOffset",value:function(){return this.webglLayer&&this.webglLayer.options.pointOffset?this.webglLayer.options.pointOffset:[0,0]}}]);return d}(Ab),ic="undefined"===typeof Symbol?"__target":Symbol(),Jc=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,Pa=window.URL||window.webkitURL,Ta=window.Worker;if(Ta){var tc=hc("self.onmessage = function () {}"),uc=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw Error("Not available");
var ac=new Ta(tc);ac.postMessage(uc,[uc.buffer])}catch(c){Ta=null}finally{Pa.revokeObjectURL(tc),ac&&ac.terminate()}}var hd=new xb("./worker.js",function(c,d){function b(b){function c(a,c){for(var e=0;e<D;e++){var l=a*D+e,h=l-B,m=f.vertex.length-1;l=k.data[4*l+3];var n=15*l+10;void 0!==b.vertexHeight&&("[object Function]"===Object.prototype.toString.call(b.vertexHeight)?n=b.vertexHeight({opacity:l}):-1!==b.vertexHeight&&(n=b.vertexHeight));f.vertex[m].push(t[0]+x*e/D-A[0],t[1]-w*a/v-A[1],n);f.color[m].push(d[4*
l]/255,d[4*l+1]/255,d[4*l+2]/255,l/255);e<D-1&&a<v-1&&!1!==c&&(f.index[m].push(h+D,h+1,h),f.index[m].push(h+1,h+D,h+D+1))}}var d=b.intensity;f=null;f={vertex:[[]],vertexBuffer:[],color:[[]],colorBuffer:[],index:[[]],indexBuffer:[]};var k=b.ctx,q=b.bound,h=b.canvasWidth,p=b.canvasHeight,m=b.zoomUnit,t=[q.minX,q.maxY],D=h,v=p,x=h/b.totalScale*m,w=p/b.totalScale*m,A=b.pointOffset||[0,0],B=0;for(q=0;q<v;q++)65536<f.vertex[f.vertex.length-1].length/3+2*D&&(B+=f.vertex[f.vertex.length-1].length/3,c(q,!1),
f.vertex.push([]),f.color.push([]),f.index.push([])),c(q);for(q=0;q<f.vertex.length;q++)f.vertexBuffer[q]=new Float32Array(f.vertex[q]),f.colorBuffer[q]=new Float32Array(f.color[q]),f.indexBuffer[q]=new Uint16Array(f.index[q]);a.postMessage(f)}var a=this,f=null;a.addEventListener("message",function(a){b(a.data)},!1)});pa.prototype.scale=function(c,d){this.totalScale=c;this.canvasScale=d;c=this.canvas;var b=c.style;this.map.getSize();var a=this.heatmapLayer.getBounds(),f=this.map.getZoomUnits();var k=
(a.maxX-a.minX)/f;a=(a.maxY-a.minY)/f;k=k*d*this.totalScale;a=a*d*this.totalScale;c.width=k;c.height=a;b.cssText="background: white; position: absolute;left:0;top:0;width:"+k+"px;height:"+a+"px;z-index:3;";this.ctx=c.getContext("2d")};pa.prototype.getImageData=function(){var c=this.ctx;return c.getImageData(0,0,c.canvas.width,c.canvas.height)};pa.prototype.setData=function(c){this.data=c;this._update()};pa.prototype.update=function(c){var d=this;this.clear();this._draw&&clearTimeout(this._draw);var b=
this;this._draw=setTimeout(function(){b._draw=null;d._update();c&&c()},500)};pa.prototype.clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)};pa.prototype._update=function(){this.drawHeatmap(this.ctx)};pa.prototype.drawHeatmap=function(c){var d=this.options;c=this.ctx;c.clearRect(0,0,c.canvas.width,c.canvas.height);c.save();d=d.scale||1;c.scale(d,d);this.drawGray();c.restore()};pa.prototype.drawGray=function(){var c=this.map,d=this.ctx,b=this.options,a=b.max||100,
f=b.size||600,k=f/=this.map.getZoomUnits(),e=k/2,l=k+e;f=new hb(2*l,2*l);var n=f.getContext("2d");n.shadowBlur=e;n.shadowColor="black";n.shadowOffsetX=n.shadowOffsetY=1E4;n.beginPath();n.arc(l-1E4,l-1E4,k,0,2*Math.PI,!0);n.closePath();n.fill();k=f.width/2;e=f.height/2;l=this.data;c=c.getZoomUnits();n=this.heatmapLayer.getBounds();var q=n.minX,h=n.maxY,p=100*c;if(l)for(var m=this.heatmapLayer.getPointOffset(),t=0;t<l.length;t++){var D=l[t];if(D.geometry){var v=this.heatmapLayer.normizedPoint(D.geometry.coordinates);
v[0]+=m[0];v[1]+=m[1];if(!(~~v[0]<n.minX-p||~~v[0]>n.maxX+p||~~v[1]>n.maxY+p||~~v[1]<n.minY-p)){var x=void 0===D.count?1:D.count;"properties"in D&&"count"in D.properties&&(x=D.properties.count);D=Math.min(1,x/a);d.globalAlpha=void 0!==b.globalAlpha?b.globalAlpha:D;D=(v[0]-q)/c;v=(h-v[1])/c;0<f.width&&0<f.height&&d.drawImage(f,D-k,v-e)}}}};pa.prototype.destroy=function(){this.canvas=null};Jb.prototype.initWorker=function(){var c=this;this.worker=new hd;var d=this.gl;this.worker.onmessage=function(b){c.output=
b.data;for(b=0;b<c.output.vertex.length;b++){var a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.bufferData(d.ARRAY_BUFFER,c.output.vertexBuffer[b],d.STATIC_DRAW);c.output.vertexBuffer[b]=a;d.bindBuffer(d.ARRAY_BUFFER,null);a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.bufferData(d.ARRAY_BUFFER,c.output.colorBuffer[b],d.STATIC_DRAW);c.output.colorBuffer[b]=a;d.bindBuffer(d.ARRAY_BUFFER,null);a=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a);d.bufferData(d.ELEMENT_ARRAY_BUFFER,c.output.indexBuffer[b],
d.STATIC_DRAW);c.output.indexBuffer[b]=a;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null)}c.layer.webglLayer.render()}};Jb.prototype.getData=function(){return this.output};var id=function(c){function d(b){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b));b.totalScale=1/3;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{scale:1/3,size:600,max:40,gradient:{"0.25":"rgba(0, 0, 255, 1)","0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"}}}},
{key:"initialize",value:function(b){var a=this.map;this.intensity=new X({gradient:this.options.gradient});this._canvasScale=1.1;this._isShow=!0;this.canvasLayer=new pa(a,this.options,this);this.canvasLayer.scale(this.totalScale,this._canvasScale);this._update=this.update.bind(this);a.map.addEventListener("update",this._update);this.gl=b;this.dataMgr=new Jb(this,this.map,this.gl);this.program=new K(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;uniform mat4 u_matrix;varying vec4 vColor;void main(void){gl_Position=u_matrix*vec4(aPos,1);gl_PointSize=10.0;vColor=aColor;}",
fragmentShader:"precision highp float;varying vec4 vColor;void main(void){gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(b,a){this.intensity=new X({gradient:b.gradient});this.canvasLayer.setData(a);this.updateHeatmapModel()}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;a.useProgram(b.program);a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c);a.lineWidth(100);a.enable(a.BLEND);a.disable(a.CULL_FACE);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);if(c=this.dataMgr.getData())for(var d=
0;d<c.vertexBuffer.length;d++)a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffer[d]),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(b.attributes.aPos),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ARRAY_BUFFER,c.colorBuffer[d]),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,0,0),a.enableVertexAttribArray(b.attributes.aColor),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.indexBuffer[d]),a.drawElements(a.TRIANGLES,c.index[d].length,
a.UNSIGNED_SHORT,0),a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND)}},{key:"update",value:function(b){var a=this;a._isShow?(a.canvasLayer.scale(a.totalScale,a._canvasScale),a.canvasLayer.update(function(){a.updateHeatmapModel()}),a.webglLayer.render()):a.webglLayer.clear()}},{key:"destroy",value:function(){this.setData([]);this.map.map.removeEventListener("update",this._update);this.canvasLayer.destroy()}},{key:"updateHeatmapModel",value:function(){var b=this.getOptions(),a=this.canvasLayer.ctx;
if(!(0>=a.canvas.width||0>=a.canvas.height)){var c=this.map;this.dataMgr.worker.postMessage({intensity:this.intensity.getImageData(),vertexHeight:b.vertexHeight,ctx:a.getImageData(0,0,a.canvas.width,a.canvas.height),totalScale:this.totalScale,canvasScale:this._canvasScale,canvasWidth:a.canvas.width,pointOffset:this.webglLayer.options.pointOffset||[0,0],canvasHeight:a.canvas.height,bound:this.getBounds(),mapSize:c.getSize(),center:c.getCenter(),zoomUnit:c.getZoomUnits()});this.webglLayer.render()}}},
{key:"getBounds",value:function(){var b=this.map.map.getBounds(),a=b.getNorthEast();b=b.getSouthWest();-180<a.lng&&180>a.lat&&(b=ja.convertLL2MC({lng:b.lng,lat:b.lat}),a=ja.convertLL2MC({lng:a.lng,lat:a.lat}));return{minX:b.lng,minY:b.lat,maxX:a.lng,maxY:a.lat}}}]);return d}(da),jd=new xb("./worker.js",function(c,d){function b(a){this.canvasScale=1.1;this.options=a||{};var b=new OffscreenCanvas(100,1);this.data=[];this.canvas=b;this.ctx=b.getContext("2d");this.circleSize=a.size||600}function a(a){function b(b,
d){for(var f=0;f<y;f++){var e=b*y+f,h=e-E,m=k.vertex.length-1;e=l.data[4*e+3];var n=15*e+10;void 0!==a.vertexHeight&&("[object Function]"===Object.prototype.toString.call(a.vertexHeight)?n=a.vertexHeight({opacity:e}):-1!==a.vertexHeight&&(n=a.vertexHeight));k.vertex[m].push(x[0]+A*f/y-C[0],x[1]-B*b/w-C[1],n);k.color[m].push(c[4*e]/255,c[4*e+1]/255,c[4*e+2]/255,e/255);f<y-1&&b<w-1&&!1!==d&&(k.index[m].push(h+y,h+1,h),k.index[m].push(h+1,h+y,h+y+1))}}if(e){e.circleSize=a.canvasData.circleSize;e.setSize(a.canvasSize);
e.setData(a.canvasData.data);e.update();var c=a.intensity;k=null;k={vertex:[[]],vertexBuffer:[],color:[[]],colorBuffer:[],index:[[]],indexBuffer:[]};var d=e.ctx,l=d.getImageData(0,0,d.canvas.width,d.canvas.height),m=a.bound,t=d.canvas.width;d=d.canvas.height;var v=a.zoomUnit,x=[m.minX,m.maxY],y=t,w=d,A=t/a.totalScale*v,B=d/a.totalScale*v,C=a.pointOffset||[0,0],E=0;for(m=0;m<w;m++)65536<k.vertex[k.vertex.length-1].length/3+2*y&&(E+=k.vertex[k.vertex.length-1].length/3,b(m,!1),k.vertex.push([]),k.color.push([]),
k.index.push([])),b(m);for(m=0;m<k.vertex.length;m++)k.vertexBuffer[m]=new Float32Array(k.vertex[m]),k.colorBuffer[m]=new Float32Array(k.color[m]),k.indexBuffer[m]=new Uint16Array(k.index[m]);f.postMessage(k)}}var f=this;b.prototype.setSize=function(a){var b=this.canvas;b.width=a.width;b.height=a.height};b.prototype.getImageData=function(){var a=this.ctx;return a.getImageData(0,0,a.canvas.width,a.canvas.height)};b.prototype.setData=function(a){this.data=a};b.prototype.update=function(){this.clear();
this._update()};b.prototype.clear=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)};b.prototype._update=function(){this.drawHeatmap(this.ctx)};b.prototype.drawHeatmap=function(a){var b=this.options;a=this.ctx;a.clearRect(0,0,a.canvas.width,a.canvas.height);a.save();b=b.scale||1;a.scale(b,b);this.drawGray();a.restore()};b.prototype.drawGray=function(){var a=this.ctx,b=this.circleSize,c=b/2,d=b+c,f=new OffscreenCanvas(2*d,2*d),e=f.getContext("2d");e.shadowBlur=c;e.shadowColor=
"black";e.shadowOffsetX=e.shadowOffsetY=1E4;e.beginPath();e.arc(d-1E4,d-1E4,b,0,2*Math.PI,!0);e.closePath();e.fill();if(b=this.data)for(c=0;c<b.length;c++)d=b[c],a.globalAlpha=d.alpha,0<f.width&&0<f.height&&a.drawImage(f,d.x,d.y)};b.prototype.destroy=function(){this.canvas=null};var k=null,e;f.addEventListener("message",function(c){c=c.data;"updateHeatmapModel"===c.type?a(c):"initialize"===c.type&&(e=new b(c.options),e.setSize(c.canvasSize))},!1)});Kb.prototype.initWorker=function(){var c=this;this.worker=
new jd;var d=this.gl;this.worker.onmessage=function(b){c.output=b.data;for(b=0;b<c.output.vertex.length;b++){var a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.bufferData(d.ARRAY_BUFFER,c.output.vertexBuffer[b],d.STATIC_DRAW);c.output.vertexBuffer[b]=a;d.bindBuffer(d.ARRAY_BUFFER,null);a=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,a);d.bufferData(d.ARRAY_BUFFER,c.output.colorBuffer[b],d.STATIC_DRAW);c.output.colorBuffer[b]=a;d.bindBuffer(d.ARRAY_BUFFER,null);a=d.createBuffer();d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,
a);d.bufferData(d.ELEMENT_ARRAY_BUFFER,c.output.indexBuffer[b],d.STATIC_DRAW);c.output.indexBuffer[b]=a;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,null)}c.layer.webglLayer.render()}};Kb.prototype.getData=function(){return this.output};var kd=function(c){function d(b){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b));b.canvasScale=1.1;b.totalScale=1/3;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{scale:1/3,size:600,max:40,gradient:{"0.25":"rgba(0, 0, 255, 1)",
"0.55":"rgba(0, 255, 0, 1)","0.85":"rgba(255, 255, 0, 1)",1:"rgba(255, 0, 0, 1)"}}}},{key:"initialize",value:function(b){var a=this.map;this.intensity=new X({gradient:this.options.gradient});this._isShow=!0;this._update=this.update.bind(this);a.map.addEventListener("update",this._update);this.gl=b;this.dataMgr=new Kb(this,this.map,this.gl);this.dataMgr.worker.postMessage({type:"initialize",canvasSize:this.getCanvasSize(),options:this.options});this.program=new K(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;uniform mat4 u_matrix;varying vec4 vColor;void main(void){gl_Position=u_matrix*vec4(aPos,1);gl_PointSize=10.0;vColor=aColor;}",
fragmentShader:"precision highp float;varying vec4 vColor;void main(void){gl_FragColor=vColor;}"})}},{key:"getCanvasSize",value:function(){var b=this.getBounds(),a=this.map.getZoomUnits();this.map.getSize();var c=(b.maxX-b.minX)/a;b=(b.maxY-b.minY)/a;c=c*this.canvasScale*this.totalScale;b=b*this.canvasScale*this.totalScale;return{width:c,height:b}}},{key:"getCanvasData",value:function(b,a){var c=[],d=this.map.getZoomUnits(),e=this.getBounds(),l=this.getPointOffset(),n=e.minX,q=e.maxY,h=b.size||600,
p=h/=this.map.getZoomUnits(),m=3*h;h*=3;for(var t=b.max||100,v=100*d,x=0;x<a.length;x++){var y=a[x];if(y.geometry){var w=this.normizedPoint(y.geometry.coordinates);w[0]+=l[0];w[1]+=l[1];if(!(~~w[0]<e.minX-v||~~w[0]>e.maxX+v||~~w[1]>e.maxY+v||~~w[1]<e.minY-v)){var A=void 0===y.count?1:y.count;"properties"in y&&"count"in y.properties&&(A=y.properties.count);y=Math.min(1,A/t);c.push({x:(w[0]-n)/d-m,y:(q-w[1])/d-h,alpha:void 0!==b.globalAlpha?b.globalAlpha:y})}}}return{circleSize:p,data:c}}},{key:"onChanged",
value:function(b,a){this.intensity=new X({gradient:b.gradient})}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;a.useProgram(b.program);a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c);a.lineWidth(100);a.enable(a.BLEND);a.disable(a.CULL_FACE);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);if(c=this.dataMgr.getData())for(var d=0;d<c.vertexBuffer.length;d++)a.bindBuffer(a.ARRAY_BUFFER,c.vertexBuffer[d]),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,0,0),a.enableVertexAttribArray(b.attributes.aPos),
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ARRAY_BUFFER,c.colorBuffer[d]),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,0,0),a.enableVertexAttribArray(b.attributes.aColor),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,c.indexBuffer[d]),a.drawElements(a.TRIANGLES,c.index[d].length,a.UNSIGNED_SHORT,0),a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND)}},{key:"update",value:function(b){var a=this;this._isShow?(this.canvasUpdate(function(){a.updateHeatmapModel()}),
this.webglLayer.render()):this.webglLayer.clear()}},{key:"canvasUpdate",value:function(b){this._draw&&clearTimeout(this._draw);this._draw=setTimeout(function(){b&&b()},500)}},{key:"destroy",value:function(){this.setData([]);this.map.map.removeEventListener("update",this._update)}},{key:"updateHeatmapModel",value:function(){var b=this.getOptions(),a=this.map;this.dataMgr.worker.postMessage({type:"updateHeatmapModel",intensity:this.intensity.getImageData(),canvasData:this.getCanvasData(this.options,
this.getData()),canvasSize:this.getCanvasSize(),vertexHeight:b.vertexHeight,totalScale:this.totalScale,canvasScale:this.canvasScale,pointOffset:this.webglLayer.options.pointOffset||[0,0],bound:this.getBounds(),mapSize:a.getSize(),center:a.getCenter(),zoomUnit:a.getZoomUnits()});this.webglLayer.render()}},{key:"getBounds",value:function(){var b=this.map.map.getBounds(),a=b.getNorthEast();b=b.getSouthWest();-180<a.lng&&180>a.lat&&(b=ja.convertLL2MC({lng:b.lng,lat:b.lat}),a=ja.convertLL2MC({lng:a.lng,
lat:a.lat}));return{minX:b.lng,minY:b.lat,maxX:a.lng,maxY:a.lat}}}]);return d}(da);ib.deviation=function(c,d,b,a){var f=d&&d.length,k=Math.abs(Lb(c,0,f?d[0]*b:c.length,b));if(f){f=0;for(var e=d.length;f<e;f++)k-=Math.abs(Lb(c,d[f]*b,f<e-1?d[f+1]*b:c.length,b))}for(f=d=0;f<a.length;f+=3){e=a[f]*b;var l=a[f+1]*b,n=a[f+2]*b;d+=Math.abs((c[e]-c[n])*(c[l+1]-c[e+1])-(c[e]-c[l])*(c[n+1]-c[e+1]))}return 0===k&&0===d?0:Math.abs((d-k)/k)};ib.flatten=function(c){for(var d=c[0][0].length,b={vertices:[],holes:[],
dimensions:d},a=0,f=0;f<c.length;f++){for(var k=0;k<c[f].length;k++)for(var e=0;e<d;e++)b.vertices.push(c[f][k][e]);0<f&&(a+=c[f-1].length,b.holes.push(a))}return b};ib.default=ib;var ld=new xb("./worker.js",function(c,d){}),vc={window:1,windowAnimation:2,gradual:3,ripple:4},wc=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b._isShow=!0;a=b.getOptions();if("windowAnimation"===a.style||"ripple"===a.style||0<a.riseTime)b.autoUpdate=!0;b.textureCache=
{};return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{opacity:.8,isTextureFull:!1,topColor:"rgba(76, 76, 76, 76)",textureScale:1,useLight:!0,riseTime:0}}},{key:"initialize",value:function(b){this.gl=b;var a=this.getOptions();this.dataMgr=new ma(this,this.gl);this.texture=null;this.isUseTexture=!1;this.program=new K(this.gl,{vertexShader:"precision highp float;attribute vec4 a_pos;attribute vec3 a_normal;attribute vec3 a_color;attribute vec3 a_pre_color;attribute float a_height;attribute float a_pre_height;attribute vec2 a_texture_coord;uniform mat4 u_proj_matrix;uniform mat4 u_mv_matrix;uniform mat4 u_normal_matrix;uniform vec3 u_side_light_dir;uniform bool u_use_lighting;uniform bool u_use_texture;uniform vec3 u_ripple_center;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform float dataTime;uniform float riseTime;uniform vec2 uMapCenter;uniform float uMapZoom;varying float v_height;varying vec3 v_color;varying vec3 v_position;varying vec2 v_texture_coord;const vec3 point_color=vec3(0.06,0.06,0.06);const vec3 light_color=vec3(0.53,0.53,0.53);const vec3 light_color_2=vec3(0.4,0.4,0.4);const vec3 uAmbientColor=vec3(0.2,0.2,0.2);const vec3 uLightingDirection=vec3(0.0,1.0,1.0);const vec3 uDirectionalColor=vec3(1.0,1.0,1.0);float getTransitionValue(float pre_value,float to_value,float dataTime,float riseTime){float result=0.0;if(pre_value==to_value){result=to_value;}else{if(riseTime>0.0&&dataTime<riseTime){result=(pre_value+(to_value-pre_value)*(dataTime/riseTime));}else{result=to_value;}}return result;}void main(){vec4 pos=a_pos;pos.z=pos.z+pos.w*getTransitionValue(a_pre_height,a_height,dataTime,riseTime);v_position=pos.xyz;v_height=a_height;if(u_use_texture){v_texture_coord=a_texture_coord;}vec4 position=u_proj_matrix*u_mv_matrix*vec4(pos.xyz,1.0);gl_Position=position;vec3 icolor=a_color;if(u_use_lighting){vec3 N=normalize(vec3(u_normal_matrix*vec4(a_normal,1.0)));vec4 point_dir=u_mv_matrix*vec4(0,1,0,0);vec3 L_point=normalize(point_dir.xyz);float lambert_point=max(0.0,dot(N,-L_point));vec4 light_dir=u_mv_matrix*vec4(u_side_light_dir,0);vec3 L=normalize(light_dir.xyz);float lambert=max(0.0,dot(N,-L));if(pos.z<5.0){float deepGradientColor=(5.0-pos.z)/8.0;lambert=lambert-deepGradientColor;}vec4 light_dir_2=u_mv_matrix*vec4(0,0,-1,0);vec3 L2=normalize(light_dir_2.xyz);float lambert_2=max(0.0,dot(N,-L2));if(a_pre_color.r==a_color.r&&a_pre_color.g==a_color.g&&a_pre_color.b==a_color.b){}else{if(riseTime>0.0&&dataTime<riseTime){icolor.r=a_pre_color.r+(a_color.r-a_pre_color.r)*(dataTime/riseTime);icolor.g=a_pre_color.g+(a_color.g-a_pre_color.g)*(dataTime/riseTime);icolor.b=a_pre_color.b+(a_color.b-a_pre_color.b)*(dataTime/riseTime);}}v_color=icolor+icolor*light_color*lambert+icolor*light_color_2*lambert_2+icolor*point_color*lambert_point;if(u_use_texture){mat3 normalMatrix=mat3(u_normal_matrix);vec3 transformedNormal=normalMatrix*a_normal;vec3 dir=uLightingDirection;dir=vec3(normalMatrix*vec3(0.0,-1.0,2.0));float directionalLightWeighting=max(dot(normalize(transformedNormal),normalize(dir)),0.0);vec3 vLightWeighting;vLightWeighting=uAmbientColor+uDirectionalColor*directionalLightWeighting;v_color=vLightWeighting;}}else{v_color=icolor;}}",
fragmentShader:"precision highp float;varying vec3 v_color;varying vec3 v_position;varying float v_height;varying vec2 v_texture_coord;uniform vec3 u_ripple_center;uniform vec4 top_color;uniform float u_radius;uniform float style;uniform float alpha;uniform float time;uniform sampler2D u_sampler;uniform bool u_use_lighting;uniform bool u_use_texture;void main(){vec4 color=vec4(v_color,alpha);vec4 textureColor=vec4(1.0,1.0,1.0,1.0);if(u_use_texture){textureColor=texture2D(u_sampler,vec2(v_texture_coord.s,v_texture_coord.t));if(u_use_lighting){color=vec4(textureColor.rgb*v_color,textureColor.a);}else{color=textureColor;}}if(style==1.0||style==2.0){float t=time/1000.0;float diffDistance=5.0;float modX=mod(v_position.x,diffDistance*2.0);float modZ=mod(v_position.z,diffDistance*2.0);if(modX<diffDistance&&modZ<diffDistance&&v_position.z<v_height){color*=1.05;if(time>0.0&&style==2.0){float iX=ceil(v_position.x/diffDistance);float iZ=ceil(v_position.z/diffDistance);float timeDistance=8.0;t+=tan(sin(iZ));color*=(1.0+mod(t,timeDistance)/timeDistance);}}color.a=alpha;}else if(style==5.0){float t=time/1000.0;float diffDistance=10.0;float modZ=mod(v_position.z-t*40.0,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.5);if(v_position.z/v_height<0.3){color.r+=0.2;color.g+=0.2;color.b+=0.2;}if(modZ<diffDistance*2.0-4.0){discard;}}else if(style==3.0){float diffDistance=10.0;float modX=mod(v_position.x,diffDistance*2.0);color.a=1.0-pow(v_position.z/v_height,0.3);}else if(style==4.0){float dis=distance(u_ripple_center,v_position);float rSize=400.0;if(v_position.z>=v_height){color=top_color;}if(dis>u_radius-rSize&&dis<u_radius+rSize){color*=(1.0-abs(dis-u_radius)/rSize)*2.0+1.0;}}gl_FragColor=color;}"},
this);this.vertexBuffer=new ob({gl:b,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.indexBuffer=new ob({gl:b,target:"ELEMENT_ARRAY_BUFFER",usage:"STATIC_DRAW"});var c=[{name:"a_pos",buffer:this.vertexBuffer,size:4,type:"FLOAT",offset:0},{name:"a_normal",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:16},{name:"a_color",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:28},{name:"a_pre_color",buffer:this.vertexBuffer,size:3,type:"FLOAT",offset:40},{name:"a_height",buffer:this.vertexBuffer,
size:1,type:"FLOAT",offset:52},{name:"a_pre_height",buffer:this.vertexBuffer,size:1,type:"FLOAT",offset:56}];a.texture&&c.push({name:"a_texture_coord",buffer:this.vertexBuffer,size:2,type:"FLOAT",offset:60});this.vertexArray=new Qb({gl:b,program:this.program,attributes:c});this.initializeTime=new Date;this.normalMatrix=J.create()}},{key:"onChanged",value:function(b,a){var c=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){c.loadTexture(function(){c.dataMgr.parseData(a);
c.dataTime=new Date;c.webglLayer.render()})},0))}},{key:"render",value:function(b){var a=b.gl,c=b.projectionMatrix;b=b.viewMatrix;if(this._isShow){var d=this.getData();if(d&&!(0>=d.length)){d=this.getOptions();var e=this.program,l=e.uniforms;e.use(a);if(d.texture)if(this.texture)a.activeTexture(a.TEXTURE0),a.uniform1i(l.u_sampler,0),a.bindTexture(a.TEXTURE_2D,this.texture);else return;a.enable(a.DEPTH_TEST);a.enable(a.POLYGON_OFFSET_FILL);a.polygonOffset(1,1);l=a.isEnabled(a.BLEND);var n=a.isEnabled(a.CULL_FACE);
a.disable(a.CULL_FACE);d.blend&&(a.enable(a.BLEND),a.blendFunc(a.ONE,a.ONE),a.blendEquation(a.FUNC_ADD));var q=0;d.style&&vc[d.style]&&(q=vc[d.style]);"gradual"===d.style?(a.depthMask(!1),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)):a.depthMask(!0);var h=this.normizedColor(d.topColor);if("ripple"===d.style&&d.rippleLayer&&d.rippleLayer.data&&d.rippleLayer.data[0]){var p=this.normizedPoint(d.rippleLayer.data[0].geometry.coordinates);e.setUniforms({u_ripple_center:[p[0],p[1],0],
u_radius:d.rippleLayer.options.size*d.rippleLayer.currentScale})}p=Ra.fromValues(0,-1,2);d.lightDir&&(p=Ra.fromValues(d.lightDir[0],d.lightDir[1],d.lightDir[2]));var m=this.normalMatrix;J.invert(m,b);J.transpose(m,m);e.setUniforms({u_normal_matrix:m,u_proj_matrix:c,u_mv_matrix:b,style:q,top_color:h,u_use_lighting:d.useLight,u_use_texture:this.isUseTexture,alpha:void 0===d.opacity?.8:parseFloat(d.opacity),time:new Date-this.initializeTime,dataTime:new Date-this.dataTime,riseTime:d.riseTime,u_side_light_dir:p});
c=this.dataMgr.getData();0<c.vertex.length&&(this.indexBuffer.bind(),this.vertexArray.bind(),a.drawElements(a.TRIANGLES,c.index.length,a.UNSIGNED_INT,0));d.blend&&!1===l&&a.disable(a.BLEND);n&&a.enable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.depthMask(!0);a.disable(a.POLYGON_OFFSET_FILL)}}else this.webglLayer.clear()}},{key:"loadTexture",value:function(b){var a=this,c=this.getOptions();c.texture?(this.isUseTexture=!0,wb(this.gl,c.texture,function(c,d){a.image=d;a.texture=c;b&&b();a.webglLayer.render()})):
(this.isUseTexture=!1,this.image=this.texture=null,b&&b())}}]);return d}(da);ma.prototype.initData=function(){this.outBuilding3d={vertex:[],index:[]}};ma.prototype.getData=function(){return this.outBuilding3d};ma.prototype.initWorker=function(){this.worker=new ld;this.worker.onmessage=function(c){}};ma.prototype.parseData=function(c){var d=this;this.initData();for(var b=this.shapeLayer.getOptions(),a=0;a<c.length;a++){var f=c[a],k=f.height||0;"properties"in f&&"height"in f.properties&&(k=f.properties.height);
k*=1;var e=f.color||b.color||[.1,.1,.1];"properties"in f&&"color"in f.properties&&(e=f.properties.color);"[object Function]"===Object.prototype.toString.call(e)&&(e=e(f));e=this.shapeLayer.normizedColor(e);var l=void 0,n=void 0;b.riseTime&&(n=f.preColor,"properties"in f&&"preColor"in f.properties&&(n=f.properties.preColor),l=f.preHeight,"properties"in f&&"preHeight"in f.properties&&(l=f.properties.preHeight),void 0===l&&(l=0));if(f.geometry.coordinates)if("MultiPolygon"===f.geometry.type)for(var q=
f.geometry.coordinates,h=function(a){var b=[],c=[];f.geometry.coordinates[a][0].forEach(function(a){a=d.shapeLayer.normizedPoint(a);b.push(a[0],a[1]);c.push(a[2])});d.parseBuilding3d(b,c,l,k,n,e,d.outBuilding3d)},p=0;p<q.length;p++)h(p);else(function(){var a=[],b=[];f.geometry.coordinates[0].forEach(function(c){c=d.shapeLayer.normizedPoint(c);a.push(c[0],c[1]);b.push(c[2])});d.parseBuilding3d(a,b,l,k,n,e,d.outBuilding3d)})()}c=[];b=this.outBuilding3d.vertex.length;for(p=0;p<b;p++)for(a=this.outBuilding3d.vertex[p].length,
c.push(this.outBuilding3d.vertex[p][0]),c.push(this.outBuilding3d.vertex[p][1]),q=2;q<a;q++)c.push(this.outBuilding3d.vertex[p][q]);this.shapeLayer.vertexBuffer.updateData(new Float32Array(c));this.shapeLayer.indexBuffer.updateData(new Uint32Array(this.outBuilding3d.index))};ma.prototype.getBounds=function(c){for(var d=c[0],b=c[1],a=c[0],f=c[1],k=0;k<c.length;k+=2)d=Math.min(c[k],d),b=Math.min(c[k+1],b),a=Math.max(c[k],a),f=Math.max(c[k+1],f);return{minX:d,minY:b,maxX:a,maxY:f,width:a-d,height:f-
b}};ma.prototype.parseBuilding3d=function(c,d,b,a,f,k,e){void 0===b&&(b=a);var l=this.shapeLayer.options,n=e.vertex;e=e.index;k=k||[.328125,.51953125,.8125];void 0===f&&(f=k);if("gradual"!=l.style){var q=ib(c),h=q[0],p=q[1],m=q[2];h=[c[2*h],c[2*h+1],1];p=[c[2*p],c[2*p+1],1];var t=[c[2*m],c[2*m+1],1];m=[];Ra.cross(m,[t[0]-p[0],t[1]-p[1],t[2]-p[2]],[h[0]-p[0],h[1]-p[1],h[2]-p[2]]);h=n.length;if(l.texture)var v=this.getBounds(c);p=0;for(t=c.length;p<t;p+=2){var x=[c[p],c[p+1],d[p/2],1,m[0],m[1],m[2],
k[0],k[1],k[2],f[0],f[1],f[2]];x.push(a);x.push(b);l.texture&&(x.push((c[p]-v.minX)/v.width),x.push(-(v.maxY-c[p+1])/v.height));n.push(x)}v=0;for(m=q.length;v<m;v++)e.push(q[v]+h)}if(!(a===b&&0>=a))for(v=q=0,this.shapeLayer.image&&(q=this.shapeLayer.image.width*l.textureScale,v=this.shapeLayer.image.height*l.textureScale),m=0,h=c.length;m<h;m+=2){var y=c[m],w=c[m+1];p=[y,w,d[m/2],0];t=[y,w,d[m/2],1];x=m+2;var A=m+3;m===h-2&&(x=0,A=1);x=c[x];A=c[A];w=Math.sqrt(Math.pow(x-y,2),Math.pow(A-w,2));y=[x,
A,d[m/2],0];x=[x,A,d[m/2],1];A=[];Ra.cross(A,[y[0]-p[0],y[1]-p[1],y[2]-p[2]],[t[0]-p[0],t[1]-p[1],t[2]-p[2]]);p.push(A[0],A[1],A[2]);t.push(A[0],A[1],A[2]);y.push(A[0],A[1],A[2]);x.push(A[0],A[1],A[2]);p.push(k[0],k[1],k[2]);p.push(f[0],f[1],f[2]);t.push(k[0],k[1],k[2]);t.push(f[0],f[1],f[2]);y.push(k[0],k[1],k[2]);y.push(f[0],f[1],f[2]);x.push(k[0],k[1],k[2]);x.push(f[0],f[1],f[2]);p.push(a);p.push(b);t.push(a);t.push(b);y.push(a);y.push(b);x.push(a);x.push(b);l.texture&&(l.isTextureFull?(p.push(0,
0),t.push(0,1),y.push(1,0),x.push(1,1)):(p.push(0,0),t.push(0,a/v),y.push(w/q,0),x.push(w/q,a/v)));w=n.length;n.push(p);n.push(t);n.push(y);n.push(x);e.push(w,w+2,w+3,w,w+3,w+1)}};var xc=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.preHeightMapper={};b.preColorMapper={};return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return Object.assign(Ya(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"getDefaultOptions",this).call(this),
{style:"grid",gridSize:500,height:function(){return 1E3},color:function(){return"rgb(200, 200, 20)"}})}},{key:"generateGrid",value:function(b,a){var c=a.gridSize,d=[],e={};a=b.length;for(var l=this.getPointOffset(),n=0;n<a;n++){var q=this.normizedPoint(b[n].geometry.coordinates);q=~~((q[0]+l[0])/c)+"_"+~~((q[1]+l[1])/c);void 0===e[q]&&(e[q]=0);var h=~~b[n].count||1;"properties"in b[n]&&"count"in b[n].properties&&(h=~~b[n].properties.count);e[q]+=h}Object.keys(e).forEach(function(a){var b=a.split("_");
d.push([b[0]*c+c/2,b[1]*c+c/2,e[a]])});return d}},{key:"onChanged",value:function(b,a){a=this.processData(a);Ya(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"onChanged",this).call(this,b,a)}},{key:"getGridDataRange",value:function(){var b=this.gridData,a=void 0,c=void 0;b[0]&&(a=b[0][2],c=b[0][2]);for(var d=b.length,e=0;e<d;e++){var l=b[e];a=Math.max(l[2],a);c=Math.min(l[2],c)}return{max:a/2,min:c}}},{key:"processData",value:function(b){var a=this.getOptions(),c=a.style,d=a.gridSize,
e=[];this.gridData=e;if("normal"===c){c=this.getPointOffset();for(var l=0;l<b.length;l++){var n=this.normizedPoint(b[l].geometry.coordinates),q=n[0]+c[0];n=n[1]+c[1];var h=~~b[l].count||1;"properties"in b[l]&&"count"in b[l].properties&&(h=~~b[l].properties.count);var p=b[l].color;"properties"in b[l]&&"color"in b[l].properties&&(p=~~b[l].properties.color);e.push([q,n,h,p])}}else e=this.generateGrid(b,a);b=[];this._preHeightMapper={};this._preColorMapper={};for(c=0;c<e.length;c++)l=e[c],l[0]=l[0],l[1]=
l[1],q=l[2],a.height&&(q="function"===typeof a.height?a.height({count:l[2]}):a.height),n=d/2-5,h=l[3],a.color&&(h="function"===typeof a.color?a.color({count:l[2],color:l[3]}):T(h).unitArray()),p="p"+l[0]+l[1],b.push({geometry:{type:"Polygon",coordinates:[[[l[0]-n,l[1]-n],[l[0]-n,l[1]+n],[l[0]+n,l[1]+n],[l[0]+n,l[1]-n]]]},color:h,preHeight:this.preHeightMapper[p],preColor:this.preColorMapper[p],height:q}),this._preHeightMapper[p]=q,this._preColorMapper[p]=h;this.preHeightMapper=this._preHeightMapper;
this.preColorMapper=this._preColorMapper;return b}}]);return d}(wc),yc=function(c){function d(b){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b))}H(d,c);y(d,[{key:"initialize",value:function(b){var a=this;this.children&&this.children.forEach(function(c){c.setWebglLayer(a.getWebglLayer());c.initialize&&c.initialize(b)})}},{key:"isRequestAnimation",value:function(){if(void 0!==this.autoUpdate)return Ya(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"isRequestAnimation",
this).call(this);for(var b=!1,a=0;a<this.children.length;a++)if(this.children[a].isRequestAnimation()){b=!0;break}return b}},{key:"render",value:function(b){this.children&&this.children.forEach(function(a){a.render(b)})}}]);return d}(Ab),md=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.gridLayer=new xc(b.getGridOptions());b.children=[b.gridLayer];b.options.riseTime&&(b.autoUpdate=!0);return b}H(d,c);y(d,[{key:"onDataChanged",value:function(b){this.gridLayer.setData(b)}},
{key:"getGridOptions",value:function(){var b=this.getOptions(),a=b.max,c=b.min;void 0===a&&(c=this.gridLayer.getGridDataRange(),a=c.max,c=c.min);var d=new X({max:a,min:c,gradient:b.gradient,maxSize:b.maxHeight,minSize:b.minHeight});b.height=function(a){var b=d.getSize(a.count);"properties"in a&&"count"in a.properties&&(b=d.getSize(a.properties.count));return b};b.color=function(a){var b=d.getImageData(a.count);"properties"in a&&"count"in a.properties&&(b=d.getImageData(a.properties.count));return[b[0]/
255,b[1]/255,b[2]/255]};return b}},{key:"onOptionsChanged",value:function(b){this.gridLayer.setOptions(this.getGridOptions())}},{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,maxHeight:8E3,minHeight:200,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}}]);return d}(yc),zc=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferData=[];return b}H(d,c);y(d,[{key:"initialize",
value:function(b){this.gl=b;this.program=new K(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"},this);this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",
value:function(b,a){var c=this,d=this.gl;if(d){this.buffer=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,this.buffer);var e=[],l=function(a,b){if(a)for(var d=0;d<a.length-1;d++){var f=c.normizedPoint(a[d]);e.push(f[0]);e.push(f[1]);e.push(f[2]);e.push(b[0],b[1],b[2],b[3]);f=c.normizedPoint(a[d+1]);e.push(f[0]);e.push(f[1]);e.push(f[2]);e.push(b[0],b[1],b[2],b[3])}};b=b.color;for(var n=0;n<a.length;n++){var q=a[n].color||b;"properties"in a[n]&&"color"in a[n].properties&&(q=a[n].properties.color);"[object Function]"===
Object.prototype.toString.call(q)&&(q=q(a[n]));q=this.normizedColor(q);var h=a[n].geometry,p=h.coordinates;if("MultiPolygon"===h.type){if(p)for(h=0;h<p.length;h++)l(p[h][0],q)}else"Polygon"===h.type?p&&l(p[0],q):l(p,q)}this.bufferData=e;this.f32BufferData=new Float32Array(e);d.bufferData(d.ARRAY_BUFFER,this.f32BufferData,d.STATIC_DRAW)}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;!this.bufferData||0>=this.bufferData.length||(b=this.program,b.use(a),a.uniformMatrix4fv(b.uniforms.u_matrix,
!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,7*c,0),a.enableVertexAttribArray(b.attributes.aColor),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,7*c,3*c),b=this.getOptions().blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),
a.drawArrays(a.LINES,0,this.bufferData.length/7),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST),a.useProgram(null))}}]);return d}(da);ea(function(c,d){(function(b,a){c.exports=a()})(Oc,function(){function b(a){return"undefined"!==typeof atob?atob(a):"base64:"+a}function a(a){a=Error("(regl) "+a);console.error(a);throw a;}function c(b,c){b||a(c)}function d(a){return a?": "+a:""}function e(b,c,f){0>c.indexOf(b)&&a("invalid value"+d(f)+". must be one of: "+c)}function l(a,
b){for(a+="";a.length<b;)a=" "+a;return a}function n(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function q(a,b){this.number=a;this.line=b;this.errors=[]}function h(a,b,c){this.file=a;this.line=b;this.message=c}function p(){var a=Error();a=(a.stack||a).toString();var b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function m(){var a=Error();a=(a.stack||a).toString();var b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);
return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function t(a,c){a=a.split("\n");var d=1,f=0,e={unknown:new n,0:new n};e.unknown.name=e[0].name=c||p();e.unknown.lines.push(new q(0,""));for(c=0;c<a.length;++c){var k=a[c],h=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(k);if(h)switch(h[1]){case "line":if(h=/(\d+)(\s+\d+)?/.exec(h[2]))d=h[1]|0,h[2]&&(f=h[2]|0,f in e||(e[f]=new n));break;case "define":if(h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(h[2]))e[f].name=h[1]?b(h[2]):h[2]}e[f].lines.push(new q(d++,
k))}Object.keys(e).forEach(function(a){var b=e[a];b.lines.forEach(function(a){b.index[a.number]=a})});return e}function v(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(a);c?b.push(new h(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new h("unknown",0,a))}});return b}function x(a,b){b.forEach(function(b){var c=a[b.file];if(c){var d=c.index[b.line];if(d){d.errors.push(b);c.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}
function y(a){a._commandRef=p()}function w(b,c){var d=m();a(b+" in command "+(c||p())+("unknown"===d?"":" called from "+d))}function A(a,b,c,f){("undefined"===typeof a?"undefined":V(a))!==b&&w("invalid parameter type"+d(c)+". expected "+b+", got "+("undefined"===typeof a?"undefined":V(a)),f||p())}function B(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:ta[a]*b}function C(a,b){this.id=lb++;this.type=a;this.data=b}function E(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-
1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return E(a.substr(0,b.index)).concat(E(b[1])).concat(E(a.substr(b.index+b[0].length)));b=a.split(".");if(1===b.length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];a=[];for(c=0;c<b.length;++c)a=a.concat(E(b[c]));return a}function F(a){return"["+E(a).join("][")+"]"}function H(){var a={"":0},b=[""];return{id:function(c){var d=
a[c];if(d)return d;d=a[c]=b.length;b.push(c);return d},str:function(a){return b[a]}}}function G(a,b,c){function d(){var b=window.innerWidth,d=window.innerHeight;a!==document.body&&(d=a.getBoundingClientRect(),b=d.right-d.left,d=d.bottom-d.top);f.width=c*b;f.height=c*d;Z(f.style,{width:b+"px",height:d+"px"})}var f=document.createElement("canvas");Z(f.style,{border:0,margin:0,padding:0,top:0,left:0});a.appendChild(f);a===document.body&&(f.style.position="absolute",Z(a.style,{margin:0,padding:0}));window.addEventListener("resize",
d,!1);d();return{canvas:f,onDestroy:function(){window.removeEventListener("resize",d);a.removeChild(f)}}}function K(a,b){function c(c){try{return a.getContext(c,b)}catch(Ja){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function M(a){if("string"===typeof a)return a.split();u(Array.isArray(a),"invalid extension array");return a}function J(a){return"string"===typeof a?(u("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(a)):a}function T(a){var b=
a||{},c;a={};var d=[],f=[],e="undefined"===typeof window?1:window.devicePixelRatio,k=!1,h=function(a){a&&u.raise(a)},l=function(){};if("string"===typeof b){u("undefined"!==typeof document,"selector queries only supported in DOM enviroments");var m=document.querySelector(b);u(m,"invalid query string for element")}else if("object"===("undefined"===typeof b?"undefined":V(b)))if("string"===typeof b.nodeName&&"function"===typeof b.appendChild&&"function"===typeof b.getBoundingClientRect)m=b;else if("function"===
typeof b.drawArrays||"function"===typeof b.drawElements){var z=b;var n=z.canvas}else u.constructor(b),"gl"in b?z=b.gl:"canvas"in b?n=J(b.canvas):"container"in b&&(c=J(b.container)),"attributes"in b&&(a=b.attributes,u.type(a,"object","invalid context attributes")),"extensions"in b&&(d=M(b.extensions)),"optionalExtensions"in b&&(f=M(b.optionalExtensions)),"onDone"in b&&(u.type(b.onDone,"function","invalid or missing onDone callback"),h=b.onDone),"profile"in b&&(k=!!b.profile),"pixelRatio"in b&&(e=+b.pixelRatio,
u(0<e,"invalid pixel ratio"));else u.raise("invalid arguments to regl");m&&("canvas"===m.nodeName.toLowerCase()?n=m:c=m);if(!z){if(!n){u("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");m=G(c||document.body,h,e);if(!m)return null;n=m.canvas;l=m.onDestroy}z=K(n,a)}return z?{gl:z,canvas:n,container:c,extensions:d,optionalExtensions:f,pixelRatio:e,profile:k,onDone:h,onDestroy:l}:(l(),h("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),
null)}function P(a,b){function c(b){u.type(b,"string","extension name must be string");b=b.toLowerCase();try{var c=d[b]=a.getExtension(b)}catch(Sa){}return!!c}for(var d={},f=0;f<b.extensions.length;++f){var e=b.extensions[f];if(!c(e))return b.onDestroy(),b.onDone('"'+e+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}b.optionalExtensions.forEach(c);return{extensions:d,restore:function(){Object.keys(d).forEach(function(a){if(d[a]&&
!c(a))throw Error("(regl): error restoring extension "+a);})}}}function R(a,b){for(var c=Array(a),d=0;d<a;++d)c[d]=b(d);return c}function X(a){var b=(65535<a)<<4;a>>>=b;var c=(255<a)<<3;a>>>=c;b|=c;c=(15<a)<<2;a>>>=c;b|=c;c=(3<a)<<1;return b|c|a>>>c>>1}function da(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}b=c[X(a)>>2];return 0<b.length?b.pop():new ArrayBuffer(a)}function b(a){c[X(a.byteLength)>>2].push(a)}var c=R(8,function(){return[]});return{alloc:a,free:b,allocType:function(b,
c){switch(b){case 5120:b=new Int8Array(a(c),0,c);break;case 5121:b=new Uint8Array(a(c),0,c);break;case 5122:b=new Int16Array(a(2*c),0,c);break;case 5123:b=new Uint16Array(a(2*c),0,c);break;case 5124:b=new Int32Array(a(4*c),0,c);break;case 5125:b=new Uint32Array(a(4*c),0,c);break;case 5126:b=new Float32Array(a(4*c),0,c);break;default:return null}return b.length!==c?b.subarray(0,c):b},freeType:function(a){b(a.buffer)}}}function U(a){return!!a&&"object"===("undefined"===typeof a?"undefined":V(a))&&Array.isArray(a.shape)&&
Array.isArray(a.stride)&&"number"===typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||ka(a.data))}function ea(a,b,c,d,f,e){for(var k=0;k<b;++k)for(var h=a[k],l=0;l<c;++l)for(var m=h[l],n=0;n<d;++n)f[e++]=m[n]}function O(a,b,c,d,f){for(var e=1,k=c+1;k<b.length;++k)e*=b[k];var h=b[c];if(4===b.length-c){var l=b[c+1],m=b[c+2];b=b[c+3];for(k=0;k<h;++k)ea(a[k],l,m,b,d,f),f+=e}else for(k=0;k<h;++k)O(a[k],b,c+1,d,f),f+=e}function fa(a){return Oa[Object.prototype.toString.call(a)]|
0}function ja(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function na(a,b,c,d,f,e,k){for(var h=0,l=0;l<c;++l)for(var m=0;m<d;++m)a[h++]=b[f*l+e*m+k]}function qa(a,b,c,d){function f(b){this.id=l++;this.buffer=a.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;c.profile&&(this.stats={size:0})}function e(b,c,d){b.byteLength=c.byteLength;a.bufferData(b.type,c,d)}function k(a,b,c,d,f,k){a.usage=c;if(Array.isArray(b)){if(a.dtype=d||5126,
0<b.length)if(Array.isArray(b[0])){f=ob(b);for(var h=d=1;h<f.length;++h)d*=f[h];a.dimension=d;b=Ya(b,f,a.dtype);e(a,b,c);k?a.persistentData=b:L.freeType(b)}else"number"===typeof b[0]?(a.dimension=f,f=L.allocType(a.dtype,b.length),ja(f,b),e(a,f,c),k?a.persistentData=f:L.freeType(f)):ka(b[0])?(a.dimension=b[0].length,a.dtype=d||fa(b[0])||5126,b=Ya(b,[b.length,b[0].length],a.dtype),e(a,b,c),k?a.persistentData=b:L.freeType(b)):u.raise("invalid buffer data")}else if(ka(b))a.dtype=d||fa(b),a.dimension=
f,e(a,b,c),k&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(U(b)){f=b.shape;var l=b.stride;h=b.offset;var m=0,n=0,z=0,p=0;1===f.length?(m=f[0],n=1,z=l[0],p=0):2===f.length?(m=f[0],n=f[1],z=l[0],p=l[1]):u.raise("invalid shape");a.dtype=d||fa(b.data)||5126;a.dimension=n;f=L.allocType(a.dtype,m*n);na(f,b.data,m,n,z,p,h);e(a,f,c);k?a.persistentData=f:L.freeType(f)}else u.raise("invalid buffer data")}function h(c){b.bufferCount--;for(var f=0;f<d.state.length;++f){var e=d.state[f];
e.buffer===c&&(a.disableVertexAttribArray(f),e.buffer=null)}f=c.buffer;u(f,"buffer must not be deleted already");a.deleteBuffer(f);c.buffer=null;delete m[c.id]}var l=0,m={};f.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)};f.prototype.destroy=function(){h(this)};var n=[];c.profile&&(b.getTotalBufferSize=function(){var a=0;Object.keys(m).forEach(function(b){a+=m[b].stats.size});return a});return{create:function(d,e,l,n){function z(b){var d=35044,f=null,e=0,h=0,l=1;Array.isArray(b)||
ka(b)||U(b)?f=b:"number"===typeof b?e=b|0:b&&(u.type(b,"object","buffer arguments must be an object, a number or an array"),"data"in b&&(u(null===f||Array.isArray(f)||ka(f)||U(f),"invalid data for buffer"),f=b.data),"usage"in b&&(u.parameter(b.usage,Pa,"invalid buffer usage"),d=Pa[b.usage]),"type"in b&&(u.parameter(b.type,Rb,"invalid buffer type"),h=Rb[b.type]),"dimension"in b&&(u.type(b.dimension,"number","invalid dimension"),l=b.dimension|0),"length"in b&&(u.nni(e,"buffer length must be a nonnegative integer"),
e=b.length|0));q.bind();f?k(q,f,d,h,l,n):(e&&a.bufferData(q.type,e,d),q.dtype=h||5121,q.usage=d,q.dimension=l,q.byteLength=e);c.profile&&(q.stats.size=q.byteLength*bb[q.dtype]);return z}function p(b,c){u(c+b.byteLength<=q.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+b.byteLength+" starting from offset "+c+" to a buffer of size "+q.byteLength);a.bufferSubData(q.type,c,b)}b.bufferCount++;var q=new f(e);m[q.id]=q;l||z(d);z._reglType="buffer";z._buffer=q;z.subdata=
function(a,b){b=(b||0)|0;q.bind();if(ka(a))p(a,b);else if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var c=L.allocType(q.dtype,a.length);ja(c,a);p(c,b);L.freeType(c)}else if(Array.isArray(a[0])||ka(a[0])){var d=ob(a);a=Ya(a,d,q.dtype);p(a,b);L.freeType(a)}else u.raise("invalid buffer data")}else if(U(a)){d=a.shape;var f=a.stride,e=c=0,k=0,h=0;1===d.length?(c=d[0],e=1,k=f[0],h=0):2===d.length?(c=d[0],e=d[1],k=f[0],h=f[1]):u.raise("invalid shape");d=Array.isArray(a.data)?q.dtype:fa(a.data);
d=L.allocType(d,c*e);na(d,a.data,c,e,k,h,a.offset);p(d,b);L.freeType(d)}else u.raise("invalid data for buffer subdata");return z};c.profile&&(z.stats=q.stats);z.destroy=function(){h(q)};return z},createStream:function(a,b){var c=n.pop();c||(c=new f(a));c.bind();k(c,b,35040,0,1,!1);return c},destroyStream:function(a){n.push(a)},clear:function(){Da(m).forEach(h);n.forEach(h)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null},restore:function(){Da(m).forEach(function(b){b.buffer=
a.createBuffer();a.bindBuffer(b.type,b.buffer);a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:k}}function ra(a,b,c,d){function f(a){this.id=l++;h[this.id]=this;this.buffer=a;this.primType=4;this.type=this.vertCount=0}function e(d,f,e,k,h,l,m){d.buffer.bind();if(f){var n=m;m||ka(f)&&(!U(f)||ka(f.data))||(n=b.oes_element_index_uint?5125:5123);c._initBuffer(d.buffer,f,e,n,3)}else a.bufferData(34963,l,e),d.buffer.dtype=n||5121,d.buffer.usage=e,d.buffer.dimension=3,d.buffer.byteLength=
l;n=m;if(!m){switch(d.buffer.dtype){case 5121:case 5120:n=5121;break;case 5123:case 5122:n=5123;break;case 5125:case 5124:n=5125;break;default:u.raise("unsupported type for element array")}d.buffer.dtype=n}d.type=n;u(5125!==n||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");f=h;0>f&&(f=d.buffer.byteLength,5123===n?f>>=1:5125===n&&(f>>=2));d.vertCount=f;f=k;0>k&&(f=4,k=d.buffer.dimension,1===k&&(f=0),2===k&&(f=1),3===k&&(f=4));d.primType=f}function k(a){d.elementsCount--;
u(null!==a.buffer,"must not double destroy elements");delete h[a.id];a.buffer.destroy();a.buffer=null}var h={},l=0,m={uint8:5121,uint16:5123};b.oes_element_index_uint&&(m.uint32=5125);f.prototype.bind=function(){this.buffer.bind()};var n=[];return{create:function(a,b){function h(a){if(a)if("number"===typeof a)l(a),n.primType=4,n.vertCount=a|0,n.type=5121;else{var b=null,c=35044,d=-1,f=-1,k=0,z=0;if(Array.isArray(a)||ka(a)||U(a))b=a;else if(u.type(a,"object","invalid arguments for elements"),"data"in
a&&(b=a.data,u(Array.isArray(b)||ka(b)||U(b),"invalid data for element buffer")),"usage"in a&&(u.parameter(a.usage,Pa,"invalid element buffer usage"),c=Pa[a.usage]),"primitive"in a&&(u.parameter(a.primitive,Bb,"invalid element buffer primitive"),d=Bb[a.primitive]),"count"in a&&(u("number"===typeof a.count&&0<=a.count,"invalid vertex count for elements"),f=a.count|0),"type"in a&&(u.parameter(a.type,m,"invalid buffer type"),z=m[a.type]),"length"in a)k=a.length|0;else if(k=f,5123===z||5122===z)k*=2;
else if(5125===z||5124===z)k*=4;e(n,b,c,d,f,k,z)}else l(),n.primType=4,n.vertCount=0,n.type=5121;return h}var l=c.create(null,34963,!0),n=new f(l._buffer);d.elementsCount++;h(a);h._reglType="elements";h._elements=n;h.subdata=function(a,b){l.subdata(a,b);return h};h.destroy=function(){k(n)};return h},createStream:function(a){var b=n.pop();b||(b=new f(c.create(null,34963,!0,!1)._buffer));e(b,a,35040,-1,-1,0,0);return b},destroyStream:function(a){n.push(a)},getElements:function(a){return"function"===
typeof a&&a._elements instanceof f?a._elements:null},clear:function(){Da(h).forEach(k)}}}function pa(a){for(var b=L.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(Infinity===a[c])b[c]=31744;else if(-Infinity===a[c])b[c]=64512;else{pb[0]=a[c];var d=Hb[0],f=d>>>31<<15,e=(d<<1>>>24)-127;d=d>>13&1023;b[c]=-24>e?f:-14>e?f+(d+1024>>-14-e):15<e?f+31744:f+(e+15<<10)+d}return b}function Y(a){return Array.isArray(a)||ka(a)}function la(a){return"[object "+a+"]"}function va(a){return Array.isArray(a)&&
(0===a.length||"number"===typeof a[0])}function Ga(a){return Array.isArray(a)&&0!==a.length&&Y(a[0])?!0:!1}function ma(a){return Object.prototype.toString.call(a)}function Ca(a){if(!a)return!1;var b=ma(a);return 0<=Jb.indexOf(b)?!0:va(a)||Ga(a)||U(a)}function Ha(a,b){36193===a.type?(a.data=pa(b),L.freeType(b)):a.data=b}function Ba(a,b,c,d,f,e){a="undefined"!==typeof ha[a]?ha[a]:xa[a]*Cb[b];e&&(a*=6);if(f){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}function Ta(a,b,c,d,f,e,k){function h(){this.format=
this.internalformat=6408;this.type=5121;this.flipY=this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.colorSpace=37444;this.channels=this.height=this.width=0}function l(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function m(a,d){if("object"===("undefined"===
typeof d?"undefined":V(d))&&d){"premultiplyAlpha"in d&&(u.type(d.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),a.premultiplyAlpha=d.premultiplyAlpha);"flipY"in d&&(u.type(d.flipY,"boolean","invalid texture flip"),a.flipY=d.flipY);"alignment"in d&&(u.oneOf(d.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=d.alignment);"colorSpace"in d&&(u.parameter(d.colorSpace,C,"invalid colorSpace"),a.colorSpace=C[d.colorSpace]);if("type"in d){var f=d.type;u(b.oes_texture_float||
!("float"===f||"float32"===f),"you must enable the OES_texture_float extension in order to use floating point textures.");u(b.oes_texture_half_float||!("half float"===f||"float16"===f),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");u(b.webgl_depth_texture||!("uint16"===f||"uint32"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");u.parameter(f,F,"invalid texture type");a.type=
F[f]}var e=a.width,k=a.height,h=a.channels;f=!1;"shape"in d?(u(Array.isArray(d.shape)&&2<=d.shape.length,"shape must be an array"),e=d.shape[0],k=d.shape[1],3===d.shape.length&&(h=d.shape[2],u(0<h&&4>=h,"invalid number of channels"),f=!0),u(0<=e&&e<=c.maxTextureSize,"invalid width"),u(0<=k&&k<=c.maxTextureSize,"invalid height")):("radius"in d&&(e=k=d.radius,u(0<=e&&e<=c.maxTextureSize,"invalid radius")),"width"in d&&(e=d.width,u(0<=e&&e<=c.maxTextureSize,"invalid width")),"height"in d&&(k=d.height,
u(0<=k&&k<=c.maxTextureSize,"invalid height")),"channels"in d&&(h=d.channels,u(0<h&&4>=h,"invalid number of channels"),f=!0));a.width=e|0;a.height=k|0;a.channels=h|0;e=!1;"format"in d&&(e=d.format,u(b.webgl_depth_texture||!("depth"===e||"depth stencil"===e),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),u.parameter(e,La,"invalid texture format"),k=a.internalformat=La[e],a.format=R[k],e in F&&!("type"in d)&&(a.type=F[e]),e in H&&(a.compressed=!0),e=!0);
!f&&e?a.channels=xa[a.format]:f&&!e?a.channels!==Xb[a.format]&&(a.format=a.internalformat=Xb[a.channels]):e&&f&&u(a.channels===xa[a.format],"number of channels inconsistent with specified format")}}function n(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function p(){h.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function z(a,b){var d=null;
Ca(b)?d=b:b&&(u.type(b,"object","invalid pixel data type"),m(a,b),"x"in b&&(a.xOffset=b.x|0),"y"in b&&(a.yOffset=b.y|0),Ca(b.data)&&(d=b.data));u(!a.compressed||d instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(b.copy)u(!d,"can not specify copy and data field for the same texture"),b=f.viewportWidth,d=f.viewportHeight,a.width=a.width||b-a.xOffset,a.height=a.height||d-a.yOffset,a.needsCopy=!0,u(0<=a.xOffset&&a.xOffset<b&&0<=a.yOffset&&a.yOffset<d&&0<a.width&&a.width<=
b&&0<a.height&&a.height<=d,"copy texture read out of bounds");else if(!d)a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4;else if(ka(d))a.channels=a.channels||4,a.data=d,"type"in b||5121!==a.type||(a.type=Oa[Object.prototype.toString.call(d)]|0);else if(va(d)){a.channels=a.channels||4;b=d;d=b.length;switch(a.type){case 5121:case 5123:case 5125:case 5126:d=L.allocType(a.type,d);d.set(b);a.data=d;break;case 36193:a.data=pa(b);break;default:u.raise("unsupported texture type, must specify a typed array")}a.alignment=
1;a.needsFree=!0}else if(U(d)){b=d.data;Array.isArray(b)||5121!==a.type||(a.type=Oa[Object.prototype.toString.call(b)]|0);var e=d.shape,k=d.stride;if(3===e.length){var h=e[2];var l=k[2]}else u(2===e.length,"invalid ndarray pixel data, must be 2 or 3D"),l=h=1;var n=e[0];var p=e[1];e=k[0];k=k[1];a.alignment=1;a.width=n;a.height=p;a.channels=h;a.format=a.internalformat=Xb[h];a.needsFree=!0;n=l;d=d.offset;h=a.width;l=a.height;p=a.channels;for(var z=L.allocType(36193===a.type?5126:a.type,h*l*p),q=0,t=
0;t<l;++t)for(var cc=0;cc<h;++cc)for(var Tb=0;Tb<p;++Tb)z[q++]=b[e*cc+k*t+n*Tb+d];Ha(a,z)}else if(ma(d)===hb||ma(d)===ub)ma(d)===hb?a.element=d:a.element=d.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(ma(d)===vb)a.element=d,a.width=d.width,a.height=d.height,a.channels=4;else if(ma(d)===wb)a.element=d,a.width=d.naturalWidth,a.height=d.naturalHeight,a.channels=4;else if(ma(d)===xb)a.element=d,a.width=d.videoWidth,a.height=d.videoHeight,a.channels=4;else if(Ga(d)){b=
a.width||d[0].length;e=a.height||d.length;k=a.channels;k=Y(d[0][0])?k||d[0][0].length:k||1;n=Na.shape(d);h=1;for(l=0;l<n.length;++l)h*=n[l];h=L.allocType(36193===a.type?5126:a.type,h);Na.flatten(d,n,"",h);Ha(a,h);a.alignment=1;a.width=b;a.height=e;a.channels=k;a.format=a.internalformat=Xb[k];a.needsFree=!0}5126===a.type?u(0<=c.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&u(0<=c.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
function q(b,c,f,e,k){var h=b.element,l=b.data,m=b.internalformat,p=b.format,z=b.type,q=b.width,u=b.height;n(b);h?a.texSubImage2D(c,k,f,e,p,z,h):b.compressed?a.compressedTexSubImage2D(c,k,f,e,m,q,u,l):b.needsCopy?(d(),a.copyTexSubImage2D(c,k,f,e,b.xOffset,b.yOffset,q,u)):a.texSubImage2D(c,k,f,e,q,u,p,z,l)}function t(){return W.pop()||new p}function v(a){a.needsFree&&L.freeType(a.data);p.call(a);W.push(a)}function Q(){h.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function x(a,b,c){var d=a.images[0]=t();a.mipmask=1;d.width=a.width=b;d.height=a.height=c;d.channels=a.channels=4}function w(a,b){if(Ca(b)){var c=a.images[0]=t();l(c,a);z(c,b);a.mipmask=1}else if(m(a,b),Array.isArray(b.mipmap)){b=b.mipmap;for(var d=0;d<b.length;++d)c=a.images[d]=t(),l(c,a),c.width>>=d,c.height>>=d,z(c,b[d]),a.mipmask|=1<<d}else c=a.images[0]=t(),l(c,a),z(c,b),a.mipmask=1;l(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||
33779===a.internalformat)&&u(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function y(b,c){b=b.images;for(var f=0;f<b.length&&b[f];++f){var e=b[f],k=c,h=f,l=e.element,m=e.data,p=e.internalformat,z=e.format,q=e.type,u=e.width,t=e.height,Tb=e.channels;n(e);l?a.texImage2D(k,h,z,z,q,l):e.compressed?a.compressedTexImage2D(k,h,p,u,t,0,m):e.needsCopy?(d(),a.copyTexImage2D(k,h,z,e.xOffset,e.yOffset,u,t,0)):((e=!m)&&(m=L.zero.allocType(q,
u*t*Tb)),a.texImage2D(k,h,z,u,t,0,z,q,m),e&&m&&L.zero.freeType(m))}}function Ia(){var a=S.pop()||new Q;h.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function D(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&v(b[c]),b[c]=null;S.push(a)}function A(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function oa(a,b){if("min"in b){var d=b.min;u.parameter(d,Yb);a.minFilter=Yb[d];0<=Ib.indexOf(a.minFilter)&&!("faces"in
b)&&(a.genMipmaps=!0)}"mag"in b&&(d=b.mag,u.parameter(d,E),a.magFilter=E[d]);d=a.wrapS;var f=a.wrapT;if("wrap"in b){var e=b.wrap;"string"===typeof e?(u.parameter(e,ya),d=f=ya[e]):Array.isArray(e)&&(u.parameter(e[0],ya),u.parameter(e[1],ya),d=ya[e[0]],f=ya[e[1]])}else"wrapS"in b&&(d=b.wrapS,u.parameter(d,ya),d=ya[d]),"wrapT"in b&&(f=b.wrapT,u.parameter(f,ya),f=ya[f]);a.wrapS=d;a.wrapT=f;"anisotropic"in b&&(d=b.anisotropic,u("number"===typeof d&&1<=d&&d<=c.maxAnisotropic,"aniso samples must be between 1 and "),
a.anisotropic=b.anisotropic);if("mipmap"in b){d=!1;switch(V(b.mipmap)){case "string":u.parameter(b.mipmap,I,"invalid mipmap hint");a.mipmapHint=I[b.mipmap];d=a.genMipmaps=!0;break;case "boolean":d=a.genMipmaps=b.mipmap;break;case "object":u(Array.isArray(b.mipmap),"invalid mipmap type");a.genMipmaps=!1;d=!0;break;default:u.raise("invalid mipmap type")}!d||"min"in b||(a.minFilter=9984)}}function B(c,d){a.texParameteri(d,10241,c.minFilter);a.texParameteri(d,10240,c.magFilter);a.texParameteri(d,10242,
c.wrapS);a.texParameteri(d,10243,c.wrapT);b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic);c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function bc(b){h.call(this);this.mipmask=0;this.internalformat=6408;this.id=T++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new A;k.profile&&(this.stats={size:0})}function Ja(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function sa(){var b=P[0];b?a.bindTexture(b.target,
b.texture):a.bindTexture(3553,null)}function Bc(b){var c=b.texture;u(c,"must not double destroy texture");var d=b.unit,f=b.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(f,null),P[d]=null);a.deleteTexture(c);b.texture=null;b.params=null;b.pixels=null;b.refCount=0;delete N[b.id];e.textureCount--}var I={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ya={repeat:10497,clamp:33071,mirror:33648},E={nearest:9728,linear:9729},Yb=Z({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,
"nearest mipmap linear":9986,"linear mipmap linear":9987},E),C={none:0,browser:37444},F={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},La={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},H={};b.ext_srgb&&(La.srgb=35904,La.srgba=35906);b.oes_texture_float&&(F.float32=F.float=5126);b.oes_texture_half_float&&(F.float16=F["half float"]=36193);b.webgl_depth_texture&&(Z(La,{depth:6402,"depth stencil":34041}),Z(F,{uint16:5123,uint32:5125,
"depth stencil":34042}));b.webgl_compressed_texture_s3tc&&Z(H,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});b.webgl_compressed_texture_atc&&Z(H,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});b.webgl_compressed_texture_pvrtc&&Z(H,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});b.webgl_compressed_texture_etc1&&(H["rgb etc1"]=36196);var G=Array.prototype.slice.call(a.getParameter(34467));
Object.keys(H).forEach(function(a){var b=H[a];0<=G.indexOf(b)&&(La[a]=b)});var qb=Object.keys(La);c.textureFormats=qb;var K=[];Object.keys(La).forEach(function(a){K[La[a]]=a});var M=[];Object.keys(F).forEach(function(a){M[F[a]]=a});var Ub=[];Object.keys(E).forEach(function(a){Ub[E[a]]=a});var rb=[];Object.keys(Yb).forEach(function(a){rb[Yb[a]]=a});var J=[];Object.keys(ya).forEach(function(a){J[ya[a]]=a});var R=qb.reduce(function(a,b){var c=La[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===
c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),W=[],S=[],T=0,N={},O=c.maxTextureUnits,P=Array(O).map(function(){return null});Z(bc.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<O;++c){var d=P[c];if(d){if(0<d.bindCount)continue;d.unit=-1}P[c]=this;b=c;break}b>=O&&u.raise("insufficient number of texture units");k.profile&&e.maxTextureUnits<b+1&&(e.maxTextureUnits=b+1);this.unit=b;a.activeTexture(33984+b);a.bindTexture(this.target,this.texture)}return b},
unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&Bc(this)}});k.profile&&(e.getTotalTextureSize=function(){var a=0;Object.keys(N).forEach(function(b){a+=N[b].stats.size});return a});return{create2D:function(b,d){function f(a,b){var d=h.texInfo;A.call(d);var e=Ia();"number"===typeof a?"number"===typeof b?x(e,a|0,b|0):x(e,a|0,a|0):a?(u.type(a,"object","invalid arguments to regl.texture"),oa(d,a),w(e,a)):x(e,1,1);d.genMipmaps&&(e.mipmask=(e.width<<1)-1);h.mipmask=e.mipmask;l(h,
e);u.texture2D(d,e,c);h.internalformat=e.internalformat;f.width=e.width;f.height=e.height;Ja(h);y(e,3553);B(d,3553);sa();D(e);k.profile&&(h.stats.size=Ba(h.internalformat,h.type,e.width,e.height,d.genMipmaps,!1));f.format=K[h.internalformat];f.type=M[h.type];f.mag=Ub[d.magFilter];f.min=rb[d.minFilter];f.wrapS=J[d.wrapS];f.wrapT=J[d.wrapT];return f}var h=new bc(3553);N[h.id]=h;e.textureCount++;f(b,d);f.subimage=function(a,b,c,d){u(!!a,"must specify image data");b|=0;c|=0;d|=0;var e=t();l(e,h);e.width=
0;e.height=0;z(e,a);e.width=e.width||(h.width>>d)-b;e.height=e.height||(h.height>>d)-c;u(h.type===e.type&&h.format===e.format&&h.internalformat===e.internalformat,"incompatible format for texture.subimage");u(0<=b&&0<=c&&b+e.width<=h.width&&c+e.height<=h.height,"texture.subimage write out of bounds");u(h.mipmask&1<<d,"missing mipmap data");u(e.data||e.element||e.needsCopy,"missing image data");Ja(h);q(e,3553,b,c,d);sa();v(e);return f};f.resize=function(b,c){b|=0;c=c|0||b;if(b===h.width&&c===h.height)return f;
f.width=h.width=b;f.height=h.height=c;Ja(h);for(var d,e=h.channels,l=h.type,m=0;h.mipmask>>m;++m){var n=b>>m,p=c>>m;if(!n||!p)break;d=L.zero.allocType(l,n*p*e);a.texImage2D(3553,m,h.format,n,p,0,h.format,h.type,d);d&&L.zero.freeType(d)}sa();k.profile&&(h.stats.size=Ba(h.internalformat,h.type,b,c,!1,!1));return f};f._reglType="texture2d";f._texture=h;k.profile&&(f.stats=h.stats);f.destroy=function(){h.decRef()};return f},createCube:function(b,d,f,h,n,p){function Q(a,b,d,f,e,h){var n,p=I.texInfo;A.call(p);
for(n=0;6>n;++n)ca[n]=Ia();if("number"!==typeof a&&a)if("object"===("undefined"===typeof a?"undefined":V(a)))if(b)w(ca[0],a),w(ca[1],b),w(ca[2],d),w(ca[3],f),w(ca[4],e),w(ca[5],h);else if(oa(p,a),m(I,a),"faces"in a)for(a=a.faces,u(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),n=0;6>n;++n)u("object"===V(a[n])&&!!a[n],"invalid input for cube map face"),l(ca[n],I),w(ca[n],a[n]);else for(n=0;6>n;++n)w(ca[n],a);else u.raise("invalid arguments to cube map");else for(a=a|0||1,n=0;6>
n;++n)x(ca[n],a,a);l(I,ca[0]);c.npotTextureCube||u(tb(I.width)&&tb(I.height),"your browser does not support non power or two texture dimensions");I.mipmask=p.genMipmaps?(ca[0].width<<1)-1:ca[0].mipmask;u.textureCube(I,p,ca,c);I.internalformat=ca[0].internalformat;Q.width=ca[0].width;Q.height=ca[0].height;Ja(I);for(n=0;6>n;++n)y(ca[n],34069+n);B(p,34067);sa();k.profile&&(I.stats.size=Ba(I.internalformat,I.type,Q.width,Q.height,p.genMipmaps,!0));Q.format=K[I.internalformat];Q.type=M[I.type];Q.mag=Ub[p.magFilter];
Q.min=rb[p.minFilter];Q.wrapS=J[p.wrapS];Q.wrapT=J[p.wrapT];for(n=0;6>n;++n)D(ca[n]);return Q}var I=new bc(34067);N[I.id]=I;e.cubeCount++;var ca=Array(6);Q(b,d,f,h,n,p);Q.subimage=function(a,b,c,d,f){u(!!b,"must specify image data");u("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");c|=0;d|=0;f|=0;var e=t();l(e,I);e.width=0;e.height=0;z(e,b);e.width=e.width||(I.width>>f)-c;e.height=e.height||(I.height>>f)-d;u(I.type===e.type&&I.format===e.format&&I.internalformat===e.internalformat,"incompatible format for texture.subimage");
u(0<=c&&0<=d&&c+e.width<=I.width&&d+e.height<=I.height,"texture.subimage write out of bounds");u(I.mipmask&1<<f,"missing mipmap data");u(e.data||e.element||e.needsCopy,"missing image data");Ja(I);q(e,34069+a,c,d,f);sa();v(e);return Q};Q.resize=function(b){b|=0;if(b!==I.width){Q.width=I.width=b;Q.height=I.height=b;Ja(I);for(var c=0;6>c;++c)for(var d=0;I.mipmask>>d;++d)a.texImage2D(34069+c,d,I.format,b>>d,b>>d,0,I.format,I.type,null);sa();k.profile&&(I.stats.size=Ba(I.internalformat,I.type,Q.width,
Q.height,!1,!0));return Q}};Q._reglType="textureCube";Q._texture=I;k.profile&&(Q.stats=I.stats);Q.destroy=function(){I.decRef()};return Q},clear:function(){for(var b=0;b<O;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),P[b]=null;Da(N).forEach(Bc);e.cubeCount=0;e.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<O;++b){var c=P[b];c&&(c.bindCount=0,c.unit=-1,P[b]=null)}Da(N).forEach(function(b){b.texture=a.createTexture();a.bindTexture(b.target,b.texture);for(var c=
0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);B(b.texInfo,b.target)})}}}function Va(a,b,c,d,f,e){function k(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height);this.width=a;this.height=d}function h(a){a&&(a.texture&&
a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function l(a,b,c){if(a)if(a.texture){a=a.texture._texture;var d=Math.max(1,a.height);u(Math.max(1,a.width)===b&&d===c,"inconsistent width/height for supplied texture");a.refCount+=1}else a=a.renderbuffer._renderbuffer,u(a.width===b&&a.height===c,"inconsistent width/height for renderbuffer"),a.refCount+=1}function m(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,
b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function n(a){var b=3553,c=null,d=null,f=a;"object"===("undefined"===typeof a?"undefined":V(a))&&(f=a.data,"target"in a&&(b=a.target|0));u.type(f,"function","invalid attachment data");a=f._reglType;"texture2d"===a?(c=f,u(3553===b)):"textureCube"===a?(c=f,u(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(d=f,b=36161):u.raise("invalid regl object for attachment");return new k(b,c,d)}function p(a,b,c,e,h){if(c)return a=d.create2D({width:a,
height:b,format:e,type:h}),a._texture.refCount=0,new k(3553,a,null);a=f.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new k(36161,null,a)}function q(a){return a&&(a.texture||a.renderbuffer)}function z(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c),a.width=b,a.height=c)}function t(){this.id=B++;oa[this.id]=this;this.framebuffer=a.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=
this.depthAttachment=null}function v(a){a.colorAttachments.forEach(h);h(a.depthAttachment);h(a.stencilAttachment);h(a.depthStencilAttachment)}function Q(b){var c=b.framebuffer;u(c,"must not double destroy framebuffer");a.deleteFramebuffer(c);b.framebuffer=null;e.framebufferCount--;delete oa[b.id]}function w(b){var d;a.bindFramebuffer(36160,b.framebuffer);var f=b.colorAttachments;for(d=0;d<f.length;++d)m(36064+d,f[d]);for(d=f.length;d<c.maxColorAttachments;++d)a.framebufferTexture2D(36160,36064+d,
3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0);a.framebufferTexture2D(36160,36096,3553,null,0);a.framebufferTexture2D(36160,36128,3553,null,0);m(36096,b.depthAttachment);m(36128,b.stencilAttachment);m(33306,b.depthStencilAttachment);b=a.checkFramebufferStatus(36160);a.isContextLost()||36053===b||u.raise("framebuffer configuration not supported, status = "+Nb[b]);a.bindFramebuffer(36160,y.next?y.next.framebuffer:null);y.cur=y.next;a.getError()}function x(a,d){function f(a,d){u(y.next!==
k,"can not update framebuffer which is currently in use");var e=0,h=0,m=!0,z=!0;var t=null;var Q=!0,x="rgba",ia="uint8",B=1,oa=null,Ka=null,Wb=null,I=!1;if("number"===typeof a)e=a|0,h=d|0||e;else if(a){u.type(a,"object","invalid arguments for framebuffer");"shape"in a?(h=a.shape,u(Array.isArray(h)&&2<=h.length,"invalid shape for framebuffer"),e=h[0],h=h[1]):("radius"in a&&(e=h=a.radius),"width"in a&&(e=a.width),"height"in a&&(h=a.height));if("color"in a||"colors"in a)t=a.color||a.colors,Array.isArray(t)&&
u(1===t.length||b.webgl_draw_buffers,"multiple render targets not supported");if(!t){"colorCount"in a&&(B=a.colorCount|0,u(0<B,"invalid color buffer count"));"colorTexture"in a&&(Q=!!a.colorTexture,x="rgba4");if("colorType"in a){ia=a.colorType;if(Q)u(b.oes_texture_float||!("float"===ia||"float32"===ia),"you must enable OES_texture_float in order to use floating point framebuffer objects"),u(b.oes_texture_half_float||!("half float"===ia||"float16"===ia),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");
else if("half float"===ia||"float16"===ia)u(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f";else if("float"===ia||"float32"===ia)u(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f";u.oneOf(ia,A,"invalid color type")}if("colorFormat"in a)if(x=a.colorFormat,0<=D.indexOf(x))Q=!0;else if(0<=Ia.indexOf(x))Q=!1;else if(Q)u.oneOf(a.colorFormat,D,"invalid color format for texture");
else u.oneOf(a.colorFormat,Ia,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)I=!(!a.depthTexture&&!a.depthStencilTexture),u(!I||b.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?m=a.depth:(oa=a.depth,z=!1));"stencil"in a&&("boolean"===typeof a.stencil?z=a.stencil:(Ka=a.stencil,m=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?m=z=a.depthStencil:(Wb=a.depthStencil,z=m=!1))}else e=h=1;
var wa=d=a=null;if(Array.isArray(t))var aa=t.map(n);else if(t)aa=[n(t)];else for(aa=Array(B),t=0;t<B;++t)aa[t]=p(e,h,Q,x,ia);u(b.webgl_draw_buffers||1>=aa.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");u(aa.length<=c.maxColorAttachments,"too many color attachments, not supported");e=e||aa[0].width;h=h||aa[0].height;oa?a=n(oa):m&&!z&&(a=p(e,h,I,"depth","uint32"));Ka?d=n(Ka):z&&!m&&(d=p(e,h,!1,"stencil","uint8"));Wb?wa=n(Wb):!oa&&!Ka&&z&&m&&(wa=p(e,
h,I,"depth stencil","depth stencil"));u(1>=!!oa+!!Ka+!!Wb,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");m=null;for(t=0;t<aa.length;++t)l(aa[t],e,h),u(!aa[t]||aa[t].texture&&0<=Lb.indexOf(aa[t].texture._texture.format)||aa[t].renderbuffer&&0<=Mb.indexOf(aa[t].renderbuffer._renderbuffer.format),"framebuffer color attachment "+t+" is invalid"),aa[t]&&aa[t].texture&&(z=kb[aa[t].texture._texture.format]*Zb[aa[t].texture._texture.type],null===m?m=z:u(m===z,"all color attachments much have the same number of bits per pixel."));
l(a,e,h);u(!a||a.texture&&6402===a.texture._texture.format||a.renderbuffer&&33189===a.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");l(d,e,h);u(!d||d.renderbuffer&&36168===d.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");l(wa,e,h);u(!wa||wa.texture&&34041===wa.texture._texture.format||wa.renderbuffer&&34041===wa.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");v(k);k.width=e;k.height=
h;k.colorAttachments=aa;k.depthAttachment=a;k.stencilAttachment=d;k.depthStencilAttachment=wa;f.color=aa.map(q);f.depth=q(a);f.stencil=q(d);f.depthStencil=q(wa);f.width=k.width;f.height=k.height;w(k);return f}var k=new t;e.framebufferCount++;f(a,d);return Z(f,{resize:function(a,b){u(y.next!==k,"can not resize a framebuffer which is currently in use");a=Math.max(a|0,1);b=Math.max(b|0||a,1);if(a===k.width&&b===k.height)return f;for(var c=k.colorAttachments,d=0;d<c.length;++d)z(c[d],a,b);z(k.depthAttachment,
a,b);z(k.stencilAttachment,a,b);z(k.depthStencilAttachment,a,b);k.width=f.width=a;k.height=f.height=b;w(k);return f},_reglType:"framebuffer",_framebuffer:k,destroy:function(){Q(k);v(k)},use:function(a){y.setFBO({framebuffer:f},a)}})}var y={cur:null,next:null,dirty:!1,setFBO:null},D=["rgba"],Ia=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&Ia.push("srgba");b.ext_color_buffer_half_float&&Ia.push("rgba16f","rgb16f");b.webgl_color_buffer_float&&Ia.push("rgba32f");var A=["uint8"];b.oes_texture_half_float&&
A.push("half float","float16");b.oes_texture_float&&A.push("float","float32");var B=0,oa={};return Z(y,{getFramebuffer:function(a){return"function"===typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof t)?a:null},create:x,createCube:function(a){function f(a){u(0>e.indexOf(y.next),"can not update framebuffer which is currently in use");var c={color:null},k=0,h=null;var l="rgba";var m="uint8",n=1;if("number"===typeof a)k=a|0;else if(a){u.type(a,"object","invalid arguments for framebuffer");
"shape"in a?(k=a.shape,u(Array.isArray(k)&&2<=k.length,"invalid shape for framebuffer"),u(k[0]===k[1],"cube framebuffer must be square"),k=k[0]):("radius"in a&&(k=a.radius|0),"width"in a?(k=a.width|0,"height"in a&&u(a.height===k,"must be square")):"height"in a&&(k=a.height|0));if("color"in a||"colors"in a)h=a.color||a.colors,Array.isArray(h)&&u(1===h.length||b.webgl_draw_buffers,"multiple render targets not supported");h||("colorCount"in a&&(n=a.colorCount|0,u(0<n,"invalid color buffer count")),"colorType"in
a&&(u.oneOf(a.colorType,A,"invalid color type"),m=a.colorType),"colorFormat"in a&&(l=a.colorFormat,u.oneOf(a.colorFormat,D,"invalid color format for texture")));"depth"in a&&(c.depth=a.depth);"stencil"in a&&(c.stencil=a.stencil);"depthStencil"in a&&(c.depthStencil=a.depthStencil)}else k=1;if(h)if(Array.isArray(h))for(a=[],l=0;l<h.length;++l)a[l]=h[l];else a=[h];else for(a=Array(n),h={radius:k,format:l,type:m},l=0;l<n;++l)a[l]=d.createCube(h);c.color=Array(a.length);for(l=0;l<a.length;++l)n=a[l],u("function"===
typeof n&&"textureCube"===n._reglType,"invalid cube map"),k=k||n.width,u(n.width===k&&n.height===k,"invalid cube map shape"),c.color[l]={target:34069,data:a[l]};for(l=0;6>l;++l){for(n=0;n<a.length;++n)c.color[n].target=34069+l;0<l&&(c.depth=e[0].depth,c.stencil=e[0].stencil,c.depthStencil=e[0].depthStencil);if(e[l])e[l](c);else e[l]=x(c)}return Z(f,{width:k,height:k,color:a})}var e=Array(6);f(a);return Z(f,{faces:e,resize:function(a){var b=a|0;u(0<b&&b<=c.maxCubeMapSize,"invalid radius for cube fbo");
if(b===f.width)return f;var d=f.color;for(a=0;a<d.length;++a)d[a].resize(b);for(a=0;6>a;++a)e[a].resize(b);f.width=f.height=b;return f},_reglType:"framebufferCube",destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){Da(oa).forEach(Q)},restore:function(){y.cur=null;y.next=null;y.dirty=!0;Da(oa).forEach(function(b){b.framebuffer=a.createFramebuffer();w(b)})}})}function Qa(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;
this.divisor=this.stride=this.offset=0}function Za(a,b,c,d){a=c.maxAttributes;b=Array(a);for(c=0;c<a;++c)b[c]=new Qa;return{Record:Qa,scope:{},state:b}}function fb(a,b,c,d){function f(a,b,c,d){this.name=a;this.id=b;this.location=c;this.info=d}function e(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id){a[c].location=b.location;return}a.push(b)}function k(c,d,f){var e=35632===c?m:n,k=e[d];if(!k){var h=b.str(d);k=a.createShader(c);a.shaderSource(k,h);a.compileShader(k);u.shaderError(a,k,h,c,f);e[d]=
k}return k}function h(a,b){this.id=z++;this.fragId=a;this.vertId=b;this.program=null;this.uniforms=[];this.attributes=[];d.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function l(c,h){var l=k(35632,c.fragId);var m=k(35633,c.vertId),n=c.program=a.createProgram();a.attachShader(n,l);a.attachShader(n,m);a.linkProgram(n);u.linkError(a,n,b.str(c.fragId),b.str(c.vertId),h);m=a.getProgramParameter(n,35718);d.profile&&(c.stats.uniformsCount=m);var p=c.uniforms;for(h=0;h<m;++h)if(l=a.getActiveUniform(n,
h))if(1<l.size)for(var q=0;q<l.size;++q){var z=l.name.replace("[0]","["+q+"]");e(p,new f(z,b.id(z),a.getUniformLocation(n,z),l))}else e(p,new f(l.name,b.id(l.name),a.getUniformLocation(n,l.name),l));m=a.getProgramParameter(n,35721);d.profile&&(c.stats.attributesCount=m);c=c.attributes;for(h=0;h<m;++h)(l=a.getActiveAttrib(n,h))&&e(c,new f(l.name,b.id(l.name),a.getAttribLocation(n,l.name),l))}var m={},n={},p={},q=[],z=0;d.profile&&(c.getMaxUniformsCount=function(){var a=0;q.forEach(function(b){b.stats.uniformsCount>
a&&(a=b.stats.uniformsCount)});return a},c.getMaxAttributesCount=function(){var a=0;q.forEach(function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)});return a});return{clear:function(){var b=a.deleteShader.bind(a);Da(m).forEach(b);m={};Da(n).forEach(b);n={};q.forEach(function(b){a.deleteProgram(b.program)});q.length=0;p={};c.shaderCount=0},program:function(a,b,d){u.command(0<=a,"missing vertex shader",d);u.command(0<=b,"missing fragment shader",d);var f=p[b];f||(f=p[b]={});var e=f[a];
e||(e=new h(b,a),c.shaderCount++,l(e,d),f[a]=e,q.push(e));return e},restore:function(){m={};n={};for(var a=0;a<q.length;++a)l(q[a])},shader:k,frag:-1,vert:-1}}function gb(a,b,c,d,f,e,k){function h(h){if(null===b.next){u(f.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer');var l=5121}else u(null!==b.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=b.next.colorAttachments[0].texture._texture.type,
e.oes_texture_float?(u(5121===l||5126===l,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),5126===l&&u(k.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):u(5121===l,"Reading from a framebuffer is only allowed for the type 'uint8'");var m=0,n=0,p=d.framebufferWidth,q=d.framebufferHeight,z=null;ka(h)?z=h:h&&(u.type(h,"object","invalid arguments to regl.read()"),m=h.x|0,n=h.y|
0,u(0<=m&&m<d.framebufferWidth,"invalid x offset for regl.read"),u(0<=n&&n<d.framebufferHeight,"invalid y offset for regl.read"),p=(h.width||d.framebufferWidth-m)|0,q=(h.height||d.framebufferHeight-n)|0,z=h.data||null);z&&(5121===l?u(z instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===l&&u(z instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));u(0<p&&p+m<=d.framebufferWidth,"invalid width for read pixels");
u(0<q&&q+n<=d.framebufferHeight,"invalid height for read pixels");c();h=p*q*4;z||(5121===l?z=new Uint8Array(h):5126===l&&(z=z||new Float32Array(h)));u.isTypedArray(z,"data buffer for regl.read() must be a typedarray");u(z.byteLength>=h,"data buffer for regl.read() too small");a.pixelStorei(3333,4);a.readPixels(m,n,p,q,6408,l,z);return z}function l(a){var c;b.setFBO({framebuffer:a.framebuffer},function(){c=h(a)});return c}return function(a){return a&&"framebuffer"in a?l(a):h(a)}}function Db(a){return Array.prototype.slice.call(a)}
function Eb(a){return Db(a).join("")}function ib(){function a(){var a=[],b=[];return Z(function(){a.push.apply(a,Db(arguments))},{def:function(){var d="v"+c++;b.push(d);0<arguments.length&&(a.push(d,"="),a.push.apply(a,Db(arguments)),a.push(";"));return d},toString:function(){return Eb([0<b.length?"var "+b+";":"",Eb(a)])}})}function b(){function b(a,b){d(a,b,"=",c.def(a,b),";")}var c=a(),d=a(),f=c.toString,e=d.toString;return Z(function(){c.apply(c,Db(arguments))},{def:c.def,entry:c,exit:d,save:b,
set:function(a,d,f){b(a,d);c(a,d,"=",f,";")},toString:function(){return f()+e()}})}var c=0,d=[],f=[],e=a(),k={};return{global:e,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return d[b];b="g"+c++;d.push(b);f.push(a);return b},block:a,proc:function(a,c){function d(){var a="a"+f.length;f.push(a);return a}var f=[];c=c||0;for(var e=0;e<c;++e)d();c=b();var h=c.toString;return k[a]=Z(c,{arg:d,toString:function(){return Eb(["function(",f.join(),"){",h(),"}"])}})},scope:b,cond:function(){var a=
Eb(arguments),c=b(),d=b(),f=c.toString,e=d.toString;return Z(c,{then:function(){c.apply(c,Db(arguments));return this},else:function(){d.apply(d,Db(arguments));return this},toString:function(){var b=e();b&&(b="else{"+b+"}");return Eb(["if(",a,"){",f(),"}",b])}})},compile:function(){var a=['"use strict";',e,"return {"];Object.keys(k).forEach(function(b){a.push('"',b,'":',k[b].toString(),",")});a.push("}");var b=Eb(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,
d.concat(b)).apply(null,f)}}}function Fa(a){return Array.isArray(a)||ka(a)||U(a)}function Ua(a){return a.sort(function(a,b){return"viewport"===a?-1:"viewport"===b?1:a<b?-1:1})}function za(a,b,c,d){this.thisDep=a;this.contextDep=b;this.propDep=c;this.append=d}function db(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function ba(a){return new za(!1,!1,!1,a)}function ua(a,b){var c=a.type;return 0===c?(a=a.data.length,new za(!0,1<=a,2<=a,b)):4===c?(a=a.data,new za(a.thisDep,a.contextDep,a.propDep,
b)):new za(3===c,2===c,1===c,b)}function jb(a,b,c,d,f,e,k,h,l,m,n,p,q,t,v){function z(a){return a.replace(".","_")}function x(a,b,c){var d=z(a);U.push(a);Sb[d]=L[d]=!!c;cb[d]=b}function w(a,b,c){var d=z(a);U.push(a);Array.isArray(c)?(L[d]=c.slice(),Sb[d]=c.slice()):L[d]=Sb[d]=c;Sa[d]=b}function Q(){var a=ib(),c=a.link,d=a.global;a.id=mb++;a.batchId="0";var f=c(Z),e=a.shared={props:"a0"};Object.keys(Z).forEach(function(a){e[a]=d.def(f,".",a)});u.optional(function(){a.CHECK=c(u);a.commandStr=u.guessCommand();
a.command=c(a.commandStr);a.assert=function(a,b,d){a("if(!(",b,"))",this.CHECK,".commandRaise(",c(d),",",this.command,");")};X.invalidBlendCombinations=yb});var k=a.next={},h=a.current={};Object.keys(Sa).forEach(function(a){Array.isArray(L[a])&&(k[a]=d.def(e.next,".",a),h[a]=d.def(e.current,".",a))});var l=a.constants={};Object.keys(X).forEach(function(a){l[a]=d.def(JSON.stringify(X[a]))});a.invoke=function(b,d){switch(d.type){case 0:var f=["this",e.context,e.props,a.batchId];return b.def(c(d.data),
".call(",f.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(e.props,d.data);case 2:return b.def(e.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref}};a.attribCache={};var n={};a.scopeAttrib=function(a){a=b.id(a);if(a in n)return n[a];var d=m.scope[a];d||(d=m.scope[a]=new T);return n[a]=c(d)};return a}function y(a){var b=a.static;a=a.dynamic;if("profile"in b){var c=!!b.profile;var d=ba(function(a,b){return c});d.enable=c}else if("profile"in
a){var f=a.profile;d=ua(f,function(a,b){return a.invoke(b,f)})}return d}function D(a,b){b=a.static;a=a.dynamic;if("framebuffer"in b){var c=b.framebuffer;return c?(c=h.getFramebuffer(c),u.command(c,"invalid framebuffer object"),ba(function(a,b){var d=a.link(c);a=a.shared;b.set(a.framebuffer,".next",d);a=a.context;b.set(a,".framebufferWidth",d+".width");b.set(a,".framebufferHeight",d+".height");return d})):ba(function(a,b){a=a.shared;b.set(a.framebuffer,".next","null");a=a.context;b.set(a,".framebufferWidth",
a+".drawingBufferWidth");b.set(a,".framebufferHeight",a+".drawingBufferHeight");return"null"})}if("framebuffer"in a){var d=a.framebuffer;return ua(d,function(a,b){var c=a.invoke(b,d),f=a.shared,e=f.framebuffer,k=b.def(e,".getFramebuffer(",c,")");u.optional(function(){a.assert(b,"!"+c+"||"+k,"invalid framebuffer object")});b.set(e,".next",k);f=f.context;b.set(f,".framebufferWidth",k+"?"+k+".width:"+f+".drawingBufferWidth");b.set(f,".framebufferHeight",k+"?"+k+".height:"+f+".drawingBufferHeight");return k})}return null}
function A(a,b,c){function d(a){if(a in f){var d=f[a];u.commandType(d,"object","invalid "+a,c.commandStr);var k=!0,h=d.x|0,l=d.y|0;if("width"in d){var m=d.width|0;u.command(0<=m,"invalid "+a,c.commandStr)}else k=!1;if("height"in d){var n=d.height|0;u.command(0<=n,"invalid "+a,c.commandStr)}else k=!1;return new za(!k&&b&&b.thisDep,!k&&b&&b.contextDep,!k&&b&&b.propDep,function(a,b){a=a.shared.context;var c=m;"width"in d||(c=b.def(a,".","framebufferWidth","-",h));var f=n;"height"in d||(f=b.def(a,".",
"framebufferHeight","-",l));return[h,l,c,f]})}if(a in e){var p=e[a];k=ua(p,function(b,c){var d=b.invoke(c,p);u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var f=b.shared.context,e=c.def(d,".x|0"),k=c.def(d,".y|0"),h=c.def('"width" in ',d,"?",d,".width|0:","(",f,".","framebufferWidth","-",e,")"),l=c.def('"height" in ',d,"?",d,".height|0:","(",f,".","framebufferHeight","-",k,")");u.optional(function(){b.assert(c,h+">=0&&"+l+">=0","invalid "+a)});return[e,k,h,l]});b&&
(k.thisDep=k.thisDep||b.thisDep,k.contextDep=k.contextDep||b.contextDep,k.propDep=k.propDep||b.propDep);return k}return b?new za(b.thisDep,b.contextDep,b.propDep,function(a,b){a=a.shared.context;return[0,0,b.def(a,".","framebufferWidth"),b.def(a,".","framebufferHeight")]}):null}var f=a.static,e=a.dynamic;if(a=d("viewport")){var k=a;a=new za(a.thisDep,a.contextDep,a.propDep,function(a,b){var c=k.append(a,b);a=a.shared.context;b.set(a,".viewportWidth",c[2]);b.set(a,".viewportHeight",c[3]);return c})}return{viewport:a,
scissor_box:d("scissor.box")}}function B(a){function c(a){if(a in d){var c=b.id(d[a]);u.optional(function(){n.shader(zb[a],c,u.guessCommand())});var e=ba(function(){return c});e.id=c;return e}if(a in f){var k=f[a];return ua(k,function(b,c){var d=b.invoke(c,k),f=c.def(b.shared.strings,".id(",d,")");u.optional(function(){c(b.shared.shader,".shader(",zb[a],",",f,",",b.command,");")});return f})}return null}var d=a.static,f=a.dynamic,e=c("frag"),k=c("vert"),h=null;db(e)&&db(k)?(h=n.program(k.id,e.id),
a=ba(function(a,b){return a.link(h)})):a=new za(e&&e.thisDep||k&&k.thisDep,e&&e.contextDep||k&&k.contextDep,e&&e.propDep||k&&k.propDep,function(a,b){var c=a.shared.shader;var d=e?e.append(a,b):b.def(c,".","frag");var f=k?k.append(a,b):b.def(c,".","vert");var h=c+".program("+f+","+d;u.optional(function(){h+=","+a.command});return b.def(h+")")});return{frag:e,vert:k,progVar:a,program:h}}function wa(a,b){function c(a,c){if(a in d){var e=d[a]|0;u.command(!c||0<=e,"invalid "+a,b.commandStr);return ba(function(a,
b){c&&(a.OFFSET=e);return e})}if(a in f){var h=f[a];return ua(h,function(b,d){var f=b.invoke(d,h);c&&(b.OFFSET=f,u.optional(function(){b.assert(d,f+">=0","invalid "+a)}));return f})}return c&&k?ba(function(a,b){a.OFFSET="0";return 0}):null}var d=a.static,f=a.dynamic,k=function(){if("elements"in d){var a=d.elements;Fa(a)?a=e.getElements(e.create(a,!0)):a&&(a=e.getElements(a),u.command(a,"invalid elements",b.commandStr));var c=ba(function(b,c){return a?(c=b.link(a),b.ELEMENTS=c):b.ELEMENTS=null});c.value=
a;return c}if("elements"in f){var k=f.elements;return ua(k,function(a,b){var c=a.shared,d=c.isBufferArgs;c=c.elements;var f=a.invoke(b,k),e=b.def("null");d=b.def(d,"(",f,")");var h=a.cond(d).then(e,"=",c,".createStream(",f,");").else(e,"=",c,".getElements(",f,");");u.optional(function(){a.assert(h.else,"!"+f+"||"+e,"invalid elements")});b.entry(h);b.exit(a.cond(d).then(c,".destroyStream(",e,");"));return a.ELEMENTS=e})}return null}(),h=c("offset",!0);return{elements:k,primitive:function(){if("primitive"in
d){var a=d.primitive;u.commandParameter(a,Bb,"invalid primitve",b.commandStr);return ba(function(b,c){return Bb[a]})}if("primitive"in f){var c=f.primitive;return ua(c,function(a,b){var d=a.constants.primTypes,f=a.invoke(b,c);u.optional(function(){a.assert(b,f+" in "+d,"invalid primitive, must be one of "+Object.keys(Bb))});return b.def(d,"[",f,"]")})}return k?db(k)?k.value?ba(function(a,b){return b.def(a.ELEMENTS,".primType")}):ba(function(){return 4}):new za(k.thisDep,k.contextDep,k.propDep,function(a,
b){a=a.ELEMENTS;return b.def(a,"?",a,".primType:",4)}):null}(),count:function(){if("count"in d){var a=d.count|0;u.command("number"===typeof a&&0<=a,"invalid vertex count",b.commandStr);return ba(function(){return a})}if("count"in f){var c=f.count;return ua(c,function(a,b){var d=a.invoke(b,c);u.optional(function(){a.assert(b,"typeof "+d+'==="number"&&'+d+">=0&&"+d+"===("+d+"|0)","invalid vertex count")});return d})}if(k){if(db(k)){if(k)return h?new za(h.thisDep,h.contextDep,h.propDep,function(a,b){var c=
b.def(a.ELEMENTS,".vertCount-",a.OFFSET);u.optional(function(){a.assert(b,c+">=0","invalid vertex offset/element buffer too small")});return c}):ba(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var e=ba(function(){return-1});u.optional(function(){e.MISSING=!0});return e}var l=new za(k.thisDep||h.thisDep,k.contextDep||h.contextDep,k.propDep||h.propDep,function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")});u.optional(function(){l.DYNAMIC=
!0});return l}return null}(),instances:c("instances",!1),offset:h}}function Ia(a,b){var c=a.static,f=a.dynamic,e={};U.forEach(function(a){function k(b,d){if(a in c){var k=b(c[a]);e[h]=ba(function(){return k})}else if(a in f){var l=f[a];e[h]=ua(l,function(a,b){return d(a,b,a.invoke(b,l))})}}var h=z(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return k(function(c){u.commandType(c,
"boolean",a,b.commandStr);return c},function(b,c,d){u.optional(function(){b.assert(c,"typeof "+d+'==="boolean"',"invalid flag "+a,b.commandStr)});return d});case "depth.func":return k(function(c){u.commandParameter(c,Fb,"invalid "+a,b.commandStr);return Fb[c]},function(b,c,d){var f=b.constants.compareFuncs;u.optional(function(){b.assert(c,d+" in "+f,"invalid "+a+", must be one of "+Object.keys(Fb))});return c.def(f,"[",d,"]")});case "depth.range":return k(function(a){u.command(Y(a)&&2===a.length&&
"number"===typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",b.commandStr);return a},function(a,b,c){u.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===2&&typeof "+c+'[0]==="number"&&typeof '+c+'[1]==="number"&&'+c+"[0]<="+c+"[1]","depth range must be a 2d array")});var d=b.def("+",c,"[0]"),f=b.def("+",c,"[1]");return[d,f]});case "blend.func":return k(function(a){u.commandType(a,"object","blend.func",b.commandStr);var c="srcRGB"in a?a.srcRGB:a.src,
d="srcAlpha"in a?a.srcAlpha:a.src,f="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;u.commandParameter(c,Ma,h+".srcRGB",b.commandStr);u.commandParameter(d,Ma,h+".srcAlpha",b.commandStr);u.commandParameter(f,Ma,h+".dstRGB",b.commandStr);u.commandParameter(a,Ma,h+".dstAlpha",b.commandStr);u.command(-1===yb.indexOf(c+", "+f),"unallowed blending combination (srcRGB, dstRGB) = ("+c+", "+f+")",b.commandStr);return[Ma[c],Ma[f],Ma[d],Ma[a]]},function(b,c,d){function f(f,k){var h=c.def('"',f,
k,'" in ',d,"?",d,".",f,k,":",d,".",f);u.optional(function(){b.assert(c,h+" in "+e,"invalid "+a+"."+f+k+", must be one of "+Object.keys(Ma))});return h}var e=b.constants.blendFuncs;u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid blend func, must be an object")});var k=f("src","RGB"),h=f("dst","RGB");u.optional(function(){b.assert(c,b.constants.invalidBlendCombinations+".indexOf("+k+'+", "+'+h+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var l=c.def(e,
"[",k,"]"),m=c.def(e,"[",f("src","Alpha"),"]"),n=c.def(e,"[",h,"]"),p=c.def(e,"[",f("dst","Alpha"),"]");return[l,n,m,p]});case "blend.equation":return k(function(c){if("string"===typeof c)return u.commandParameter(c,P,"invalid "+a,b.commandStr),[P[c],P[c]];if("object"===("undefined"===typeof c?"undefined":V(c)))return u.commandParameter(c.rgb,P,a+".rgb",b.commandStr),u.commandParameter(c.alpha,P,a+".alpha",b.commandStr),[P[c.rgb],P[c.alpha]];u.commandRaise("invalid blend.equation",b.commandStr)},
function(b,c,d){var f=b.constants.blendEquations,e=c.def(),k=c.def(),h=b.cond("typeof ",d,'==="string"');u.optional(function(){function c(a,c,d){b.assert(a,d+" in "+f,"invalid "+c+", must be one of "+Object.keys(P))}c(h.then,a,d);b.assert(h.else,d+"&&typeof "+d+'==="object"',"invalid "+a);c(h.else,a+".rgb",d+".rgb");c(h.else,a+".alpha",d+".alpha")});h.then(e,"=",k,"=",f,"[",d,"];");h.else(e,"=",f,"[",d,".rgb];",k,"=",f,"[",d,".alpha];");c(h);return[e,k]});case "blend.color":return k(function(a){u.command(Y(a)&&
4===a.length,"blend.color must be a 4d array",b.commandStr);return R(4,function(b){return+a[b]})},function(a,b,c){u.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4","blend.color must be a 4d array")});return R(4,function(a){return b.def("+",c,"[",a,"]")})});case "stencil.mask":return k(function(a){u.commandType(a,"number",h,b.commandStr);return a|0},function(a,b,c){u.optional(function(){a.assert(b,"typeof "+c+'==="number"',"invalid stencil.mask")});return b.def(c,"|0")});
case "stencil.func":return k(function(c){u.commandType(c,"object",h,b.commandStr);var d=c.cmp||"keep",f=c.ref||0;c="mask"in c?c.mask:-1;u.commandParameter(d,Fb,a+".cmp",b.commandStr);u.commandType(f,"number",a+".ref",b.commandStr);u.commandType(c,"number",a+".mask",b.commandStr);return[Fb[d],f,c]},function(a,b,c){var d=a.constants.compareFuncs;u.optional(function(){function f(){a.assert(b,Array.prototype.join.call(arguments,""),"invalid stencil.func")}f(c+"&&typeof ",c,'==="object"');f('!("cmp" in ',
c,")||(",c,".cmp in ",d,")")});var f=b.def('"cmp" in ',c,"?",d,"[",c,".cmp]",":",7680),e=b.def(c,".ref|0"),k=b.def('"mask" in ',c,"?",c,".mask|0:-1");return[f,e,k]});case "stencil.opFront":case "stencil.opBack":return k(function(c){u.commandType(c,"object",h,b.commandStr);var d=c.fail||"keep",f=c.zfail||"keep";c=c.zpass||"keep";u.commandParameter(d,eb,a+".fail",b.commandStr);u.commandParameter(f,eb,a+".zfail",b.commandStr);u.commandParameter(c,eb,a+".zpass",b.commandStr);return["stencil.opBack"===
a?1029:1028,eb[d],eb[f],eb[c]]},function(b,c,d){function f(f){u.optional(function(){b.assert(c,'!("'+f+'" in '+d+")||("+d+"."+f+" in "+e+")","invalid "+a+"."+f+", must be one of "+Object.keys(eb))});return c.def('"',f,'" in ',d,"?",e,"[",d,".",f,"]:",7680)}var e=b.constants.stencilOps;u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,f("fail"),f("zfail"),f("zpass")]});case "polygonOffset.offset":return k(function(a){u.commandType(a,
"object",h,b.commandStr);var c=a.factor|0;a=a.units|0;u.commandType(c,"number",h+".factor",b.commandStr);u.commandType(a,"number",h+".units",b.commandStr);return[c,a]},function(b,c,d){u.optional(function(){b.assert(c,d+"&&typeof "+d+'==="object"',"invalid "+a)});var f=c.def(d,".factor|0"),e=c.def(d,".units|0");return[f,e]});case "cull.face":return k(function(a){var c=0;"front"===a?c=1028:"back"===a&&(c=1029);u.command(!!c,h,b.commandStr);return c},function(a,b,c){u.optional(function(){a.assert(b,
c+'==="front"||'+c+'==="back"',"invalid cull.face")});return b.def(c,'==="front"?',1028,":",1029)});case "lineWidth":return k(function(a){u.command("number"===typeof a&&a>=d.lineWidthDims[0]&&a<=d.lineWidthDims[1],"invalid line width, must be a positive number between "+d.lineWidthDims[0]+" and "+d.lineWidthDims[1],b.commandStr);return a},function(a,b,c){u.optional(function(){a.assert(b,"typeof "+c+'==="number"&&'+c+">="+d.lineWidthDims[0]+"&&"+c+"<="+d.lineWidthDims[1],"invalid line width")});return c});
case "frontFace":return k(function(a){u.commandParameter(a,nb,h,b.commandStr);return nb[a]},function(a,b,c){u.optional(function(){a.assert(b,c+'==="cw"||'+c+'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return b.def(c+'==="cw"?2304:2305')});case "colorMask":return k(function(a){u.command(Y(a)&&4===a.length,"color.mask must be length 4 array",b.commandStr);return a.map(function(a){return!!a})},function(a,b,c){u.optional(function(){a.assert(b,a.shared.isArrayLike+"("+c+")&&"+c+".length===4",
"invalid color.mask")});return R(4,function(a){return"!!"+c+"["+a+"]"})});case "sample.coverage":return k(function(a){u.command("object"===("undefined"===typeof a?"undefined":V(a))&&a,h,b.commandStr);var c="value"in a?a.value:1;a=!!a.invert;u.command("number"===typeof c&&0<=c&&1>=c,"sample.coverage.value must be a number between 0 and 1",b.commandStr);return[c,a]},function(a,b,c){u.optional(function(){a.assert(b,c+"&&typeof "+c+'==="object"',"invalid sample.coverage")});var d=b.def('"value" in ',
c,"?+",c,".value:1"),f=b.def("!!",c,".invert");return[d,f]})}});return e}function E(a,b){var c=a.static,d=a.dynamic,f={};Object.keys(c).forEach(function(a){var d=c[a];if("number"===typeof d||"boolean"===typeof d)var e=ba(function(){return d});else if("function"===typeof d){var k=d._reglType;"texture2d"===k||"textureCube"===k?e=ba(function(a){return a.link(d)}):"framebuffer"===k||"framebufferCube"===k?(u.command(0<d.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',b.commandStr),
e=ba(function(a){return a.link(d.color[0])})):u.commandRaise('invalid data for uniform "'+a+'"',b.commandStr)}else Y(d)?e=ba(function(b){return b.global.def("[",R(d.length,function(c){u.command("number"===typeof d[c]||"boolean"===typeof d[c],"invalid uniform "+a,b.commandStr);return d[c]}),"]")}):u.commandRaise('invalid or missing data for uniform "'+a+'"',b.commandStr);e.value=d;f[a]=e});Object.keys(d).forEach(function(a){var b=d[a];f[a]=ua(b,function(a,c){return a.invoke(c,b)})});return f}function F(a,
c){var d=a.static,e=a.dynamic,k={};Object.keys(d).forEach(function(a){var e=d[a],h=b.id(a),l=new T;if(Fa(e))l.state=1,l.buffer=f.getBuffer(f.create(e,34962,!1,!0)),l.type=0;else{var m=f.getBuffer(e);if(m)l.state=1,l.buffer=m,l.type=0;else if(u.command("object"===("undefined"===typeof e?"undefined":V(e))&&e,"invalid data for attribute "+a,c.commandStr),"constant"in e){var n=e.constant;l.buffer="null";l.state=2;"number"===typeof n?l.x=n:(u.command(Y(n)&&0<n.length&&4>=n.length,"invalid constant for attribute "+
a,c.commandStr),Gb.forEach(function(a,b){b<n.length&&(l[a]=n[b])}))}else{m=Fa(e.buffer)?f.getBuffer(f.create(e.buffer,34962,!1,!0)):f.getBuffer(e.buffer);u.command(!!m,'missing buffer for attribute "'+a+'"',c.commandStr);var p=e.offset|0;u.command(0<=p,'invalid offset for attribute "'+a+'"',c.commandStr);var q=e.stride|0;u.command(0<=q&&256>q,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',c.commandStr);var t=e.size|0;u.command(!("size"in e)||0<t&&4>=t,'invalid size for attribute "'+
a+'", must be 1,2,3,4',c.commandStr);var z=!!e.normalized,ca=0;"type"in e&&(u.commandParameter(e.type,Rb,"invalid type for attribute "+a,c.commandStr),ca=Rb[e.type]);var v=e.divisor|0;"divisor"in e&&(u.command(0===v||O,'cannot specify divisor for attribute "'+a+'", instancing not supported',c.commandStr),u.command(0<=v,'invalid divisor for attribute "'+a+'"',c.commandStr));u.optional(function(){var b=c.commandStr,d="buffer offset divisor normalized type size stride".split(" ");Object.keys(e).forEach(function(c){u.command(0<=
d.indexOf(c),'unknown parameter "'+c+'" for attribute pointer "'+a+'" (valid parameters are '+d+")",b)})});l.buffer=m;l.state=1;l.size=t;l.normalized=z;l.type=ca||m.dtype;l.offset=p;l.stride=q;l.divisor=v}}k[a]=ba(function(a,b){b=a.attribCache;if(h in b)return b[h];var c={isStream:!1};Object.keys(l).forEach(function(a){c[a]=l[a]});l.buffer&&(c.buffer=a.link(l.buffer),c.type=c.type||c.buffer+".dtype");return b[h]=c})});Object.keys(e).forEach(function(a){var b=e[a];k[a]=ua(b,function(c,d){function f(a){d(m[a],
"=",e,".",a,"|0;")}var e=c.invoke(d,b),k=c.shared,h=k.isBufferArgs,l=k.buffer;u.optional(function(){c.assert(d,e+"&&(typeof "+e+'==="object"||typeof '+e+'==="function")&&('+h+"("+e+")||"+l+".getBuffer("+e+")||"+l+".getBuffer("+e+".buffer)||"+h+"("+e+'.buffer)||("constant" in '+e+"&&(typeof "+e+'.constant==="number"||'+k.isArrayLike+"("+e+".constant))))",'invalid dynamic attribute "'+a+'"')});var m={isStream:d.def(!1)},n=new T;n.state=1;Object.keys(n).forEach(function(a){m[a]=d.def(""+n[a])});var p=
m.buffer,q=m.type;d("if(",h,"(",e,")){",m.isStream,"=true;",p,"=",l,".createStream(",34962,",",e,");",q,"=",p,".dtype;","}else{",p,"=",l,".getBuffer(",e,");","if(",p,"){",q,"=",p,".dtype;",'}else if("constant" in ',e,"){",m.state,"=",2,";","if(typeof "+e+'.constant === "number"){',m[Gb[0]],"=",e,".constant;",Gb.slice(1).map(function(a){return m[a]}).join("="),"=0;","}else{",Gb.map(function(a,b){return m[a]+"="+e+".constant.length>"+b+"?"+e+".constant["+b+"]:0;"}).join(""),"}}else{","if(",h,"(",e,
".buffer)){",p,"=",l,".createStream(",34962,",",e,".buffer);","}else{",p,"=",l,".getBuffer(",e,".buffer);","}",q,'="type" in ',e,"?",k.glTypes,"[",e,".type]:",p,".dtype;",m.normalized,"=!!",e,".normalized;");f("size");f("offset");f("stride");f("divisor");d("}}");d.exit("if(",m.isStream,"){",l,".destroyStream(",p,");","}");return m})});return k}function C(a){var b=a.static,c=a.dynamic,d={};Object.keys(b).forEach(function(a){var c=b[a];d[a]=ba(function(a,b){return"number"===typeof c||"boolean"===typeof c?
""+c:a.link(c)})});Object.keys(c).forEach(function(a){var b=c[a];d[a]=ua(b,function(a,c){return a.invoke(c,b)})});return d}function oa(a,b,c,d,f){function e(a){var b=m[a];b&&(p[a]=b)}var k=a.static,h=a.dynamic;u.optional(function(){function a(a){Object.keys(a).forEach(function(a){u.command(0<=b.indexOf(a),'unknown parameter "'+a+'"',f.commandStr)})}var b="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(U);a(k);a(h)});var l=D(a,f),m=A(a,l,f),n=wa(a,f),p=Ia(a,
f),q=B(a,f);e("viewport");e(z("scissor.box"));var t=0<Object.keys(p).length;l={framebuffer:l,draw:n,shader:q,state:p,dirty:t};l.profile=y(a,f);l.uniforms=E(c,f);l.attributes=F(b,f);l.context=C(d,f);return l}function Ka(a,b,c){var d=a.shared.context,f=a.scope();Object.keys(c).forEach(function(e){b.save(d,"."+e);f(d,".",e,"=",c[e].append(a,b),";")});b(f)}function sa(a,b,c,d){var f=a.shared,e=f.gl,k=f.framebuffer,h;qb&&(h=b.def(f.extensions,".webgl_draw_buffers"));var l=a.constants;f=l.drawBuffer;l=
l.backBuffer;a=c?c.append(a,b):b.def(k,".next");d||b("if(",a,"!==",k,".cur){");b("if(",a,"){",e,".bindFramebuffer(",36160,",",a,".framebuffer);");qb&&b(h,".drawBuffersWEBGL(",f,"[",a,".colorAttachments.length]);");b("}else{",e,".bindFramebuffer(",36160,",null);");qb&&b(h,".drawBuffersWEBGL(",l,");");b("}",k,".cur=",a,";");d||b("}")}function Ja(a,b,c){var d=a.shared,f=d.gl,e=a.current,k=a.next,h=d.current,l=d.next,m=a.cond(h,".dirty");U.forEach(function(b){b=z(b);if(!(b in c.state))if(b in k){var d=
k[b];var n=e[b];var p=R(L[b].length,function(a){return m.def(d,"[",a,"]")});m(a.cond(p.map(function(a,b){return a+"!=="+n+"["+b+"]"}).join("||")).then(f,".",Sa[b],"(",p,");",p.map(function(a,b){return n+"["+b+"]="+a}).join(";"),";"))}else d=m.def(l,".",b),p=a.cond(d,"!==",h,".",b),m(p),b in cb?p(a.cond(d).then(f,".enable(",cb[b],");").else(f,".disable(",cb[b],");"),h,".",b,"=",d,";"):p(f,".",Sa[b],"(",d,");",h,".",b,"=",d,";")});0===Object.keys(c.state).length&&m(h,".dirty=false;");b(m)}function aa(a,
b,c,d){var f=a.shared,e=a.current,k=f.current,h=f.gl;Ua(Object.keys(c)).forEach(function(f){var l=c[f];if(!d||d(l)){var m=l.append(a,b);if(cb[f]){var n=cb[f];db(l)?m?b(h,".enable(",n,");"):b(h,".disable(",n,");"):b(a.cond(m).then(h,".enable(",n,");").else(h,".disable(",n,");"));b(k,".",f,"=",m,";")}else if(Y(m)){var p=e[f];b(h,".",Sa[f],"(",m,");",m.map(function(a,b){return p+"["+b+"]="+a}).join(";"),";")}else b(h,".",Sa[f],"(",m,");",k,".",f,"=",m,";")}})}function ia(a,b){O&&(a.instancing=b.def(a.shared.extensions,
".angle_instanced_arrays"))}function H(a,b,c,d,f){function e(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function k(a){u=b.def();a(u,"=",e(),";");"string"===typeof f?a(n,".count+=",f,";"):a(n,".count++;");t&&(d?(z=b.def(),a(z,"=",q,".getNumPendingQueries();")):a(q,".beginQuery(",n,");"))}function h(a){a(n,".cpuTime+=",e(),"-",u,";");t&&(d?a(q,".pushScopeStats(",z,",",q,".getNumPendingQueries(),",n,");"):a(q,".endQuery();"))}function l(a){var c=b.def(p,".profile");b(p,
".profile=",a,";");b.exit(p,".profile=",c,";")}var m=a.shared,n=a.stats,p=m.current,q=m.timer;c=c.profile;var u,z;if(c){if(db(c)){c.enable?(k(b),h(b.exit),l("true")):l("false");return}c=c.append(a,b);l(c)}else c=b.def(p,".profile");m=a.block();k(m);b("if(",c,"){",m,"}");a=a.block();h(a);b.exit("if(",c,"){",a,"}")}function Vb(a,b,c,d,f){function e(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}
function k(c,d,f){function e(){b("if(!",n,".buffer){",l,".enableVertexAttribArray(",m,");}");var c=f.type;var e=f.size?b.def(f.size,"||",d):d;b("if(",n,".type!==",c,"||",n,".size!==",e,"||",u.map(function(a){return n+"."+a+"!=="+f[a]}).join("||"),"){",l,".bindBuffer(",34962,",",p,".buffer);",l,".vertexAttribPointer(",[m,e,c,f.normalized,f.stride,f.offset],");",n,".type=",c,";",n,".size=",e,";",u.map(function(a){return n+"."+a+"="+f[a]+";"}).join(""),"}");O&&(c=f.divisor,b("if(",n,".divisor!==",c,
"){",a.instancing,".vertexAttribDivisorANGLE(",[m,c],");",n,".divisor=",c,";}"))}function k(){b("if(",n,".buffer){",l,".disableVertexAttribArray(",m,");","}if(",Gb.map(function(a,b){return n+"."+a+"!=="+q[b]}).join("||"),"){",l,".vertexAttrib4f(",m,",",q,");",Gb.map(function(a,b){return n+"."+a+"="+q[b]+";"}).join(""),"}")}var l=h.gl,m=b.def(c,".location"),n=b.def(h.attributes,"[",m,"]");c=f.state;var p=f.buffer,q=[f.x,f.y,f.z,f.w],u=["buffer","normalized","offset","stride"];1===c?e():2===c?k():(b("if(",
c,"===",1,"){"),e(),b("}else{"),k(),b("}"))}var h=a.shared;d.forEach(function(d){var h=d.name,l=c.attributes[h];if(l){if(!f(l))return;var m=l.append(a,b)}else{if(!f(Ab))return;var n=a.scopeAttrib(h);u.optional(function(){a.assert(b,n+".state","missing attribute "+h)});m={};Object.keys(new T).forEach(function(a){m[a]=b.def(n,".",a)})}k(a.link(d),e(d.info.type),m)})}function G(a,c,d,f,e){for(var k=a.shared,h=k.gl,l,m=0;m<f.length;++m){var n=f[m],p=n.name,q=n.info.type,t=d.uniforms[p];n=a.link(n)+".location";
if(t){if(!e(t))continue;if(db(t)){var z=t.value;u.command(null!==z&&"undefined"!==typeof z,'missing uniform "'+p+'"',a.commandStr);if(35678===q||35680===q)u.command("function"===typeof z&&(35678===q&&("texture2d"===z._reglType||"framebuffer"===z._reglType)||35680===q&&("textureCube"===z._reglType||"framebufferCube"===z._reglType)),"invalid texture for uniform "+p,a.commandStr),t=a.link(z._texture||z.color[0]._texture),c(h,".uniform1i(",n,",",t+".bind());"),c.exit(t,".unbind();");else if(35674===q||
35675===q||35676===q){u.optional(function(){u.command(Y(z),"invalid matrix for uniform "+p,a.commandStr);u.command(35674===q&&4===z.length||35675===q&&9===z.length||35676===q&&16===z.length,"invalid length for matrix uniform "+p,a.commandStr)});t=a.global.def("new Float32Array(["+Array.prototype.slice.call(z)+"])");var v=2;35675===q?v=3:35676===q&&(v=4);c(h,".uniformMatrix",v,"fv(",n,",false,",t,");")}else{switch(q){case 5126:u.commandType(z,"number","uniform "+p,a.commandStr);l="1f";break;case 35664:u.command(Y(z)&&
2===z.length,"uniform "+p,a.commandStr);l="2f";break;case 35665:u.command(Y(z)&&3===z.length,"uniform "+p,a.commandStr);l="3f";break;case 35666:u.command(Y(z)&&4===z.length,"uniform "+p,a.commandStr);l="4f";break;case 35670:u.commandType(z,"boolean","uniform "+p,a.commandStr);l="1i";break;case 5124:u.commandType(z,"number","uniform "+p,a.commandStr);l="1i";break;case 35671:u.command(Y(z)&&2===z.length,"uniform "+p,a.commandStr);l="2i";break;case 35667:u.command(Y(z)&&2===z.length,"uniform "+p,a.commandStr);
l="2i";break;case 35672:u.command(Y(z)&&3===z.length,"uniform "+p,a.commandStr);l="3i";break;case 35668:u.command(Y(z)&&3===z.length,"uniform "+p,a.commandStr);l="3i";break;case 35673:u.command(Y(z)&&4===z.length,"uniform "+p,a.commandStr);l="4i";break;case 35669:u.command(Y(z)&&4===z.length,"uniform "+p,a.commandStr),l="4i"}c(h,".uniform",l,"(",n,",",Y(z)?Array.prototype.slice.call(z):z,");")}continue}else var w=t.append(a,c)}else{if(!e(Ab))continue;w=c.def(k.uniforms,"[",b.id(p),"]")}35678===q?
c("if(",w,"&&",w,'._reglType==="framebuffer"){',w,"=",w,".color[0];","}"):35680===q&&c("if(",w,"&&",w,'._reglType==="framebufferCube"){',w,"=",w,".color[0];","}");u.optional(function(){function b(b,d){a.assert(c,b,'bad data or missing for uniform "'+p+'".  '+d)}function d(a){b("typeof "+w+'==="'+a+'"',"invalid type, expected "+a)}function f(c,d){b(k.isArrayLike+"("+w+")&&"+w+".length==="+c,"invalid vector, should have length "+c,a.commandStr)}function e(c){b("typeof "+w+'==="function"&&'+w+'._reglType==="texture'+
(3553===c?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(q){case 5124:d("number");break;case 35667:f(2,"number");break;case 35668:f(3,"number");break;case 35669:f(4,"number");break;case 5126:d("number");break;case 35664:f(2,"number");break;case 35665:f(3,"number");break;case 35666:f(4,"number");break;case 35670:d("boolean");break;case 35671:f(2,"boolean");break;case 35672:f(3,"boolean");break;case 35673:f(4,"boolean");break;case 35674:f(4,"number");break;case 35675:f(9,"number");break;
case 35676:f(16,"number");break;case 35678:e(3553);break;case 35680:e(34067)}});t=1;switch(q){case 35678:case 35680:t=c.def(w,"._texture");c(h,".uniform1i(",n,",",t,".bind());");c.exit(t,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i";t=2;break;case 35668:case 35672:l="3i";t=3;break;case 35669:case 35673:l="4i";t=4;break;case 5126:l="1f";break;case 35664:l="2f";t=2;break;case 35665:l="3f";t=3;break;case 35666:l="4f";t=4;break;case 35674:l="Matrix2fv";break;case 35675:l=
"Matrix3fv";break;case 35676:l="Matrix4fv"}c(h,".uniform",l,"(",n,",");if("M"===l.charAt(0)){n=Math.pow(q-35674+2,2);var x=a.global.def("new Float32Array(",n,")");c("false,(Array.isArray(",w,")||",w," instanceof Float32Array)?",w,":(",R(n,function(a){return x+"["+a+"]="+w+"["+a+"]"}),",",x,")")}else 1<t?c(R(t,function(a){return w+"["+a+"]"})):c(w);c(");")}}function J(a,b,c,d){function f(f){var e=n[f];return e?e.contextDep&&d.contextDynamic||e.propDep?e.append(a,c):e.append(a,b):b.def(m,".",f)}function e(){function a(){c(v,
".drawElementsInstancedANGLE(",[q,t,x,z+"<<(("+x+"-5121)>>1)",w],");")}function b(){c(v,".drawArraysInstancedANGLE(",[q,z,t,w],");")}p?Q?a():(c("if(",p,"){"),a(),c("}else{"),b(),c("}")):b()}function k(){function a(){c(l+".drawElements("+[q,t,x,z+"<<(("+x+"-5121)>>1)"]+");")}function b(){c(l+".drawArrays("+[q,z,t]+");")}p?Q?a():(c("if(",p,"){"),a(),c("}else{"),b(),c("}")):b()}var h=a.shared,l=h.gl,m=h.draw,n=d.draw,p=function(){var f=n.elements,e=b;if(f){if(f.contextDep&&d.contextDynamic||f.propDep)e=
c;f=f.append(a,e)}else f=e.def(m,".","elements");f&&e("if("+f+")"+l+".bindBuffer(34963,"+f+".buffer.buffer);");return f}(),q=f("primitive"),z=f("offset"),t=function(){var f=n.count,e=b;if(f){if(f.contextDep&&d.contextDynamic||f.propDep)e=c;var k=f.append(a,e);u.optional(function(){f.MISSING&&a.assert(b,"false","missing vertex count");f.DYNAMIC&&a.assert(e,k+">=0","missing vertex count")})}else k=e.def(m,".","count"),u.optional(function(){a.assert(e,k+">=0","missing vertex count")});return k}();if("number"===
typeof t){if(0===t)return}else c("if(",t,"){"),c.exit("}");if(O){var w=f("instances");var v=a.instancing}var x=p+".type",Q=n.elements&&db(n.elements);O&&("number"!==typeof w||0<=w)?"string"===typeof w?(c("if(",w,">0){"),e(),c("}else if(",w,"<0){"),k(),c("}")):e():k()}function K(a,b,c,d,f){var e=Q();f=e.proc("body",f);u.optional(function(){e.commandStr=b.commandStr;e.command=e.link(b.commandStr)});O&&(e.instancing=f.def(e.shared.extensions,".angle_instanced_arrays"));a(e,f,c,d);return e.compile().body}
function M(a,b,c,d){ia(a,b);Vb(a,b,c,d.attributes,function(){return!0});G(a,b,c,d.uniforms,function(){return!0});J(a,b,b,c)}function nd(a,b){var c=a.proc("draw",1);ia(a,c);Ka(a,c,b.context);sa(a,c,b.framebuffer);Ja(a,c,b);aa(a,c,b.state);H(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",d,".program);");if(b.shader.program)M(a,c,b,b.shader.program);else{var f=a.global.def("{}"),e=c.def(d,".id"),k=c.def(f,"[",e,"]");c(a.cond(k).then(k,".call(this,a0);").else(k,"=",f,"[",
e,"]=",a.link(function(c){return K(M,a,b,c,1)}),"(",d,");",k,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ub(a,b,c,d){function f(){return!0}a.batchId="a1";ia(a,b);Vb(a,b,c,d.attributes,f);G(a,b,c,d.uniforms,f);J(a,b,b,c)}function rb(a,b,c,d){function f(a){return a.contextDep&&k||a.propDep}function e(a){return!f(a)}ia(a,b);var k=c.contextDep,h=b.def(),l=b.def();a.shared.props=l;a.batchId=h;var m=a.scope(),n=a.scope();b(m.entry,"for(",h,"=0;",h,"<",
"a1",";++",h,"){",l,"=","a0","[",h,"];",n,"}",m.exit);c.needsContext&&Ka(a,n,c.context);c.needsFramebuffer&&sa(a,n,c.framebuffer);aa(a,n,c.state,f);c.profile&&f(c.profile)&&H(a,n,c,!1,!0);d?(Vb(a,m,c,d.attributes,e),Vb(a,n,c,d.attributes,f),G(a,m,c,d.uniforms,e),G(a,n,c,d.uniforms,f),J(a,m,n,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,n),l=n.def(d,".id"),m=n.def(b,"[",l,"]"),n(a.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",b,"[",l,"]=",a.link(function(b){return K(Ub,a,c,b,
2)}),"(",d,");}",m,".call(this,a0[",h,"],",h,");"))}function W(a,b){function c(a){return a.contextDep&&f||a.propDep}var d=a.proc("batch",2);a.batchId="0";ia(a,d);var f=!1,e=!0;Object.keys(b.context).forEach(function(a){f=f||b.context[a].propDep});f||(Ka(a,d,b.context),e=!1);var k=b.framebuffer,h=!1;k?(k.propDep?f=h=!0:k.contextDep&&f&&(h=!0),h||sa(a,d,k)):sa(a,d,null);b.state.viewport&&b.state.viewport.propDep&&(f=!0);Ja(a,d,b);aa(a,d,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||H(a,
d,b,!1,"a1");b.contextDep=f;b.needsContext=e;b.needsFramebuffer=h;e=b.shader.progVar;if(e.contextDep&&f||e.propDep)rb(a,d,b,null);else if(e=e.append(a,d),d(a.shared.gl,".useProgram(",e,".program);"),b.shader.program)rb(a,d,b,b.shader.program);else{k=a.global.def("{}");h=d.def(e,".id");var l=d.def(k,"[",h,"]");d(a.cond(l).then(l,".call(this,a0,a1);").else(l,"=",k,"[",h,"]=",a.link(function(c){return K(rb,a,b,c,2)}),"(",e,");",l,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,
".dirty=true;")}function N(a,c){function d(b){var d=c.shader[b];d&&f.set(e.shader,"."+b,d.append(a,f))}var f=a.proc("scope",3);a.batchId="a2";var e=a.shared,k=e.current;Ka(a,f,c.context);c.framebuffer&&c.framebuffer.append(a,f);Ua(Object.keys(c.state)).forEach(function(b){var d=c.state[b].append(a,f);Y(d)?d.forEach(function(c,d){f.set(a.next[b],"["+d+"]",c)}):f.set(e.next,"."+b,d)});H(a,f,c,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(b){var d=c.draw[b];d&&f.set(e.draw,
"."+b,""+d.append(a,f))});Object.keys(c.uniforms).forEach(function(d){f.set(e.uniforms,"["+b.id(d)+"]",c.uniforms[d].append(a,f))});Object.keys(c.attributes).forEach(function(b){var d=c.attributes[b].append(a,f),e=a.scopeAttrib(b);Object.keys(new T).forEach(function(a){f.set(e,"."+a,d[a])})});d("vert");d("frag");0<Object.keys(c.state).length&&(f(k,".dirty=true;"),f.exit(k,".dirty=true;"));f("a1(",a.shared.context,",a0,",a.batchId,");")}function S(a){if("object"===("undefined"===typeof a?"undefined":
V(a))&&!Y(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(Ea.isDynamic(a[b[c]]))return!0;return!1}}function Ac(a,b,c){var d=b.static[c];if(d&&S(d)){var f=a.global,e=Object.keys(d),k=!1,h=!1,l=!1,m=a.global.def("{}");e.forEach(function(b){var c=d[b];if(Ea.isDynamic(c))"function"===typeof c&&(c=d[b]=Ea.unbox(c)),b=ua(c,null),k=k||b.thisDep,l=l||b.propDep,h=h||b.contextDep;else{f(m,".",b,"=");switch("undefined"===typeof c?"undefined":V(c)){case "number":f(c);break;case "string":f('"',c,'"');break;
case "object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}});b.dynamic[c]=new Ea.DynamicVariable(4,{thisDep:k,contextDep:h,propDep:l,ref:m,append:function(a,b){e.forEach(function(c){var f=d[c];Ea.isDynamic(f)&&(f=a.invoke(b,f),b(m,".",c,"=",f,";"))})}});delete b.static[c]}}var T=m.Record,P={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(P.min=32775,P.max=32776);var O=c.angle_instanced_arrays,qb=c.webgl_draw_buffers,L={dirty:!0,profile:v.profile},
Sb={},U=[],cb={},Sa={};x("dither",3024);x("blend.enable",3042);w("blend.color","blendColor",[0,0,0,0]);w("blend.equation","blendEquationSeparate",[32774,32774]);w("blend.func","blendFuncSeparate",[1,0,1,0]);x("depth.enable",2929,!0);w("depth.func","depthFunc",513);w("depth.range","depthRange",[0,1]);w("depth.mask","depthMask",!0);w("colorMask","colorMask",[!0,!0,!0,!0]);x("cull.enable",2884);w("cull.face","cullFace",1029);w("frontFace","frontFace",2305);w("lineWidth","lineWidth",1);x("polygonOffset.enable",
32823);w("polygonOffset.offset","polygonOffset",[0,0]);x("sample.alpha",32926);x("sample.enable",32928);w("sample.coverage","sampleCoverage",[1,!1]);x("stencil.enable",2960);w("stencil.mask","stencilMask",-1);w("stencil.func","stencilFunc",[519,0,-1]);w("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);w("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);x("scissor.enable",3089);w("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);w("viewport","viewport",
[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var Z={gl:a,context:q,strings:b,next:Sb,current:L,draw:p,elements:e,buffer:f,shader:n,attributes:m.state,uniforms:l,framebuffer:h,extensions:c,timer:t,isBufferArgs:Fa},X={primTypes:Bb,compareFuncs:Fb,blendFuncs:Ma,blendEquations:P,stencilOps:eb,glTypes:Rb,orientationType:nb};u.optional(function(){Z.isArrayLike=Y});qb&&(X.backBuffer=[1029],X.drawBuffer=R(d.maxDrawbuffers,function(a){return 0===a?[0]:R(a,function(a){return 36064+a})}));var mb=0;return{next:Sb,
current:L,procs:function(){var a=Q(),b=a.proc("poll"),c=a.proc("refresh"),f=a.block();b(f);c(f);var e=a.shared,k=e.gl,h=e.next,l=e.current;f(l,".dirty=false;");sa(a,b);sa(a,c,null,!0);var m;O&&(m=a.link(O));for(var n=0;n<d.maxAttributes;++n){var p=c.def(e.attributes,"[",n,"]"),q=a.cond(p,".buffer");q.then(k,".enableVertexAttribArray(",n,");",k,".bindBuffer(",34962,",",p,".buffer.buffer);",k,".vertexAttribPointer(",n,",",p,".size,",p,".type,",p,".normalized,",p,".stride,",p,".offset);").else(k,".disableVertexAttribArray(",
n,");",k,".vertexAttrib4f(",n,",",p,".x,",p,".y,",p,".z,",p,".w);",p,".buffer=null;");c(q);O&&c(m,".vertexAttribDivisorANGLE(",n,",",p,".divisor);")}Object.keys(cb).forEach(function(d){var e=cb[d],m=f.def(h,".",d),n=a.block();n("if(",m,"){",k,".enable(",e,")}else{",k,".disable(",e,")}",l,".",d,"=",m,";");c(n);b("if(",m,"!==",l,".",d,"){",n,"}")});Object.keys(Sa).forEach(function(d){var e=Sa[d],m=L[d],n=a.block();n(k,".",e,"(");if(Y(m)){e=m.length;var p=a.global.def(h,".",d);var q=a.global.def(l,".",
d);n(R(e,function(a){return p+"["+a+"]"}),");",R(e,function(a){return q+"["+a+"]="+p+"["+a+"];"}).join(""));b("if(",R(e,function(a){return p+"["+a+"]!=="+q+"["+a+"]"}).join("||"),"){",n,"}")}else p=f.def(h,".",d),q=f.def(l,".",d),n(p,");",l,".",d,"=",p,";"),b("if(",p,"!==",q,"){",n,"}");c(n)});return a.compile()}(),compile:function(a,b,c,d,f){var e=Q();e.stats=e.link(f);Object.keys(b.static).forEach(function(a){Ac(e,b,a)});Pb.forEach(function(b){Ac(e,a,b)});c=oa(a,b,c,d,e);nd(e,c);N(e,c);W(e,c);return e.compile()}}}
function Wa(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var ka=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},Z=function(a,b){for(var c=Object.keys(b),d=0;d<c.length;++d)a[c[d]]=b[c[d]];return a},Xa="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),
ta={};ta[5120]=ta[5121]=1;ta[5122]=ta[5123]=ta[36193]=ta[33635]=ta[32819]=ta[32820]=2;ta[5124]=ta[5125]=ta[5126]=ta[34042]=4;var u=Z(c,{optional:function(a){a()},raise:a,commandRaise:w,command:function(a,b,c){a||w(b,c||p())},parameter:function(b,c,f){b in c||a("unknown parameter ("+b+")"+d(f)+". possible values: "+Object.keys(c).join())},commandParameter:function(a,b,c,f){a in b||w("unknown parameter ("+a+")"+d(c)+". possible values: "+Object.keys(b).join(),f||p())},constructor:function(b){Object.keys(b).forEach(function(b){0>
Xa.indexOf(b)&&a('invalid regl constructor argument "'+b+'". must be one of '+Xa)})},type:function(b,c,f){("undefined"===typeof b?"undefined":V(b))!==c&&a("invalid parameter type"+d(f)+". expected "+c+", got "+("undefined"===typeof b?"undefined":V(b)))},commandType:A,isTypedArray:function(b,c){ka(b)||a("invalid parameter type"+d(c)+". must be a typed array")},nni:function(b,c){0<=b&&(b|0)===b||a("invalid parameter type, ("+b+")"+d(c)+". must be a nonnegative integer")},oneOf:e,shaderError:function(a,
b,d,f,e){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=f===a.FRAGMENT_SHADER?"fragment":"vertex";A(d,"string",a+" shader source must be a string",e);var k=t(d,e);d=v(b);x(k,d);Object.keys(k).forEach(function(a){function b(a,b){d.push(a);f.push(b||"")}var c=k[a];if(c.hasErrors){var d=[""],f=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(l(a.number,4)+"|  ","background-color:yellow; font-weight:bold");
b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(d){d=d.message;var f=/^\s*'(.*)'\s*:\s*(.*)$/.exec(d);if(f){var e=f[1];d=f[2];switch(e){case "assign":e="="}c=Math.max(a.line.indexOf(e,c),0)}else c=0;b(l("| ",6));b(l("^^^",c+3)+"\n","font-weight:bold");b(l("| ",6));b(d+"\n","font-weight:bold")});b(l("| ",6)+"\n")}else b(l(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"===typeof document||window.chrome||(f[0]=d.join("%c"))}});c.raise("Error compiling "+
a+" shader, "+k[0].name)}},linkError:function(a,b,d,f,e){a.getProgramParameter(b,a.LINK_STATUS)||(a.getProgramInfoLog(b),a=t(d,e),f='Error linking program with vertex shader, "'+t(f,e)[0].name+'", and fragment shader "'+a[0].name+'"',c.raise(f))},callSite:m,saveCommandRef:y,saveDrawInfo:function(a,b,c,d){function f(a){return a?d.id(a):0}function e(a,b){Object.keys(b).forEach(function(b){a[d.id(b)]=!0})}y(a);a._fragId=f(a.static.frag);a._vertId=f(a.static.vert);var k=a._uniformSet={};e(k,b.static);
e(k,b.dynamic);b=a._attributeSet={};e(b,c.static);e(b,c.dynamic);a._hasCount="count"in a.static||"count"in a.dynamic||"elements"in a.static||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?e(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):e(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},guessCommand:p,texture2D:function(a,b,d){var f=b.width,e=b.height,k=b.channels;c(0<f&&f<=d.maxTextureSize&&0<e&&e<=d.maxTextureSize,
"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||c(!(f&f-1)&&!!f&&!(e&e-1)&&!!e,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==f&&1!==e&&c(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(c(!(f&f-1)&&!!f&&!(e&e-1)&&!!e,"texture must be a square power of 2 to support mipmapping"),c(b.mipmask===(f<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>d.extensions.indexOf("oes_texture_float_linear")&&
c(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),c(!a.genMipmaps,"mipmap generation not supported with float textures"));var h=b.images;for(d=0;16>d;++d)if(h[d]){var l=f>>d,m=e>>d;c(b.mipmask&1<<d,"missing mipmap data");var n=h[d];c(n.width===l&&n.height===m,"invalid shape for mip images");c(n.format===b.format&&n.internalformat===b.internalformat&&n.type===b.type,"incompatible type for mip image");!n.compressed&&n.data&&(l=Math.ceil(B(n.type,
k)*l/n.unpackAlignment)*n.unpackAlignment,c(n.data.byteLength===l*m,"invalid data for image, buffer size is inconsistent with image format"))}else a.genMipmaps||c(0===(b.mipmask&1<<d),"extra mipmap data");b.compressed&&c(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,d,f){var e=a.width,k=a.height,h=a.channels;c(0<e&&e<=f.maxTextureSize&&0<k&&k<=f.maxTextureSize,"invalid texture shape");c(e===k,"cube map must be square");c(33071===b.wrapS&&33071===
b.wrapT,"wrap mode not supported by cube map");for(f=0;f<d.length;++f){var l=d[f];c(l.width===e&&l.height===k,"inconsistent cube map face shape");b.genMipmaps&&(c(!l.compressed,"can not generate mipmap for compressed textures"),c(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var m=l.images,n=0;16>n;++n){var p=m[n];if(p){var q=e>>n,t=k>>n;c(l.mipmask&1<<n,"missing mipmap data");c(p.width===q&&p.height===t,"invalid shape for mip images");c(p.format===a.format&&p.internalformat===
a.internalformat&&p.type===a.type,"incompatible type for mip image");p.compressed||p.data&&c(p.data.byteLength===q*t*Math.max(B(p.type,h),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}}),lb=0,Ea={DynamicVariable:C,define:function(a,b){return new C(a,F(b+""))},isDynamic:function(a){return"function"===typeof a&&!a._reglType||a instanceof C},unbox:function(a,b){return"function"===typeof a?new C(0,a):a},accessor:F},Ra={next:"function"===typeof requestAnimationFrame?
function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"===typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},ab="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},L=da();L.zero=da();var sb=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var d=1,f=1;b.webgl_draw_buffers&&(d=a.getParameter(34852),f=a.getParameter(36063));var e=
!!b.oes_texture_float;if(e){e=a.createTexture();a.bindTexture(3553,e);a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var k=a.createFramebuffer();a.bindFramebuffer(36160,k);a.framebufferTexture2D(36160,36064,3553,e,0);a.bindTexture(3553,null);if(36053!==a.checkFramebufferStatus(36160))e=!1;else{a.viewport(0,0,1,1);a.clearColor(1,0,0,1);a.clear(16384);var h=L.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,h);a.getError()?e=!1:(a.deleteFramebuffer(k),a.deleteTexture(e),e=1===h[0]);L.freeType(h)}}h=
!0;"undefined"!==typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(h=a.createTexture(),k=L.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,h),a.texImage2D(34069,0,6408,3,3,0,6408,5121,k),L.freeType(k),a.bindTexture(34067,null),a.deleteTexture(h),h=!a.getError());return{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),
subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter(function(a){return!!b[a]}),maxAnisotropic:c,maxDrawbuffers:d,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),
maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:e,npotTextureCube:h}},Da=function(a){return Object.keys(a).map(function(b){return a[b]})},Na={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,d){var f=1;if(b.length)for(var e=0;e<b.length;++e)f*=b[e];else f=
0;c=d||L.allocType(c,f);switch(b.length){case 0:break;case 1:d=b[0];for(b=0;b<d;++b)c[b]=a[b];break;case 2:d=b[0];b=b[1];for(e=f=0;e<d;++e)for(var k=a[e],h=0;h<b;++h)c[f++]=k[h];break;case 3:ea(a,b[0],b[1],b[2],c,0);break;default:O(a,b,0,c,0)}return c}},Oa={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,
"[object ArrayBuffer]":5121},Rb={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Pa={dynamic:35048,stream:35040,"static":35044},Ya=Na.flatten,ob=Na.shape,bb=[];bb[5120]=1;bb[5122]=2;bb[5124]=4;bb[5121]=1;bb[5123]=2;bb[5125]=4;bb[5126]=4;var Bb={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},pb=new Float32Array(1),Hb=new Uint32Array(pb.buffer),tb=function(a){return!(a&a-1)&&!!a},Ib=
[9984,9986,9985,9987],Xb=[0,6409,6410,6407,6408],xa={};xa[6409]=xa[6406]=xa[6402]=1;xa[34041]=xa[6410]=2;xa[6407]=xa[35904]=3;xa[6408]=xa[35906]=4;var hb=la("HTMLCanvasElement"),ub=la("CanvasRenderingContext2D"),vb=la("ImageBitmap"),wb=la("HTMLImageElement"),xb=la("HTMLVideoElement"),Jb=Object.keys(Oa).concat([hb,ub,vb,wb,xb]),Cb=[];Cb[5121]=1;Cb[5126]=4;Cb[36193]=2;Cb[5123]=2;Cb[5125]=4;var ha=[];ha[32854]=2;ha[32855]=2;ha[36194]=2;ha[34041]=4;ha[33776]=.5;ha[33777]=.5;ha[33778]=1;ha[33779]=1;ha[35986]=
.5;ha[35987]=1;ha[34798]=1;ha[35840]=.5;ha[35841]=.25;ha[35842]=.5;ha[35843]=.25;ha[36196]=.5;var Aa=[];Aa[32854]=2;Aa[32855]=2;Aa[36194]=2;Aa[33189]=2;Aa[36168]=1;Aa[34041]=4;Aa[35907]=4;Aa[34836]=16;Aa[34842]=8;Aa[34843]=6;var Kb=function(a,b,c,d,f){function e(a){this.id=m++;this.refCount=1;this.renderbuffer=a;this.format=32854;this.height=this.width=0;f.profile&&(this.stats={size:0})}function k(b){var c=b.renderbuffer;u(c,"must not double destroy renderbuffer");a.bindRenderbuffer(36161,null);a.deleteRenderbuffer(c);
b.renderbuffer=null;b.refCount=0;delete n[b.id];d.renderbufferCount--}var h={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};b.ext_srgb&&(h.srgba=35907);b.ext_color_buffer_half_float&&(h.rgba16f=34842,h.rgb16f=34843);b.webgl_color_buffer_float&&(h.rgba32f=34836);var l=[];Object.keys(h).forEach(function(a){l[h[a]]=a});var m=0,n={};e.prototype.decRef=function(){0>=--this.refCount&&k(this)};f.profile&&(d.getTotalRenderbufferSize=function(){var a=0;Object.keys(n).forEach(function(b){a+=
n[b].stats.size});return a});return{create:function(b,k){function m(b,d){var e=0,k=0,n=32854;"object"===("undefined"===typeof b?"undefined":V(b))&&b?("shape"in b?(d=b.shape,u(Array.isArray(d)&&2<=d.length,"invalid renderbuffer shape"),e=d[0]|0,k=d[1]|0):("radius"in b&&(e=k=b.radius|0),"width"in b&&(e=b.width|0),"height"in b&&(k=b.height|0)),"format"in b&&(u.parameter(b.format,h,"invalid renderbuffer format"),n=h[b.format])):"number"===typeof b?(e=b|0,k="number"===typeof d?d|0:e):b?u.raise("invalid arguments to renderbuffer constructor"):
e=k=1;u(0<e&&0<k&&e<=c.maxRenderbufferSize&&k<=c.maxRenderbufferSize,"invalid renderbuffer size");if(e!==p.width||k!==p.height||n!==p.format)return m.width=p.width=e,m.height=p.height=k,p.format=n,a.bindRenderbuffer(36161,p.renderbuffer),a.renderbufferStorage(36161,n,e,k),u(0===a.getError(),"invalid render buffer format"),f.profile&&(p.stats.size=Aa[p.format]*p.width*p.height),m.format=l[p.format],m}var p=new e(a.createRenderbuffer());n[p.id]=p;d.renderbufferCount++;m(b,k);m.resize=function(b,d){b|=
0;d=d|0||b;if(b===p.width&&d===p.height)return m;u(0<b&&0<d&&b<=c.maxRenderbufferSize&&d<=c.maxRenderbufferSize,"invalid renderbuffer size");m.width=p.width=b;m.height=p.height=d;a.bindRenderbuffer(36161,p.renderbuffer);a.renderbufferStorage(36161,p.format,b,d);u(0===a.getError(),"invalid render buffer format");f.profile&&(p.stats.size=Aa[p.format]*p.width*p.height);return m};m._reglType="renderbuffer";m._renderbuffer=p;f.profile&&(m.stats=p.stats);m.destroy=function(){p.decRef()};return m},clear:function(){Da(n).forEach(k)},
restore:function(){Da(n).forEach(function(b){b.renderbuffer=a.createRenderbuffer();a.bindRenderbuffer(36161,b.renderbuffer);a.renderbufferStorage(36161,b.format,b.width,b.height)});a.bindRenderbuffer(36161,null)}}},Lb=[6407,6408],kb=[];kb[6408]=4;kb[6407]=3;var Zb=[];Zb[5121]=1;Zb[5126]=4;Zb[36193]=2;var Mb=[32854,32855,36194,35907,34842,34843,34836],Nb={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",36061:"unsupported"},Gb=["x",
"y","z","w"],Pb="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ma={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},yb="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
Fb={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},eb={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},zb={frag:35632,vert:35633},nb={cw:2304,ccw:2305},Ab=new za(!1,!1,!1,function(){}),Qb=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function d(a,b,d){var f=
k.pop()||new c;f.startQueryIndex=a;f.endQueryIndex=b;f.sum=0;f.stats=d;h.push(f)}if(!b.ext_disjoint_timer_query)return null;var f=[],e=[],k=[],h=[],l=[],m=[];return{beginQuery:function(a){var c=f.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,c);e.push(c);d(e.length-1,e.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:d,update:function(){var a;var c=e.length;if(0!==c){m.length=Math.max(m.length,c+1);l.length=
Math.max(l.length,c+1);l[0]=0;var d=m[0]=0;for(a=c=0;a<e.length;++a){var n=e[a];b.ext_disjoint_timer_query.getQueryObjectEXT(n,34919)?(d+=b.ext_disjoint_timer_query.getQueryObjectEXT(n,34918),f.push(n)):e[c++]=n;l[a+1]=d;m[a+1]=c}e.length=c;for(a=c=0;a<h.length;++a){d=h[a];var p=d.startQueryIndex;n=d.endQueryIndex;d.sum+=l[n]-l[p];p=m[p];n=m[n];n===p?(d.stats.gpuTime+=d.sum/1E6,k.push(d)):(d.startQueryIndex=p,d.endQueryIndex=n,h[c++]=d)}h.length=c}},getNumPendingQueries:function(){return e.length},
clear:function(){f.push.apply(f,e);for(var a=0;a<f.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(f[a]);e.length=0;f.length=0},restore:function(){e.length=0;f.length=0}}};return function(a){function b(){if(0===L.length)A&&A.update(),Y=null;else{Y=Ra.next(b);n();for(var a=L.length-1;0<=a;--a){var c=L[a];c&&c(C,null,0)}t.flush();A&&A.update()}}function c(){!Y&&0<L.length&&(Y=Ra.next(b))}function d(){Y&&(Ra.cancel(b),Y=null)}function f(a){a.preventDefault();v=!0;d();U.forEach(function(a){a()})}
function e(a){t.getError();v=!1;x.restore();M.restore();J.restore();I.restore();O.restore();W.restore();A&&A.restore();N.procs.refresh();c();X.forEach(function(a){a()})}function k(a){function b(a){var b={},c={};Object.keys(a).forEach(function(d){var f=a[d];Ea.isDynamic(f)?c[d]=Ea.unbox(f,d):b[d]=f});return{dynamic:c,static:b}}function c(a){for(;n.length<a;)n.push(null);return n}u(!!a,"invalid args to regl({...})");u.type(a,"object","invalid args to regl({...})");var d=b(a.context||{}),f=b(a.uniforms||
{}),e=b(a.attributes||{}),k=b(function(a){function b(a){if(a in c){var b=c[a];delete c[a];Object.keys(b).forEach(function(d){c[a+"."+d]=b[d]})}}var c=Z({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};d=N.compile(k,e,f,d,a);var h=d.draw,l=d.batch,m=d.scope,
n=[];return Z(function(a,b){var d;v&&u.raise("context lost");if("function"===typeof a)return m.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)m.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)m.call(this,a[d],b,d);else return m.call(this,a,b,0);else if("number"===typeof a){if(0<a)return l.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return l.call(this,a,a.length)}else return h.call(this,a)},{stats:a})}function h(a,b){a=0;N.procs.poll();
var c=b.color;c&&(t.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),a|=16384);"depth"in b&&(t.clearDepth(+b.depth),a|=256);"stencil"in b&&(t.clearStencil(b.stencil|0),a|=1024);u(!!a,"called regl.clear with no buffer specified");t.clear(a)}function l(a){u.type(a,"function","regl.frame() callback must be a function");L.push(a);c();return{cancel:function(){function b(){var a=Wa(L,b);L[a]=L[L.length-1];--L.length;0>=L.length&&d()}var c=Wa(L,a);u(0<=c,"cannot cancel a frame twice");L[c]=b}}}function m(){var a=
S.viewport,b=S.scissor_box;a[0]=a[1]=b[0]=b[1]=0;C.viewportWidth=C.framebufferWidth=C.drawingBufferWidth=a[2]=b[2]=t.drawingBufferWidth;C.viewportHeight=C.framebufferHeight=C.drawingBufferHeight=a[3]=b[3]=t.drawingBufferHeight}function n(){C.tick+=1;C.time=q();m();N.procs.poll()}function p(){m();N.procs.refresh();A&&A.update()}function q(){return(ab()-B)/1E3}a=T(a);if(!a)return null;var t=a.gl,w=t.getContextAttributes(),v=t.isContextLost(),x=P(t,a);if(!x)return null;var z=H(),y={bufferCount:0,elementsCount:0,
framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},D=x.extensions,A=Qb(t,D),B=ab(),E=t.drawingBufferWidth,F=t.drawingBufferHeight,C={tick:0,time:0,viewportWidth:E,viewportHeight:F,framebufferWidth:E,framebufferHeight:F,drawingBufferWidth:E,drawingBufferHeight:F,pixelRatio:a.pixelRatio},G=sb(t,D);E=Za(t,D,G,z);var J=qa(t,y,a,E),K=ra(t,D,J,y),M=fb(t,z,y,a),I=Ta(t,D,G,function(){N.procs.poll()},C,y,a),O=Kb(t,D,G,y,a),W=Va(t,D,G,I,O,y),N=jb(t,z,D,G,J,K,
I,W,{},E,M,{elements:null,primitive:4,count:-1,offset:0,instances:-1},C,A,a);z=gb(t,W,N.procs.poll,C,w,D,G);var S=N.next,R=t.canvas,L=[],U=[],X=[],mb=[a.onDestroy],Y=null;R&&(R.addEventListener("webglcontextlost",f,!1),R.addEventListener("webglcontextrestored",e,!1));var ba=W.setFBO=k({framebuffer:Ea.define.call(null,1,"framebuffer")});p();w=Z(k,{clear:function(a){u("object"===("undefined"===typeof a?"undefined":V(a))&&a,"regl.clear() takes an object as input");if("framebuffer"in a)if(a.framebuffer&&
"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)ba(Z({framebuffer:a.framebuffer.faces[b]},a),h);else ba(a,h);else h(null,a)},prop:Ea.define.bind(null,1),context:Ea.define.bind(null,2),this:Ea.define.bind(null,3),draw:k({}),buffer:function(a){return J.create(a,34962,!1,!1)},elements:function(a){return K.create(a,!1)},texture:I.create2D,cube:I.createCube,renderbuffer:O.create,framebuffer:W.create,framebufferCube:W.createCube,attributes:w,frame:l,on:function(a,b){u.type(b,"function","listener callback must be a function");
switch(a){case "frame":return l(b);case "lost":var c=U;break;case "restore":c=X;break;case "destroy":c=mb;break;default:u.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:G,hasExtension:function(a){return 0<=G.extensions.indexOf(a.toLowerCase())},read:z,destroy:function(){L.length=0;d();R&&(R.removeEventListener("webglcontextlost",f),R.removeEventListener("webglcontextrestored",
e));M.clear();W.clear();O.clear();I.clear();K.clear();J.clear();A&&A.clear();mb.forEach(function(a){a()})},_gl:t,_refresh:p,poll:function(){n();A&&A.update()},now:q,stats:y});a.onDone(null,w);return w}})});var od=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferData=[];return b}H(d,c);y(d,[{key:"initialize",value:function(b){this.gl=b;this.program=new K(this.gl,{vertexShader:"uniform mat4 u_matrix;attribute vec3 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos,1.0);}",
fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"});this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"getDefaultOptions",value:function(){return{blend:"lighter",color:"rgb(100,150,150)"}}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);var d=[];b=b.color;for(var e=0;e<a.length;e++){var l=a[e].geometry.coordinates,
n=a[e].color||b;"[object Function]"===Object.prototype.toString.call(n)&&(n=n(a[e]));n=this.normizedColor(n);for(var q=0;q<l.length-1;q++){var h=this.normizedPoint(l[q]);d.push(h[0]);d.push(h[1]);d.push(Number(l[q][2]||0));d.push(n[0],n[1],n[2],n[3]);h=this.normizedPoint(l[q+1]);d.push(h[0]);d.push(h[1]);d.push(Number(l[q+1][2]||0));d.push(n[0],n[1],n[2],n[3])}}this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=
b.gl,c=b.matrix;!this.bufferData||0>=this.bufferData.length||(b=this.program,a.useProgram(b.program),a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,7*c,0),a.enableVertexAttribArray(b.attributes.aColor),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,7*c,3*c),b=this.getOptions().blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),
a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.LINES,0,this.bufferData.length/7),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST))}}]);return d}(da),pd=function(){function c(d,b){x(this,c);this.layer=d;this.gl=b;this.initData()}y(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",
value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(c,b){this.initData();var a=c.color,d=c.height,k=c.gradient;c=this.gl;for(var e=0;e<b.length;e++){var l=b[e].geometry.coordinates,n=l.length;this.maxLength=n>this.maxLength?n:this.maxLength;for(var q=[],h=0;h<n;h++){var p=this.layer.normizedPoint(l[h]);q.push(p)}n=b[e].color||a;"properties"in b[e]&&"color"in b[e].properties&&(n=b[e].properties.color);k||"[object Function]"!==
Object.prototype.toString.call(n)||(n=n(b[e]));l=this.layer.normizedColor(k?k[0]:n);n=this.layer.normizedColor(k?k[1]:n);h=b[e].height||d;"properties"in b[e]&&"height"in b[e].properties&&(h=b[e].properties.height);"[object Function]"===Object.prototype.toString.call(h)&&(h=h(b[e]));this.processData(this.outWall3d,q,l,n,h)}for(b=0;b<this.outWall3d.vertex.length;b++){a=[];d=this.outWall3d.vertex[b].length;for(k=0;k<d;k++)a.push.apply(a,lb(this.outWall3d.vertex[b][k]));d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,
d);c.bufferData(c.ARRAY_BUFFER,new Float32Array(a),c.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=d;c.bindBuffer(c.ARRAY_BUFFER,null);d=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,d);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),c.STATIC_DRAW);this.outWall3d.indexBuffer[b]=d;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(c,b,a,f,k){var d=c.vertex[c.vertex.length-1],l=c.index[c.index.length-1],n=b.length;if(!d||65536<=d.length+
2*n+2)d=[],l=[],c.vertex.push(d),c.index.push(l);(c=d.length)&&l.push(c-1,c);for(var q=c=0;q<n;q++){var h=[],p=[],m=b[q];h.push(m[0],m[1]);h.push(m[2]?Number(m[2])+k:k);h.push(m[3]?Number(m[3]):q);h.push(c);h.push(a[0],a[1],a[2],a[3]);p.push(m[0],m[1]);p.push(m[2]?Number(m[2]):0);p.push(m[3]?Number(m[3]):q);p.push(c);p.push(f[0],f[1],f[2],f[3]);m=d.length;d.push(h,p);l.push(m,m+1);q<n-1&&(c+=this.getDistance(b[q],b[q+1]))}}},{key:"getDistance",value:function(c,b){return Math.sqrt(Math.pow(Math.abs(c[0]-
b[0]),2)+Math.pow(Math.abs(c[1]-b[1]),2))}}]);return c}(),qd=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.dataMgr=new pd(this,this.gl);this.program=new K(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute float aDistance;attribute vec4 aColor;varying vec4 vColor;varying float vHeight;varying float vTime;varying float vDistance;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vHeight=aPos.z;vColor=aColor;vDistance=aDistance;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",
fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;varying float vDistance;varying float vHeight;uniform float currentTime;void main(){if(vTime>1.0||vTime<0.0){}float radius=2.5;float distance=vDistance+currentTime*20.0;float modDistance=mod(distance,9.0);float alpha=1.0;if(modDistance>radius*2.0){discard;}else{float x=abs(modDistance-radius);float y=abs(vHeight-radius);float dis=sqrt(pow(x,2.0)+pow(y,2.0));if(dis>radius){discard;}alpha=dis/radius;}gl_FragColor=vec4(vColor.rgb,1.0-alpha);}"})}},
{key:"onChanged",value:function(b,a){this.gl&&(this.dataMgr.onLayerChange(b,a),void 0===b.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;if((b=this.dataMgr.getData())&&!(0>=b.vertex.length)){var d=this.getOptions(),e=this.program;a.useProgram(e.program);a.enable(a.BLEND);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(e.attributes.aPos);
a.enableVertexAttribArray(e.attributes.aDistance);a.enableVertexAttribArray(e.attributes.aColor);a.uniformMatrix4fv(e.uniforms.u_matrix,!1,c);a.uniform1f(e.uniforms.currentTime,this.time);a.uniform1f(e.uniforms.trailLength,d.trailLength);for(c=0;c<b.vertex.length;c++)if(!(0>=b.vertex[c].length)){var l=b.vertex[c],n=(new Float32Array(l[0])).BYTES_PER_ELEMENT;l=n*l[0].length;a.bindBuffer(a.ARRAY_BUFFER,b.vertexBuffer[c]);a.vertexAttribPointer(e.attributes.aPos,4,a.FLOAT,!1,l,0);a.vertexAttribPointer(e.attributes.aDistance,
1,a.FLOAT,!1,l,4*n);a.vertexAttribPointer(e.attributes.aColor,4,a.FLOAT,!1,l,5*n);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer[c]);a.drawElements(a.TRIANGLE_STRIP,b.index[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.time+=d.step;this.time>this.endTime&&(this.time=this.startTime);a.useProgram(null)}}}]);return d}(da),sb,Na,rd=(sb={},Qa(sb,1,1),Qa(sb,2,1),Qa(sb,3,1),sb),sd=(Na={},Qa(Na,
1,1),Qa(Na,2,1),Qa(Na,3,1),Na),Ba=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferMap={};b.bufferData=[];b.autoUpdate=!0;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{color:[1,1,1,.8],speed:1,size:5,pointFade:!0,pointFadeBuffer:1,minLineLength:2,animationType:2,shapeType:2,depthTest:!1}}},{key:"initialize",value:function(b){this.gl=b;var a=this.getOptions();this.updateUniformsFromOptions(a);this.program=new K(this.gl,
{vertexShader:"precision highp float;attribute vec3 aPos;attribute vec3 aNextPos;attribute float aIndex;attribute float aNextIndex;attribute float aLength;uniform float uSize;uniform mat4 u_matrix;uniform float uElapsedSteps;uniform int uAnimationType;uniform int uPointFade;uniform float uPointFadeBuffer;varying float vAddOpacity;void main(){if(uAnimationType==1){if(abs(aIndex-mod(uElapsedSteps,aLength))>.1){gl_Position=vec4(-2.,-2.,0,1.0);return;}gl_Position=u_matrix*vec4(aPos.xyz,1.0);vAddOpacity=1.;}else if(uAnimationType==2){float lineLength=aLength-1.;float cIndex=mod(uElapsedSteps,lineLength);float rest=cIndex-aIndex;if(rest<1.&&rest>=0.){if(uPointFade==1){if(cIndex<uPointFadeBuffer){vAddOpacity=cIndex/uPointFadeBuffer;}else if(cIndex>lineLength-uPointFadeBuffer){vAddOpacity=(lineLength-cIndex)/uPointFadeBuffer;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}else if(uAnimationType==3){float percent=mod(uElapsedSteps,aLength)/aLength;if(percent<=aNextIndex&&percent>=aIndex){if(uPointFade==1){float fadePercent=uPointFadeBuffer*1000./aLength;if(percent<fadePercent){vAddOpacity=percent/fadePercent;}else if(percent>1.-fadePercent){vAddOpacity=(1.-percent)/fadePercent;}else{vAddOpacity=1.;}}else{vAddOpacity=1.;}float rest=(percent-aIndex)/(aNextIndex-aIndex);gl_Position=u_matrix*vec4(aPos.x+(aNextPos.x-aPos.x)*rest,aPos.y+(aNextPos.y-aPos.y)*rest,aPos.z+(aNextPos.z-aPos.z)*rest,1.0);}else{gl_Position=vec4(-2.,-2.,0,1.0);return;}}gl_PointSize=uSize;}",
fragmentShader:"precision highp float;uniform vec4 uColor;uniform int ushapeType;varying float vAddOpacity;void main(){if(ushapeType==2){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}else if(ushapeType==3){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d>0.5){discard;}gl_FragColor=vec4(uColor.rgb,uColor.a*smoothstep(1.0,0.0,d*2.)*vAddOpacity);}else{gl_FragColor=vec4(uColor.rgb,uColor.a*vAddOpacity);}}"});this.buffer=b.createBuffer();
b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"bindAttributeBufferData",value:function(b,a,c,d){var f=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,f);c=new Float32Array(c);b.bufferData(b.ARRAY_BUFFER,c,b.STATIC_DRAW);this.bufferMap[a]={buffer:f,data:c,elementSize:d}}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){Array.isArray(a)||(a=[]);this.updateUniformsFromOptions(b);var d=[],e=[],l=[],n=[],q=[];b=b.minLineLength;for(var h=0;h<a.length;h++){var p=a[h].geometry.coordinates,m=p.length;
if(!(m<b)){for(var t=0;t<m;++t){var v=this.normizedPoint(p[t]);d.push(v[0]);d.push(v[1]);d.push(v[2]||0);3!==this.animationType&&(e.push(t),n.push(m))}if(1!==this.animationType){v=d.length-3*m+3;t=d.length;for(p=v;p<t;++p)q.push(d[p]);d.splice(t-3,3);if(2===this.animationType)e.pop(),n.pop();else if(3===this.animationType){v-=3;t=d.length-3;p=0;m=[];for(var x=v;x<=t;x+=3)v=Math.sqrt(Math.pow(q[x]-d[x],2)+Math.pow(q[x+1]-d[x+1],2)+Math.pow(q[x+2]-d[x+2],2)),p+=v,m.push(v);e.push(0);x=t=0;for(var y=
m.length-1;x<y;++x)t+=m[x],v=t/p,e.push(v),l.push(v),n.push(p);l.push(1);n.push(p)}}}}this.bindAttributeBufferData(c,"aPos",d,3);this.bindAttributeBufferData(c,"aIndex",e,1);this.bindAttributeBufferData(c,"aLength",n,1);1!==this.animationType&&(this.bindAttributeBufferData(c,"aNextPos",q,3),3===this.animationType&&this.bindAttributeBufferData(c,"aNextIndex",l,1));this.vertCount=d.length/3}}},{key:"updateUniformsFromOptions",value:function(b){this.color=this.normizedColor(b.color);this.startTime=(new Date).getTime();
rd[b.animationType]||(b.animationType=2);sd[b.shapeType]||(b.shapeType=2);if(isNaN(b.minLineLength)||2>b.minLineLength)b.minLineLength=2;this.animationType=b.animationType}},{key:"renderAttributeArr",value:function(b,a,c){if(void 0!==a.attributes[c]){var d=this.bufferMap[c];d&&(b.bindBuffer(b.ARRAY_BUFFER,d.buffer),b.enableVertexAttribArray(a.attributes[c]),b.vertexAttribPointer(a.attributes[c],d.elementSize,b.FLOAT,!1,d.data.BYTES_PER_ELEMENT*d.elementSize,0))}}},{key:"render",value:function(b){var a=
b.gl;b=b.matrix;if(!(0>=this.vertCount)){var c=this.program;a.useProgram(c.program);this.renderAttributeArr(a,c,"aPos");this.renderAttributeArr(a,c,"aIndex");this.renderAttributeArr(a,c,"aLength");1!==this.animationType&&(this.renderAttributeArr(a,c,"aNextPos"),3===this.animationType&&this.renderAttributeArr(a,c,"aNextIndex"));var d=(new Date).getTime()-this.startTime;d=1===this.animationType?Math.round(d/1E3*this.options.speed*20):3===this.animationType?d/1E3*this.options.speed*1E3:d/1E3*this.options.speed;
a.uniformMatrix4fv(c.uniforms.u_matrix,!1,b);a.uniform4f(c.uniforms.uColor,this.color[0],this.color[1],this.color[2],this.color[3]);a.uniform1f(c.uniforms.uSize,this.options.size);a.uniform1f(c.uniforms.uElapsedSteps,d);a.uniform1i(c.uniforms.uAnimationType,this.animationType);a.uniform1i(c.uniforms.ushapeType,this.options.shapeType);a.uniform1i(c.uniforms.uPointFade,this.options.pointFade?1:0);a.uniform1f(c.uniforms.uPointFadeBuffer,this.options.pointFadeBuffer);b=this.options.blend;c=this.options.depthTest;
a.enable(a.BLEND);c&&(a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL));a.blendEquation(a.FUNC_ADD);b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.drawArrays(a.POINTS,0,this.vertCount);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.useProgram(null)}}}]);return d}(da);Ba.ANIMATION_TYPE_LEAP=1;Ba.ANIMATION_TYPE_SMOOTH=2;Ba.ANIMATION_TYPE_UNIFORM_SPEED=3;Ba.SHAPE_TYPE_SQUARE=1;Ba.SHAPE_TYPE_CIRCLE=2;Ba.SHAPE_TYPE_CIRCLE_GRADIENT=
3;var td=function(){function c(d,b){x(this,c);this.layer=d;this.gl=b;this.initData()}y(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]}}},{key:"getData",value:function(){return this.outWall3d}},{key:"onLayerChange",value:function(c,b){this.initData();for(var a=c.color,d=c.height,k=c.gradient,e=c.enablePreciseMap,l=this.gl,n=0;n<b.length;n++){for(var q=b[n].geometry.coordinates,h=q.length,p=[],m=[],t=0,v=0;v<h;v++){var x=this.layer.normizedPoint(q[v]);
if(0<v&&e){var y=this.layer.normizedPoint(q[v-1]);t+=Math.sqrt(Math.pow(x[0]-y[0],2),Math.pow(x[1]-y[1],2))}p.push(x);m.push(t)}h=b[n].color||a;"properties"in b[n]&&"color"in b[n].properties&&(h=b[n].properties.color);k||"[object Function]"!==Object.prototype.toString.call(h)||(h=h(b[n]));q=this.layer.normizedColor(k?k[0]:h);h=this.layer.normizedColor(k?k[1]:h);t=b[n].height||d;"properties"in b[n]&&"height"in b[n].properties&&(t=b[n].properties.height);"[object Function]"===Object.prototype.toString.call(t)&&
(t=t(b[n]));this.processData(this.outWall3d,c,p,m,q,h,t)}for(c=0;c<this.outWall3d.vertex.length;c++){b=[];a=this.outWall3d.vertex[c].length;for(d=0;d<a;d++)b.push.apply(b,lb(this.outWall3d.vertex[c][d]));a=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,a);l.bufferData(l.ARRAY_BUFFER,new Float32Array(b),l.STATIC_DRAW);this.outWall3d.vertexBuffer[c]=a;l.bindBuffer(l.ARRAY_BUFFER,null);a=l.createBuffer();l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,a);l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[c]),
l.STATIC_DRAW);this.outWall3d.indexBuffer[c]=a;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(c,b,a,f,k,e,l){var d=f[f.length-1],q=c.vertex[c.vertex.length-1],h=c.index[c.index.length-1],p=a.length;if(!q||65536<=q.length+2*p+2)q=[],h=[],c.vertex.push(q),c.index.push(h);(c=q.length)&&h.push(c-1,c);for(c=0;c<p;c++){var m=[],t=[],v=a[c];m.push(v[0],v[1],l);m.push(k[0],k[1],k[2],k[3]);t.push(v[0],v[1],0);t.push(e[0],e[1],e[2],e[3]);b.texture&&(v=f[c],b.enablePreciseMap?
(m.push(v/d,1),t.push(v/d,0)):(m.push(c/(p-1),1),t.push(c/(p-1),0)));v=q.length;q.push(m,t);h.push(v,v+1)}}}]);return c}(),ud=function(c){function d(b,a){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a))}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{texture:null,enablePreciseMap:!1,height:100,color:[1,1,1,1]}}},{key:"initialize",value:function(b){this.gl=b;this.dataMgr=new td(this,this.gl);this.texture=null;this.isUseTexture=!1;this.vertexLength=10;this.program=
new K(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform bool uUseTexture;attribute vec3 aPos;attribute vec4 aColor;attribute vec2 aTextureCoords;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}if(uUseTexture){vTextureCoords=aTextureCoords;}gl_Position=u_matrix*vec4(aPos,1.0);}",fragmentShader:"precision highp float;uniform bool uUseTexture;uniform sampler2D uSampler;varying vec2 vTextureCoords;varying vec4 vColor;void main(){if(uUseTexture){gl_FragColor=vec4(1.0,1.0,1.0,1.0)*texture2D(uSampler,vTextureCoords);}else{gl_FragColor=vColor;}}"});
this.loadTexture()}},{key:"onChanged",value:function(b,a){var c=this;this.gl&&(this.loadTextureTime&&clearTimeout(this.loadTextureTime),this.loadTextureTime=setTimeout(function(){c.loadTexture(function(){c.dataMgr.onLayerChange(b,a);c.webglLayer.render()})},0))}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;if((b=this.dataMgr.getData())&&!(0>=b.vertex.length)){var d=this.getOptions(),e=this.program;a.useProgram(e.program);a.enable(a.BLEND);a.enable(a.DEPTH_TEST);a.blendEquation(a.FUNC_ADD);
a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);if(d.texture){if(!this.texture)return;a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniform1i(e.uniforms.uSampler,0);a.depthMask(!0);a.depthFunc(a.LESS)}else a.depthMask(!1),a.depthFunc(a.LEQUAL);d.texture?a.enableVertexAttribArray(e.attributes.aTextureCoords):a.disableVertexAttribArray(e.attributes.aTextureCoords);a.enableVertexAttribArray(e.attributes.aPos);a.enableVertexAttribArray(e.attributes.aColor);a.uniformMatrix4fv(e.uniforms.u_matrix,
!1,c);a.uniform1i(e.uniforms.uUseTexture,this.isUseTexture);for(c=0;c<b.vertex.length;c++)if(!(0>=b.vertex[c].length)){var l=b.vertex[c],n=(new Float32Array(l[0])).BYTES_PER_ELEMENT;l=n*l[0].length;a.bindBuffer(a.ARRAY_BUFFER,b.vertexBuffer[c]);a.vertexAttribPointer(e.attributes.aPos,3,a.FLOAT,!1,l,0);a.vertexAttribPointer(e.attributes.aColor,4,a.FLOAT,!1,l,3*n);d.texture&&a.vertexAttribPointer(e.attributes.aTextureCoords,2,a.FLOAT,!1,l,7*n);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer[c]);a.drawElements(a.TRIANGLE_STRIP,
b.index[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.useProgram(null)}}},{key:"loadTexture",value:function(b){var a=this,c=this.getOptions();c.texture?(this.isUseTexture=!0,wb(this.gl,c.texture,function(c,d){a.image=d;a.texture=c;b&&b();a.webglLayer.render()})):(this.isUseTexture=!1,this.image=this.texture=null,b&&b())}}]);return d}(da),vd=function(){function c(d,b){x(this,c);this.layer=d;this.gl=
b;this.initData()}y(c,[{key:"initData",value:function(){this.outWall3d={vertex:[],vertexBuffer:[],index:[],indexBuffer:[]};this.maxLength=0}},{key:"getData",value:function(){return this.outWall3d}},{key:"getMaxDataLength",value:function(){return this.maxLength}},{key:"onLayerChange",value:function(c,b){this.initData();var a=c.color,d=c.height,k=c.gradient;c=this.gl;for(var e=0;e<b.length;e++){var l=b[e].geometry.coordinates,n=l.length;this.maxLength=n>this.maxLength?n:this.maxLength;for(var q=[],
h=0;h<n;h++){var p=this.layer.normizedPoint(l[h]);q.push(p)}n=b[e].color||a;"properties"in b[e]&&"color"in b[e].properties&&(n=b[e].properties.color);k||"[object Function]"!==Object.prototype.toString.call(n)||(n=n(b[e]));l=this.layer.normizedColor(k?k[0]:n);n=this.layer.normizedColor(k?k[1]:n);h=b[e].height||d;"properties"in b[e]&&"height"in b[e].properties&&(h=b[e].properties.height);"[object Function]"===Object.prototype.toString.call(h)&&(h=h(b[e]));this.processData(this.outWall3d,q,l,n,h)}for(b=
0;b<this.outWall3d.vertex.length;b++){a=[];d=this.outWall3d.vertex[b].length;for(k=0;k<d;k++)a.push.apply(a,lb(this.outWall3d.vertex[b][k]));d=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,d);c.bufferData(c.ARRAY_BUFFER,new Float32Array(a),c.STATIC_DRAW);this.outWall3d.vertexBuffer[b]=d;c.bindBuffer(c.ARRAY_BUFFER,null);d=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,d);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.outWall3d.index[b]),c.STATIC_DRAW);this.outWall3d.indexBuffer[b]=
d;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null)}}},{key:"processData",value:function(c,b,a,f,k){var d=c.vertex[c.vertex.length-1],l=c.index[c.index.length-1],n=b.length;if(!d||65536<=d.length+2*n+2)d=[],l=[],c.vertex.push(d),c.index.push(l);(c=d.length)&&l.push(c-1,c);for(c=0;c<n;c++){var q=[],h=[],p=b[c];q.push(p[0],p[1]);q.push(p[2]?Number(p[2])+k:k);q.push(p[3]?Number(p[3]):c);q.push(a[0],a[1],a[2],a[3]);h.push(p[0],p[1]);h.push(p[2]?Number(p[2]):0);h.push(p[3]?Number(p[3]):c);h.push(f[0],f[1],f[2],
f[3]);p=d.length;d.push(q,h);l.push(p,p+1)}}}]);return c}(),wd=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{height:100,color:[1,1,1,1],trailLength:3,step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.dataMgr=new vd(this,this.gl);this.program=new K(this.gl,{vertexShader:"uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;varying float vTime;void main(){vTime=1.0-((currentTime-aPos.w)/trailLength);vColor=aColor;gl_Position=u_matrix*vec4(aPos.xyz,1.0);}",
fragmentShader:"precision highp float;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"})}},{key:"onChanged",value:function(b,a){this.gl&&(this.dataMgr.onLayerChange(b,a),void 0===b.endTime&&(this.endTime=this.dataMgr.getMaxDataLength()))}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;if((b=this.dataMgr.getData())&&!(0>=b.vertex.length)){var d=this.getOptions(),e=this.program;a.useProgram(e.program);a.enable(a.BLEND);
a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.enableVertexAttribArray(e.attributes.aPos);a.enableVertexAttribArray(e.attributes.aColor);a.uniformMatrix4fv(e.uniforms.u_matrix,!1,c);a.uniform1f(e.uniforms.currentTime,this.time);a.uniform1f(e.uniforms.trailLength,d.trailLength);for(c=0;c<b.vertex.length;c++)if(!(0>=b.vertex[c].length)){var l=b.vertex[c],n=(new Float32Array(l[0])).BYTES_PER_ELEMENT;l=n*l[0].length;a.bindBuffer(a.ARRAY_BUFFER,
b.vertexBuffer[c]);a.vertexAttribPointer(e.attributes.aPos,4,a.FLOAT,!1,l,0);a.vertexAttribPointer(e.attributes.aColor,4,a.FLOAT,!1,l,4*n);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b.indexBuffer[c]);a.drawElements(a.TRIANGLE_STRIP,b.index[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.time+=d.step;this.time>this.endTime&&(this.time=this.startTime);a.useProgram(null)}}}]);return d}(da),xd=function(c){function d(b,
a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.simpleLineLayer=new zc(b.getHeatOptions());b.children=[b.simpleLineLayer];return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{blend:"normal",gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onDataChanged",value:function(b){this.simpleLineLayer.setData(b)}},{key:"onOptionsChanged",value:function(b){this.simpleLineLayer.setOptions(this.getHeatOptions())}},
{key:"getHeatOptions",value:function(){var b=this.getOptions(),a=b.max,c=b.min;void 0===a&&(c=this.getDataRange(),a=c.max,c=c.min);var d=new X({max:a,min:c,gradient:b.gradient});b.color=function(a){var b=~~a.count||1;"properties"in a&&"count"in a.properties&&(b=~~a.properties.count);a=d.getImageData(b);return[a[0]/255,a[1]/255,a[2]/255,a[3]/255]};return b}},{key:"getDataRange",value:function(){var b=this.getData(),a=0,c=0;b[0]&&(a=~~b[0].count||1,c=~~b[0].count||1);"properties"in b[0]&&"count"in b[0].properties&&
(a=~~b[0].properties.count,c=~~b[0].properties.count);for(var d=b.length,e=0;e<d;e++){var l=~~b[e].count||1;"properties"in b[e]&&"count"in b[e].properties&&(l=~~b[e].properties.count);a=Math.max(l,a);c=Math.min(l,c)}return{max:a/2,min:c}}}]);return d}(yc),Cc={circle:1,square:2},Dc=function(c){function d(b){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b));b.bufferData=[];return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],blend:"normal",
shape:"circle",size:5}}},{key:"initialize",value:function(b){this.gl=b;this.program=new K(this.gl,{vertexShader:"attribute vec3 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;}",fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;void main(void){if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vColor;}}"},
this);this.buffer=new ob({gl:b,target:"ARRAY_BUFFER",usage:"STATIC_DRAW"});this.vertexArray=new Qb({gl:b,program:this.program,attributes:[{name:"aPos",buffer:this.buffer,size:3,type:"FLOAT",offset:0},{name:"aColor",buffer:this.buffer,size:4,type:"FLOAT",offset:12},{name:"aSize",buffer:this.buffer,size:1,type:"FLOAT",offset:28}]})}},{key:"onChanged",value:function(b,a){if(this.gl){var c=[],d=b.color;b=b.size;for(var e=0;e<a.length;e++){var l=a[e].geometry.coordinates,n=a[e].color||d;"properties"in
a[e]&&"color"in a[e].properties&&(n=a[e].properties.color);"[object Function]"===Object.prototype.toString.call(n)&&(n=n(a[e]));n=this.normizedColor(n);l=this.normizedPoint(l);var q=b;q="[object Function]"===Object.prototype.toString.call(q)?q(a[e]):Number(q);c.push(l[0],l[1],Number(l[2]||0));c.push(n[0],n[1],n[2],n[3]);c.push(q*window.devicePixelRatio)}this.bufferData=c;this.buffer.updateData(new Float32Array(c))}}},{key:"destroy",value:function(){this.buffer=this.program=this.bufferData=null}},
{key:"render",value:function(b){var a=b.gl;b=b.matrix;if(!(0>=this.bufferData.length)){var c=this.program;c.use(a);this.vertexArray.bind();var d=1;this.options.shape&&Cc[this.options.shape]&&(d=Cc[this.options.shape]);c.setUniforms({uShape:d,u_matrix:b});b=this.options.blend;a.enable(a.BLEND);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.blendEquation(a.FUNC_ADD);b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA);a.drawArrays(a.POINTS,0,this.bufferData.length/
8);this.buffer.unBind();a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.useProgram(null)}}}]);return d}(da),yd=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferDataArr=[];b.indexDataArr=[];b.vertexBuffer=[];b.indexBuffer=[];b.position=[];b.opacity=1;b.currentScale=1;b.autoUpdate=!0;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{color:[.1,.1,.9,1],size:5,segs:32,scale:2,unit:"m",step:.1}}},{key:"initialize",value:function(b){this.gl=
b;this.program=new K(this.gl,{vertexShader:"uniform mat4 u_projectionMatrix;uniform mat4 u_modelViewMatrix;uniform mat4 u_modelMatrix;uniform float u_opacity;attribute vec4 aPos;attribute vec4 aColor;varying vec4 vColor;void main(){vColor=aColor;vColor.a=u_opacity;gl_Position=u_projectionMatrix*u_modelViewMatrix*u_modelMatrix*vec4(aPos.xyz,1.0);}",fragmentShader:"precision highp float;varying vec4 vColor;void main(){gl_FragColor=vColor;}"})}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c&&
(this.currentScale=this.opacity=1,(this.data=a)&&a.length)){var d=b.color,e=b.segs;b=b.size;for(var l=360/e,n=0;n<a.length;n++){var q=[],h=[],p=this.normizedPoint(a[n].geometry.coordinates),m=a[n].color||d;"properties"in a[n]&&"color"in a[n].properties&&(m=a[n].properties.color);m=this.normizedColor(m);var t="[object Function]"===Object.prototype.toString.call(b)?b(a[n]):Number(b);var v=p[0],x=p[1];q.push(0,0,-.5);q.push(m[0],m[1],m[2],0);for(var y=1,w=0;y<=e;y++,w+=l)q.push(p[0]-v+Math.cos(Math.PI/
180*w)*t,p[1]-x+Math.sin(Math.PI/180*w)*t,-.5),q.push(m[0],m[1],m[2],this.opacity),y===e?h.push(0,0+y,1):h.push(0,0+y,0+y+1);m=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,m);c.bufferData(c.ARRAY_BUFFER,new Float32Array(q),c.STATIC_DRAW);this.vertexBuffer[n]=m;this.bufferDataArr[n]=q;c.bindBuffer(c.ARRAY_BUFFER,null);q=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,q);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(h),c.STATIC_DRAW);this.indexBuffer[n]=q;this.indexDataArr[n]=h;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,
null);this.position[n]=[p[0],p[1]]}this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(b){var a=b.gl,c=b.projectionMatrix,d=b.viewMatrix;b=this.program;a.useProgram(b.program);a.enable(a.DEPTH_TEST);a.enable(a.POLYGON_OFFSET_FILL);a.polygonOffset(-1,-1);a.depthFunc(a.LEQUAL);a.uniformMatrix4fv(b.uniforms.u_projectionMatrix,!1,c);a.uniformMatrix4fv(b.uniforms.u_modelViewMatrix,!1,d);c=this.opacity;void 0!==this.options.opacity&&(c=this.options.opacity);a.uniform1f(b.uniforms.u_opacity,
c);a.enable(a.BLEND);a.blendFunc(a.SRC_ALPHA,a.DST_ALPHA);a.blendEquation(a.FUNC_ADD);a.enableVertexAttribArray(b.attributes.aPos);a.enableVertexAttribArray(b.attributes.aColor);for(c=0;c<this.bufferDataArr.length;c++)if(!(0>=this.bufferDataArr[c].length)){d=(new Float32Array(this.bufferDataArr[c])).BYTES_PER_ELEMENT;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer[c]);a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,7*d,3*d);a.vertexAttribPointer(b.attributes.aPos,3,a.FLOAT,!1,7*d,0);d=this.position[c];
var e=J.create(),l=[this.currentScale,this.currentScale,this.currentScale];"px"===this.options.unit&&this.map&&(l=this.map.getZoomUnits(),l=[this.currentScale*l,this.currentScale*l,this.currentScale]);J.identity(e);J.translate(e,e,[d[0],d[1],0]);J.scale(e,e,l);a.uniformMatrix4fv(b.uniforms.u_modelMatrix,!1,e);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer[c]);a.drawElements(a.TRIANGLES,this.indexDataArr[c].length,a.UNSIGNED_SHORT,0);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,
null)}a.disable(a.BLEND);a.disable(a.DEPTH_TEST);a.disable(a.POLYGON_OFFSET_FILL);c=this.getOptions();b=c.scale;c=c.step;this.opacity-=c/10;this.currentScale+=b*c;0>this.opacity&&(this.currentScale=this.opacity=1);a.useProgram(null)}}]);return d}(da),zd=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.segs=b.options.segs||10;b.autoUpdate=!0;return b}
H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{color:[.9,.1,.1,1],trailLength:3,height:100,step:.1,segs:10}}},{key:"setTime",value:function(b){this.time=b}},{key:"initialize",value:function(b){this.gl=b;this.program=new K(this.gl,{vertexShader:"precision mediump float;attribute vec4 aPos;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vTime=1.0-((currentTime-aPos.w)/trailLength);}",fragmentShader:"precision mediump float;uniform vec3 uFragColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(uFragColor,1.0*vTime);}"});
this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);for(var d=[],e=b.height,l=0;l<a.length;l++){var n=a[l].geometry.coordinates;var q="[object Function]"===Object.prototype.toString.call(e)?e(a[l]):Number(e);for(var h=0,p=0;p<this.segs;p++){var m=this.normizedPoint(n);d.push(m[0],m[1],h);void 0===n[2]?d.push(p):d.push(Number(n[2]));h+=q/this.segs;d.push(m[0],
m[1],h);void 0===n[2]?d.push(p+1):d.push(Number(n[2]))}}void 0===b.endTime&&(this.endTime=this.segs);this.bufferData=d;c.bufferData(c.ARRAY_BUFFER,new Float32Array(d),c.STATIC_DRAW);this.webglLayer&&this.webglLayer.render()}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;a.useProgram(b.program);a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.enableVertexAttribArray(b.attributes.aPos);a.vertexAttribPointer(b.attributes.aPos,4,a.FLOAT,
!1,0,0);c=this.normizedColor(this.options.color);a.uniform3f(b.uniforms.uFragColor,c[0],c[1],c[2]);a.uniform1f(b.uniforms.currentTime,this.time);a.uniform1f(b.uniforms.trailLength,this.options.trailLength);a.enable(a.BLEND);a.enable(a.POLYGON_OFFSET_FILL);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.polygonOffset(2,1);a.blendFunc(a.SRC_ALPHA,a.ONE);a.blendEquation(a.FUNC_ADD);a.drawArrays(a.LINES,0,this.bufferData.length/4);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND);a.disable(a.DEPTH_TEST);
a.disable(a.POLYGON_OFFSET_FILL);this.time+=this.options.step;this.time>1.5*this.endTime&&(this.time=this.startTime);a.useProgram(null)}}]);return d}(da),Ad=function(c){function d(b,a){x(this,d);return G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a))}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{style:"grid",gridSize:500,gradient:{0:"rgb(50, 50, 256)","0.1":"rgb(50, 250, 56)","0.5":"rgb(250, 250, 56)",1:"rgb(250, 50, 56)"}}}},{key:"onChanged",value:function(b,a){this.gl&&
(a=this.processData(a,b),Ya(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"onChanged",this).call(this,b,a))}},{key:"generateGrid",value:function(b,a){var c=a.gridSize,d=[],e={};a=b.length;for(var l=this.getPointOffset(),n=0;n<a;n++){var q=this.normizedPoint(b[n].geometry.coordinates);q=~~((q[0]+l[0])/c)+"_"+~~((q[1]+l[1])/c);void 0===e[q]&&(e[q]=0);var h=~~b[n].count||1;"properties"in b[n]&&"count"in b[n].properties&&(h=~~b[n].properties.count);e[q]+=h}Object.keys(e).forEach(function(a){var b=
a.split("_");d.push([b[0]*c+c/2,b[1]*c+c/2,e[a]])});return d}},{key:"processData",value:function(b,a){var c=[];if("normal"===a.style)for(var d=this.getPointOffset(),e=0;e<b.length;e++){var l=this.normizedPoint(b[e].geometry.coordinates);c.push([l[0]+d[0],l[1]+d[1],~~b[e].count||1])}else c=this.generateGrid(b,a);d=b=0;if(void 0!==a.max&&void 0!==a.min)b=a.max,d=a.min;else{c[0]&&(b=c[0][2],d=c[0][2]);e=c.length;for(l=0;l<e;l++){var n=c[l];b=Math.max(n[2],b);d=Math.min(n[2],d)}b/=2}a=new X({max:~~b,
min:d,gradient:a.gradient});b=[];for(d=0;d<c.length;d++)e=c[d],e[0]=e[0],e[1]=e[1],l=a.getImageData(e[2]),b.push({geometry:{type:"Point",coordinates:[e[0],e[1]]},color:[l[0]/255,l[1]/255,l[2]/255,l[3]/255]});return b}}]);return d}(Dc),Bd=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferData=[];return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1]}}},{key:"onChanged",value:function(b,a){if(b=this.gl){this.buffer=
b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer);for(var c=[],d=0;20>d;d++)for(var e=5*d,l=0;l<a.length;l++)for(var n=a[l].geometry.coordinates,q=0;q<n.length-1;q++){var h=this.normizedPoint(n[q]);c.push(h[0]);c.push(h[1]);c.push(Number(e));h=this.normizedPoint(n[q+1]);c.push(h[0]);c.push(h[1]);c.push(Number(e))}b.bufferData(b.ARRAY_BUFFER,new Float32Array(c),b.STATIC_DRAW);this.bufferData=c;b.bindBuffer(b.ARRAY_BUFFER,null)}}},{key:"initialize",value:function(b){this.gl=b;this.program=new K(b,
{vertexShader:"uniform mat4 uMatrix;attribute vec3 aPos;void main(){gl_PointSize=10.0;gl_Position=uMatrix*vec4(aPos,1.0);}",fragmentShader:"precision mediump float;uniform vec4 uFragColor;void main(){gl_FragColor=uFragColor;}"});this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"render",value:function(b){var a=b.gl;b=b.matrix;var c=this.program;a.useProgram(c.program);var d=this.normizedColor(this.options.color);a.uniform4f(c.uniforms.uFragColor,d[0],d[1],d[2],d[3]);a.enable(a.DEPTH_TEST);
a.uniformMatrix4fv(c.uniforms.uMatrix,!1,b);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.enableVertexAttribArray(c.attributes.aPos);a.vertexAttribPointer(c.attributes.aPos,3,a.FLOAT,!1,0,0);a.enable(a.BLEND);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ONE);a.drawArrays(a.LINES,0,this.bufferData.length/3);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.DEPTH_TEST)}}]);return d}(da),Ec={circle:1,square:2},Cd=function(c){function d(b,a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,
b,a));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}H(d,c);y(d,[{key:"initialize",value:function(b){this.gl=b;this.program=new K(this.gl,{vertexShader:"attribute vec4 aPos;attribute vec4 aColor;attribute float aSize;uniform mat4 u_matrix;varying vec4 vColor;uniform float currentTime;uniform float trailLength;varying float vTime;void main(void){if(aColor.w>=0.0&&aColor.w<=1.0){vColor=aColor;}else{vColor=vec4(aColor.xyz,1.0);}gl_Position=u_matrix*vec4(aPos.xyz,1.0);gl_PointSize=aSize;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision highp float;varying vec4 vColor;uniform int uShape;varying float vTime;void main(void){if(vTime>1.0||vTime<0.0){discard;}if(uShape==1){float d=distance(gl_PointCoord,vec2(0.5,0.5));if(d<0.5){gl_FragColor=vColor;}else{discard;}}else{gl_FragColor=vec4(vColor.rgb,vColor.a*vTime);}}"});this.f32BufferData=new Float32Array;this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();
c.bindBuffer(c.ARRAY_BUFFER,this.buffer);for(var d=[],e=b.color||[.1,.1,.9,1],l=b.size||5,n=0;n<a.length;n++){var q=a[n].geometry.coordinates,h=a[n].color||e;"[object Function]"===Object.prototype.toString.call(h)&&(h=h(a[n]));"properties"in a[n]&&"color"in a[n].properties&&(h=a[n].properties.color);h=this.normizedColor(h);var p=this.normizedPoint(q),m=l;m="[object Function]"===Object.prototype.toString.call(m)?m(a[n]):Number(m);var t=a[n].time||n;"properties"in a[n]&&"time"in a[n].properties&&(t=
a[n].properties.time);d.push(p[0],p[1],Number(q[2]||0),t);d.push(h[0],h[1],h[2],h[3]);d.push(m*window.devicePixelRatio)}void 0===b.endTime&&(this.endTime=a.length);this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;0>=this.bufferData.length||(b=this.program,a.useProgram(b.program),a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c),a.bindBuffer(a.ARRAY_BUFFER,this.buffer),c=this.f32BufferData.BYTES_PER_ELEMENT,
a.enableVertexAttribArray(b.attributes.aPos),a.vertexAttribPointer(b.attributes.aPos,4,a.FLOAT,!1,9*c,0),a.enableVertexAttribArray(b.attributes.aColor),a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,9*c,4*c),a.enableVertexAttribArray(b.attributes.aSize),a.vertexAttribPointer(b.attributes.aSize,1,a.FLOAT,!1,9*c,8*c),a.uniform1f(b.uniforms.currentTime,this.time),a.uniform1f(b.uniforms.trailLength,this.options.trailLength||3),c=1,this.options.shape&&Ec[this.options.shape]&&(c=Ec[this.options.shape]),
a.uniform1i(b.uniforms.uShape,c),b=this.options.blend,a.enable(a.BLEND),a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.blendEquation(a.FUNC_ADD),b&&"lighter"===b?a.blendFunc(a.SRC_ALPHA,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.drawArrays(a.POINTS,0,this.bufferData.length/9),a.bindBuffer(a.ARRAY_BUFFER,null),a.disable(a.BLEND),a.disable(a.DEPTH_TEST),a.useProgram(null),this.time+=this.options.step||.1,this.time>this.endTime&&(this.time=this.startTime))}}]);return d}(da),Dd=function(c){function d(b,
a){x(this,d);b=G(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,a));b.bufferData=[];b.startTime=b.options.startTime||0;b.endTime=b.options.endTime;b.time=b.startTime;b.autoUpdate=!0;return b}H(d,c);y(d,[{key:"getDefaultOptions",value:function(){return{color:[1,.05,.05,1],trailLength:3,step:.1}}},{key:"initialize",value:function(b){this.gl=b;this.program=new K(this.gl,{vertexShader:"precision highp float;attribute vec4 aPos;attribute vec4 aColor;uniform mat4 u_matrix;uniform float currentTime;uniform float trailLength;varying float vTime;varying vec4 vColor;void main(){gl_Position=u_matrix*vec4(aPos.xyz,1.0);vColor=aColor;vTime=1.0-((currentTime-aPos.w)/trailLength);}",
fragmentShader:"precision highp float;uniform vec3 uFragColor;varying vec4 vColor;varying float vTime;void main(){if(vTime>1.0||vTime<0.0){discard;}gl_FragColor=vec4(vColor.rgb,1.0*vTime);}"},this);this.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,this.buffer)}},{key:"setTime",value:function(b){this.time=b}},{key:"onChanged",value:function(b,a){var c=this.gl;if(c){this.buffer=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,this.buffer);for(var d=[],e=0,l=this.options.color,n=0;n<a.length;n++){var q=
a[n].geometry.coordinates;a[n].color&&(l=a[n].color);"properties"in a[n]&&"color"in a[n].properties&&(l=a[n].properties.color);"[object Function]"===Object.prototype.toString.call(l)&&(l=l(a[n]));l=this.normizedColor(l);q.length>e&&(e=q.length);for(var h=0;h<q.length-1;h++){var p=this.normizedPoint(q[h]);d.push(p[0]);d.push(p[1]);d.push(p[2]);void 0===q[h][3]?d.push(h):d.push(Number(q[h][3]));d.push(l[0]);d.push(l[1]);d.push(l[2]);d.push(l[3]);p=this.normizedPoint(q[h+1]);d.push(p[0]);d.push(p[1]);
d.push(p[2]);void 0===q[h+1][3]?d.push(h+1):d.push(Number(q[h+1][3]));d.push(l[0]);d.push(l[1]);d.push(l[2]);d.push(l[3])}}void 0===b.endTime&&(this.endTime=e);this.bufferData=d;this.f32BufferData=new Float32Array(d);c.bufferData(c.ARRAY_BUFFER,this.f32BufferData,c.STATIC_DRAW)}}},{key:"render",value:function(b){var a=b.gl,c=b.matrix;b=this.program;b.use(a);a.uniformMatrix4fv(b.uniforms.u_matrix,!1,c);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);c=this.f32BufferData.BYTES_PER_ELEMENT;a.enableVertexAttribArray(b.attributes.aPos);
a.vertexAttribPointer(b.attributes.aPos,4,a.FLOAT,!1,8*c,0);a.enableVertexAttribArray(b.attributes.aColor);a.vertexAttribPointer(b.attributes.aColor,4,a.FLOAT,!1,8*c,4*c);c=this.normizedColor(this.options.color);a.uniform3f(b.uniforms.uFragColor,c[0],c[1],c[2]);a.uniform1f(b.uniforms.currentTime,this.time);a.uniform1f(b.uniforms.trailLength,this.options.trailLength);a.enable(a.BLEND);a.enable(a.POLYGON_OFFSET_FILL);a.enable(a.DEPTH_TEST);a.depthFunc(a.LEQUAL);a.polygonOffset(2,1);"lighter"===this.options.blend?
a.blendFunc(a.ONE,a.ONE):a.blendFunc(a.SRC_ALPHA,a.ONE);a.blendEquation(a.FUNC_ADD);a.drawArrays(a.LINES,0,this.bufferData.length/8);a.bindBuffer(a.ARRAY_BUFFER,null);a.disable(a.BLEND);a.disable(a.DEPTH_TEST);this.time+=this.options.step;this.time>this.endTime&&(this.time=this.startTime);a.useProgram(null)}}]);return d}(da);v.HeatmapLayer=id;"OffscreenCanvas"in window&&(v.HeatmapLayer=kd);var Ed=function(){function c(d){var b=this;x(this,c);this.options={autoUpdate:!0};Object.assign(this.options,
d);this.layers=[];var a=d.pointOffset;this.webglLayer=d.webglLayer||new sc(d.map,this.options);this.effectManager=new rc(this.webglLayer.gl);this.webglRender={render:function(){}};this.options.effects&&this.effectManager.setEffects([this.webglRender].concat(this.options.effects));this.webglLayer.onRender(function(a){b._render(a)});a||"cesium"===this.webglLayer.options.mapType||(a=this.webglLayer.map.getCenter(),this.webglLayer.options.pointOffset=[a.lng,a.lat]);this.webglLayer.map.onResize(function(){b.effectManager.initFbo()});
if(this.postProcessing=d.postProcessing)this.postProcessing.setWebglLayer(this.webglLayer),d=this.postProcessing.getThreeLayer(),this.addLayer(d),this.postProcessing.initialize(d),d.postProcessing=this.postProcessing}y(c,[{key:"renderCanvas",value:function(c){var b=this;this.postProcessing?(this.postProcessing.addRender(function(){b.renderGLLayers(c)}),this.renderThreeLayers(c),this.renderThreeLayer(c)):(this.renderThreeLayers(c),this.renderThreeLayer(c),this.renderGLLayers(c))}},{key:"renderGLLayers",
value:function(c){for(var b=0;b<this.layers.length;b++){var a=this.layers[b];"threeLayer"!==a.layerType&&"ThreeLayer"!==a.layerType&&(this.beforeRender(c),c.gl.enable(c.gl.DEPTH_TEST),c.gl.disable(c.gl.BLEND),a.render(c),this.afterRender(c))}}},{key:"renderThreeLayer",value:function(c){for(var b=0;b<this.layers.length;b++){var a=this.layers[b];"ThreeLayer"===a.layerType&&a.render(c)}}},{key:"renderThreeLayers",value:function(c){for(var b=0;b<this.layers.length;b++){var a=this.layers[b];"threeLayer"===
a.layerType&&(this.beforeRender(c),a.render(c),this.afterRender(c))}}},{key:"beforeRender",value:function(c,b){if(c=c.gl)this.preBlendState=c.isEnabled(c.BLEND),this.preDepthState=c.isEnabled(c.DEPTH_TEST),this.preCullFaceState=c.isEnabled(c.CULL_FACE),c.enable(c.BLEND)}},{key:"afterRender",value:function(c){if(c=c.gl)!1===this.preBlendState?c.disable(c.BLEND):c.enable(c.BLEND),!1===this.preDepthState?c.disable(c.DEPTH_TEST):c.enable(c.DEPTH_TEST),!1===this.preCullFaceState?c.disable(c.CULL_FACE):
c.enable(c.CULL_FACE)}},{key:"render",value:function(){this.webglLayer.render()}},{key:"_render",value:function(c){var b=this,a=this.options.effects;a&&0<a.length?(this.webglRender.render=function(){b.renderCanvas(c)},this.effectManager.render()):this.renderCanvas(c)}},{key:"addLayer",value:function(c){for(var b=!1,a=0;a<this.layers.length;a++)if(this.layers[a]===c){b=!0;break}b||(c.map=this.webglLayer.map,"threeLayer"===c.layerType?(c.setWebglLayer(this.webglLayer),b=c.getThreeLayer(),this.addLayer(b),
c.initialize&&c.initialize(b)):(c.setWebglLayer(this.webglLayer),c.initialize&&c.initialize(this.webglLayer.gl),c.onOptionsChanged(c.getOptions()),c.onDataChanged(c.getData()),c.onChanged(c.getOptions(),c.getData())),this.layers.push(c));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation());this.webglLayer.render()}},{key:"removeLayer",value:function(c){for(var b=0;b<this.layers.length;b++)this.layers[b]===c&&(c.destroy&&c.destroy(),
this.layers.splice(b,1));this.options.autoUpdate&&(this.isRequestAnimation()?this.webglLayer.startAnimation():this.webglLayer.stopAnimation());this.webglLayer.render()}},{key:"onRender",value:function(c){this.webglLayer.onRender(c)}},{key:"removeAllLayers",value:function(){for(var c=0;c<this.layers.length;c++){var b=this.layers[c];b.destroy&&b.destroy();this.layers.splice(c,1)}this.webglLayer.render()}},{key:"destroy",value:function(){this.stopAnimation();this.removeAllLayers();this.webglLayer.destroy()}},
{key:"isRequestAnimation",value:function(){for(var c=!1,b=0;b<this.layers.length;b++)if(this.layers[b].isRequestAnimation()){c=!0;break}return c}},{key:"startAnimation",value:function(){this.webglLayer.startAnimation()}},{key:"stopAnimation",value:function(){this.webglLayer.stopAnimation()}}]);return c}();window._hmt=window._hmt||[];(function(){var c=document.createElement("script");c.src="https://hm.baidu.com/hm.js?e8002ef3d9e0d8274b5b74cc4a027d08";var d=document.getElementsByTagName("script")[0];
d.parentNode.insertBefore(c,d)})();v.View=Ed;v.GridLayer=xc;v.HeatGridLayer=md;v.ShapeLayer=wc;v.SimpleLineLayer=zc;v.LineLayer=od;v.WallSpriteLayer=qd;v.LinePointLayer=Ba;v.WallLayer=ud;v.WallTripLayer=wd;v.HeatLineLayer=xd;v.WebglLayer=sc;v.PointLayer=Dc;v.RippleLayer=yd;v.SparkLayer=zd;v.HeatPointLayer=Ad;v.ShapeLineLayer=Bd;v.PointTripLayer=Cd;v.LineTripLayer=Dd;v.Layer=da;v.BlurEffect=Zc;v.BloomEffect=$c;v.BrightEffect=ad;v.DepthEffect=bd;v.EffectManager=rc;v.getContext=gc;v.createTexture=vb;
v.loadTextureImage=wb;v.FrameBufferObject=Ha;v.Program=K;v.Buffer=ob;v.VertexArray=Qb;v.CommonLayer=Ab;v.MercatorProjection=ja;v.toRadian=gb;v.Canvas=hb;v.Intensity=X;v.BezierCurve=va;v.__moduleExports=na;v.vec4=Qc;v.vec3=Ra;v.vec2=Rc;v.quat2=Sc;v.quat=Tc;v.mat4=J;v.mat3=Uc;v.mat2d=Vc;v.mat2=Wc;v.glMatrix=Xc;Object.defineProperty(v,"__esModule",{value:!0})});
